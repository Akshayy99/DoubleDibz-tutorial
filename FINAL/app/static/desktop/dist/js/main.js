define("settings",["jquery","underscore","backbone","marionette","handlebars","bbf-bootstrap3"],function(e,t,n,r,i){var s=e("meta[name=csrf-token]").attr("content");e.ajaxSetup({beforeSend:function(e,t){/^(GET|HEAD|OPTIONS|TRACE)$/i.test(t.type)||e.setRequestHeader("X-CSRFToken",s)}}),n.$=window.$,e(function(){e(document.body).on("focus",".input-group .form-control",function(){e(this).closest(".input-group, .form-group").addClass("focus")}).on("blur",".input-group .form-control",function(){e(this).closest(".input-group, .form-group").removeClass("focus")})}),i.registerHelper("decimal",function(e){return e.toFixed(2)}),i.registerHelper("if_eq",function(e,t,n){return e==t?n.fn(this):n.inverse(this)}),i.registerHelper("toUpperCase",function(e){return e.toUpperCase()}),i.registerHelper("showPrice",function(e){return!t.isNaN(e)&&e===0?"FREE":t.isNull(e)?"":e%1!=0?"$"+e.toFixed(2):"$"+e.toFixed(0)}),n.Marionette.TemplateCache.prototype.compileTemplate=function(e){return i.compile(e)},n.Marionette.TemplateCache.prototype.loadTemplate=function(e){return e},n.Model.prototype.parse=function(e,t){return t.collection?e:e.data},n.Collection.prototype.parse=function(e){return e.data},n.Form.template=t.template('    <form class="form-horizontal" role="form" onsubmit="return false">      <div data-fieldsets></div>      <% if (submitButton) { %>        <button type="submit" class="btn"><%= submitButton %></button>      <% } %>    </form>  '),n.Form.fullColumnTpl=t.template('    <div class="col-xs-12">      <div class="form-group field-<%= key %>">        <span data-editor></span>        <p class="help-block" data-error></p>        <p class="help-block"><%= help %></p>      </div>    </div>   '),n.Form.halfColumnTpl=t.template('    <div class="col-xs-6  field-<%= key %>" >      <div class="form-group">        <span data-editor></span>        <p class="help-block" data-error></p>        <p class="help-block"><%= help %></p>      </div>    </div>   '),t.extend(n.Model.prototype,{ajax:function(n,r,i){return t.isEmpty(n)?n=null:n=JSON.stringify(n),"async"in r||(r.async=!0),e.ajax({url:r.url,contentType:"application/json",dataType:"json",type:r.method,async:r.async,data:n,success:function(e){i&&"success"in i&&i.success(e)},error:function(e,t){i&&"error"in i&&i.error(e)}}).complete(function(e,t){i&&"complete"in i&&i.complete(e)})},extendCallback:function(e,n,r){return t.isEmpty(n)?e:(e=t.clone(e)||{},n=t.clone(n)||{},t.each(["success","error","complete"],function(i){n&&n[i]&&(e[i]=t.wrap(e[i],function(e,s){t.bind(n[i],r)(s),t.isFunction(e)&&e(s)}))}),e)}})}),define("reqres",["backbone","marionette"],function(e,t){return new e.Wreqr.RequestResponse}),define("auth/UserModel",["underscore","reqres"],function(e,t){var n=Backbone.Model.extend({initialize:function(e){this.id=e.id},defaults:{id:0,user_name:"",role:"",first_name:"",last_name:"",email:"",settings:{phone:"",bio:"",sex_code:0},fb:"",fb_only:"",picture:"",picture_thumb:"",circles:[],fb_friends:[],ucla_temp:!1},url:function(){return t.request("api").user+"/"+this.user_name},toggleFBStatus:function(){this.get("fb")==="connected"?this.set({fb:"disconnected"}):this.set({fb:"connected"})},isInCircle:function(t){return e.find(this.get("circles"),function(e){return e.id==t.id})},getFBFriends:function(n){this.get("fb_friends")&&n(this.get("fb_friends"));var r=t.request("FB"),i=this;r.getLoginStatus(function(t){t.status==="connected"&&r.api("/me/friends","get",{fields:"name, picture"},function(t){var r=e.object(e.map(t.data,function(e){return[e.name,{id:e.id,picture:e.picture.data.url}]}));i.set({fb_friends:r}),n(r)})})},checkUCLAVerified:function(e){var n={url:t.request("api").ucla_verified,method:"GET"};this.ajax(null,n,e)}});return n}),define("vent",["backbone","marionette"],function(e,t){return new e.Wreqr.EventAggregator}),define("auth/SessionModel",["underscore","reqres","auth/UserModel","vent"],function(e,t,n,r){var i=Backbone.Model.extend({defaults:{logged_in:!1,user_id:""},initialize:function(){this.user=new n({})},updateSessionUser:function(t){this.user.set(e.pick(t,e.keys(this.user.defaults))),this.set({user_id:t.id,logged_in:!0})},clearSessionUser:function(){this.set({user_id:"".id,logged_in:!1})},isLoggedIn:function(){return this.get("logged_in")},getCurrentUser:function(){return this.user},checkAuth:function(e,n){var r={url:t.request("api").verify_auth,method:"GET"};e=this.extendCallback(e,{success:function(e){this.updateSessionUser(e.data)},error:function(e){this.clearSessionUser()}},this),this.ajax(null,r,e)},login:function(e,n,r){var i;n==="fb"?i={url:t.request("api").auth+"/fb_login",method:"POST"}:i={url:t.request("api").auth+"/login",method:"POST"},r=this.extendCallback(r,{success:function(e){this.updateSessionUser(e.data)}},this),this.ajax(e,i,r)},logout:function(e,n){var r={url:t.request("api").auth+"/logout",method:"POST"};n=this.extendCallback(n,{success:function(e){this.clearSessionUser()}},this),this.ajax(e,r,n)},signup:function(e,n,r){var i;n==="fb"?i={url:t.request("api").auth+"/fb_signup",method:"POST"}:i={url:t.request("api").auth+"/signup",method:"POST"},this.ajax(e,i,r)},check_fb_id:function(e,n){var r={url:t.request("api").auth+"/check_fb_id",method:"POST",async:!1};this.ajax(e,r,n)},check_email:function(e,n){var r={url:t.request("api").auth+"/check_email",method:"POST",async:!1};this.ajax(e,r,n)},getSettings:function(e){var n={url:t.request("api").settings,method:"GET"};return e=this.extendCallback(e,{success:function(e){this.updateSessionUser(e.data)}},this),this.ajax(null,n,e)},updateSettings:function(e,n){var r={url:t.request("api").settings,method:"PUT"};n=this.extendCallback(n,{success:function(e){this.updateSessionUser(e.data)}},this),this.ajax(e,r,n)},updatePassword:function(e,n){var r={url:t.request("api").password,method:"PUT"};this.ajax(e,r,n)},updateFBLink:function(e){var n={url:t.request("api").fb_link,method:"PUT"};this.ajax({},n,e)},verifyEmail:function(e,n,r){if(n==null){var i={url:t.request("api").verify_email+e,method:"GET"};this.ajax(null,i,r)}else{var i={url:t.request("api").verify_email+e,method:"POST"};this.ajax(n,i,r)}},forgotPassword:function(e,n){var r={url:t.request("api").forgot_password,method:"POST"};this.ajax(e,r,n)},LoginRequired:function(e,t){var n=this;return function(){if(!n.isLoggedIn())return r.trigger("account:unauthorized");t.apply(e,arguments)}},setLoginRequired:function(t,n){var r=this;e.each(n,function(n){var i=t[n];if(!e.isFunction(i))throw"Function "+n+" does not exist";t[n]=r.LoginRequired(t,i)})}});r.on("account:unauthorized",function(){is_canvas||r.trigger("navigate:login",!0)});var s=new i({});return t.setHandler("session",function(){return s}),t.setHandler("currentUser",function(){return s.getCurrentUser()}),t.setHandler("isLoggedIn",function(){return s.isLoggedIn()}),s}),define("templates/LoadingSignView",["marionette","vent"],function(e,t){var n=e.ItemView.extend({template:"<img src='/static/img/ajax-loader.gif' class='region-loader'>"});return n}),define("app",["jquery","marionette","vent","templates/LoadingSignView"],function(e,t,n,r){var i=new t.Application;i.addRegions({headerRegion:"#header-region",alertRegion:"#alert-region",mainRegion:"#main-region",footerRegion:"#footer-region"}),n.on("domChange:title",function(t){e(document).attr("title",t)}),n.on("mainRegion:show",function(t,n){i.mainRegion.show(t),e(document).scrollTop(0)});var s=function(e){e.show(new r)},o=function(e){e.empty()};return n.on("mainRegion:deferredShow",function(e,t){s(i.mainRegion),e.done(function(e){t&&"success"in t&&t.success(e)}).fail(function(e,n){t&&"error"in t&&t.error(e)})}),n.on("region:deferredShow",function(e,t,n){s(e),t.done(function(e){n&&"success"in n&&n.success(e)}).fail(function(e,t){n&&"error"in n&&n.error(e)})}),n.on("headerRegion:show",function(e){i.headerRegion.show(e)}),n.on("mainRegion:close",function(){i.mainRegion.empty()}),n.on("footerRegion:show",function(e){i.footerRegion.show(e)}),n.on("all",function(e,t){console.log("DEBUG: Event Caught: "+e)}),i}),define("text!header/tpl-category-item.html",[],function(){return'<a class="category-item" data-category="{{name}}" href="#">{{showName}}</a>\n'}),define("header/BaseView",["underscore","marionette","vent","text!header/tpl-category-item.html"],function(e,t,n,r){var i=t.ItemView.extend({template:r,tagName:"li",events:{"click .category-item":"onDropdownClick"},onDropdownClick:function(e){var t=$(e.target).data("category");n.trigger("navigate:search:hashtag","ucla",null,t)}}),s=t.CompositeView.extend({childView:i,childViewContainer:".dropdown-categories",ui:{searchBox:"#search-box",navCategories:"#nav-categories",navSearch:"#nav-search",searchForm:"#nav-search-form"},initialize:function(){this.onSubmitClick=e.debounce(this.onSubmitClick,500,!0),this.navCategoryTimer=null},registerSearch:function(){var e=this;$("html").on("click.headerSearch",function(t){$(t.target).closest("#search-box").length||$("#search-box").is(":visible")&&e.hideNavSearch()})},events:{"click #home-link":"onHomeClick","click #submit-btn":"onSubmitClick","keyup @ui.searchBox":"onSearchKeyUp",'click [data-category="all"]':"onAllSearch","click @ui.navSearch":"onNavSearchClick"},onHomeClick:function(){n.trigger("navigate:home")},onAllSearch:function(){n.trigger("navigate:search:home","ucla",null)},onSearchKeyUp:function(e){var t=e.keyCode||e.which,n=13;e.preventDefault(),t==n&&this.onSubmitClick()},onSubmitClick:function(){var e=this.ui.searchBox.val().trim();n.trigger("navigate:search:name","ucla",null,e)},hideNavSearch:function(){this.ui.searchBox.parent().removeClass("open");var t=this;e.delay(function(){t.ui.navSearch.removeClass("hide"),t.ui.searchForm.addClass("hide")},450)},onNavSearchClick:function(e){this.ui.navSearch.addClass("hide"),this.ui.searchForm.removeClass("hide"),this.ui.searchBox.focus().parent().addClass("open"),e.stopPropagation(),e.preventDefault()},onDestroy:function(){$("html").off("click.headerSearch")}});return s}),define("text!header/tpl-default-header.html",[],function(){return'<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">\n   <!-- Navbar content -->\n   <div class="container">\n\n      <div class="navbar-header">\n         <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">\n            <span class="sr-only">Toggle navigation</span>\n         </button>\n         <a id="home-link" class="navbar-brand logo" href="/">\n            <img src="/static/img/logo_text_white.png">\n            <span class="label label-primary logo-sign">@ucla</span>\n         </a>\n      </div>\n      <div class="collapse navbar-collapse">\n\n         <ul class="nav navbar-nav">\n\n            <li class="dropdown" id=\'nav-categories\'>\n               <a id="category-list-icon" href="#" class="dropdown-toggle" data-toggle="dropdown">Categories</a>\n               \n               <span class="dropdown-arrow "></span>\n               <ul class="dropdown-menu dropdown-categories clearfix">\n                  <li><a class="category-item" data-category="all" href="#">Everything</a></li>\n               </ul>\n            </li>\n            \n            <li>\n               <a id="nav-search"   href="#"><span class="glyphicon glyphicon-search"></span></a>\n               <form id="nav-search-form" class="navbar-form navbar-left hide" action="#" role="search">\n                  <div class="form-group">\n                     <div class="input-group">\n                        <input class="form-control no-transition" id="search-box" type="search" placeholder="">\n                        <span class="input-group-btn">\n                           <button id=\'submit-btn\' type="submit" class="btn"><span class="fui-search"></span></button>\n                        </span>            \n                     </div>\n                  </div>               \n               </form>\n            \n            </li>\n         </ul>\n         \n\n       \n         <ul id=\'navbar-right\' class="nav navbar-nav navbar-right">\n            <li><a id="signup-link"  href="/signup">Signup</a></li>\n            <li><a id="login-link"  href="/login">Login</a></li>\n         </ul>\n       \n   \n      </div><!--/.nav-collapse -->\n   \n   </div>\n</div>\n'}),define("header/DefaultHeaderView",["marionette","vent","header/BaseView","text!header/tpl-default-header.html"],function(e,t,n,r){var i=n.extend({template:r,events:_.extend({},n.prototype.events,{"click #signup-link":"onSignupClick","click #login-link":"onLoginClick"}),onSignupClick:function(){t.trigger("navigate:signup")},onLoginClick:function(){t.trigger("navigate:login")},onHomeClick:function(){t.trigger("navigate:home")}});return i}),define("text!header/tpl-logged-in-header.html",[],function(){return'<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">\n   <!-- Navbar content -->\n   <div class="container">\n      <div class="navbar-header">\n         <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">\n            <span class="sr-only">Toggle navigation</span>\n         </button>\n         <a id="home-link" class="navbar-brand logo" href="/">\n            <img src="/static/img/logo_text_white.png">\n            <span class="label label-primary logo-sign">@ucla</span>\n         </a>\n      </div>\n      \n      <div class="collapse navbar-collapse">\n         <ul class="nav navbar-nav">\n             <li class="dropdown" id=\'nav-categories\'>\n               <a id="category-list-icon" href="#" class="dropdown-toggle" data-toggle="dropdown">Categories</a>\n               \n               <span class="dropdown-arrow "></span>\n               <ul class="dropdown-menu dropdown-categories clearfix">\n                  <li><a class="category-item" data-category="all" href="#">Everything</a></li>\n               </ul>\n            </li>\n            <li>\n               <a id="nav-search"   href="#"><span class="glyphicon glyphicon-search"></span></a>\n               <form id="nav-search-form" class="navbar-form navbar-left hide" action="#" role="search">\n                  <div class="form-group">\n                     <div class="input-group">\n                        <input class="form-control no-transition" id="search-box" type="search">\n                        <span class="input-group-btn">\n                           <button id=\'submit-btn\' type="submit" class="btn"><span class="fui-search"></span></button>\n                        </span>            \n                     </div>\n                  </div>               \n               </form>\n            </li>\n        </ul>\n        \n            \n        <ul class="nav navbar-nav navbar-right">\n               <!-- <li><a id="create-post-link" href="/posts/create"><span class="glyphicon glyphicon-plus"></span></a></li> -->\n               <li class="dropdown">\n                  <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-plus"></span></a>\n                  <ul class="dropdown-menu">\n                     \n                   	<li><a id=\'create-post-link\' href="/posts/create">I\'m Selling</a></li>\n                     <li><a id=\'create-buy-request-link\' href="/buy_requests/create">I\'m Looking For</a></li>\n                  </ul>\n               </li>\n               \n               \n               <li id=\'nav-inbox\'>\n               \n                  <a id=\'inbox-link\'  class="dropdown-toggle"  data-toggle="dropdown"  href="#">\n                     <span class="glyphicon glyphicon-envelope"></span>\n                     <span class="unread-bubble navbar-new hidden"></span>\n                  </a>\n                  \n                  <span class="dropdown-arrow"></span>\n                  <ul class="dropdown-menu dropdown-inbox"></ul>\n                  \n               </li>\n               \n               <li>\n                  <a id=\'noti-link\' class=\'dropdown-toggle\' data-toggle=\'dropdown\' href=\'#\'>\n                     <span class="glyphicon glyphicon-globe"></span>\n                     <span class="unread-bubble navbar-new hidden"></span>\n                  </a>\n                  \n                  <span class="dropdown-arrow "></span>\n                  <ul class="dropdown-menu dropdown-notification"></ul>\n                     \n               </li>\n               \n               \n               <li id=\'nav-profile\'>\n                  <a id=\'header-profile\' class="dropdown-toggle" data-toggle="dropdown" href=\'#\'>\n                     <div class="pull-left header-profile-wrap">\n                        <img class=\'img-rounded header-profile-picture\' src="{{picture_thumb}}" alt="Profile Picture" />\n\n                        <span class="header-profile-name">{{first_name}}</span>\n                     </div>\n                  </a>\n                  \n                  <span class="dropdown-arrow "></span>\n                  <ul class="dropdown-menu">\n\n                     <li><a id=\'posts-link\' href=\'/u/{{user_name}}\'>My Posts</a></li>\n                     <li><a id="bookmarks-link" href=\'/bookmarks\'>Bookmarks</a></li>\n                   	<li><a id=\'settings-link\' href="/settings/account">Settings</a></li>\n                   	<li><a id="invite-btn" href="#">Invite Friends</a></li>\n                     <li><a id=\'logout-link\' href="/logout">Logout</a></li>\n                  </ul>\n               </li>\n               <!--\n               <li class="dropdown">\n                  <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-cog"></span></a>\n                  <ul class="dropdown-menu">\n                     \n                   	<li><a id=\'settings-link\' href="/settings/account">Settings</a></li>\n                     <li><a id=\'logout-link\' href="/logout">Logout</a></li>\n                  </ul>\n               </li>\n               !-->\n        </ul>\n      </div><!--/.nav-collapse -->\n   </div>\n\n</div>\n<div id="report-btn" ><a type="submit" href="#">Feedback</a></div>\n'}),define("header/LoggedInHeaderView",["jquery","underscore","marionette","app","vent","reqres","header/BaseView","text!header/tpl-logged-in-header.html"],function(e,t,n,r,i,s,o,u){var a=o.extend({template:u,ui:t.extend({},o.prototype.ui,{inboxBubble:"#inbox-link .unread-bubble",notiBubble:"#noti-link .unread-bubble",profileImg:".header-profile-picture",inboxDropdown:".dropdown-inbox",notiDropdown:".dropdown-notification",navProfile:"#nav-profile"}),events:t.extend({},o.prototype.events,{"click #settings-link":"onSettingsClick","click #logout-link":"onLogoutClick","click #posts-link":"onPostsClick","click #create-post-link":"onCreatePostClick","click #bookmarks-link":"onBookmarkClick","click #create-buy-request-link":"onCreateRequestClick","click #report-btn":"onReportBugClick","click #invite-btn":"onInviteClick","mouseover @ui.navProfile":"overProfile","mouseout @ui.navProfile":"outProfile"}),initialize:function(e){o.prototype.initialize.apply(this),this.model=e.user,this.listenTo(this.model,"change:picture",this.updatePicture),this.inboxSet=!1,this.navProfileTimer=null},updatePicture:function(){this.ui.profileImg.attr("src",this.model.get("picture_thumb"))},renderInboxDropdown:function(){this.inboxPopView=s.request("messages:dropdown"),this.ui.inboxDropdown.append(this.inboxPopView.el),this.ui.inboxDropdown.on("click",function(e){e.stopPropagation(),e.preventDefault()});var e=this;this.listenTo(i,"navigate:messages:post navigate:messages",function(){e.ui.inboxDropdown.parent().removeClass("open").blur()})},renderNotiDropdown:function(){this.notifView=s.request("notifications:dropdown"),this.ui.notiDropdown.append(this.notifView.el),this.ui.notiDropdown.on("click",function(e){e.stopPropagation(),e.preventDefault()});var e=this;this.listenTo(i,"notifications:click",function(){e.ui.notiDropdown.parent().removeClass("open").blur()})},updateInboxCount:function(e){this.ui.inboxBubble.text(e),e===0?this.ui.inboxBubble.addClass("hidden"):this.ui.inboxBubble.removeClass("hidden")},updateNotiCount:function(e){this.ui.notiBubble.text(e),e===0?this.ui.notiBubble.addClass("hidden"):this.ui.notiBubble.removeClass("hidden")},onRender:function(){this.renderInboxDropdown(),this.renderNotiDropdown()},onReportBugClick:function(){i.trigger("open:reportbug")},onSettingsClick:function(){i.trigger("navigate:account:settings")},onLogoutClick:function(){i.trigger("auth:logoutAttempt")},onCreatePostClick:function(){i.trigger("navigate:createPost")},onCreateRequestClick:function(){i.trigger("navigate:createBuyRequest")},onBookmarkClick:function(){i.trigger("navigate:account:bookmarks")},onPostsClick:function(){i.trigger("navigate:account:posts")},overProfile:function(){this.navProfileTimer&&clearTimeout(this.navProfileTimer),this.ui.navProfile.addClass("open")},outProfile:function(){var e=this;this.navProfileTimer=setTimeout(function(){e.ui.navProfile.removeClass("open")},200)},onDestroy:function(){clearTimeout(this.navProfileTimer)},onInviteClick:function(){i.trigger("open:inviteFriends")}});return a}),define("text!header/tpl-canvas-header.html",[],function(){return'<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">\n   <!-- Navbar content -->\n   <div class="container">\n      <div class="navbar-header">\n         <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">\n            <span class="sr-only">Toggle navigation</span>\n         </button>\n         <a id="home-link" class="navbar-brand logo" href="/">\n            <img src="/static/img/logo_text_white.png">\n            <span class="label label-primary logo-sign">@ucla</span>\n         </a>\n      </div>\n      <div class="collapse navbar-collapse">\n      \n         <ul class="nav navbar-nav navbar-right">\n            <li id=\'nav-inbox\'>   \n               <a id=\'inbox-link\'  class="dropdown-toggle"  data-toggle="dropdown"  href="#">\n                  <span class="glyphicon glyphicon-envelope"></span>\n                  <span class="unread-bubble navbar-new hidden"></span>\n               </a>\n                     \n               <span class="dropdown-arrow dropdown-arrow-inverse"></span>\n               <ul class="dropdown-menu dropdown-inverse dropdown-inbox"></ul>\n            </li>\n            \n            <li>\n               <a id=\'noti-link\' class=\'dropdown-toggle\' data-toggle=\'dropdown\' href=\'#\'>\n                  <span class="glyphicon glyphicon-globe"></span>\n                  <span class="unread-bubble navbar-new hidden"></span>\n               </a>\n               \n               <span class="dropdown-arrow dropdown-arrow-inverse"></span>\n               <ul class="dropdown-menu dropdown-inverse dropdown-notification"></ul>\n                  \n            </li>\n            \n            \n            <li>\n               <a id=\'header-profile\' class="dropdown-toggle" data-toggle="dropdown" href=\'#\'>\n                  <div class="pull-left header-profile-wrap">\n                     <img class=\'img-rounded header-profile-picture\' src="{{picture_thumb}}" alt="Profile Picture" />\n\n                     <span class="header-profile-name">{{first_name}}</span>\n                  </div>\n               </a>\n                  \n               <span class="dropdown-arrow dropdown-arrow-inverse"></span>\n               <ul class="dropdown-menu">\n                     <li><a id=\'posts-link\' href=\'/u/{{user_name}}\'>My Posts</a></li>\n                     <li><a id="bookmarks-link" href=\'/bookmarks\'>Bookmarks</a></li>\n                   	<li><a id=\'settings-link\' href="/settings/account">Settings</a></li>\n               </ul>\n            </li>\n         </ul>\n         \n      </div><!--/.nav-collapse -->\n      \n   </div>\n</div>\n'}),define("header/CanvasHeaderView",["jquery","underscore","marionette","app","vent","reqres","header/BaseView","text!header/tpl-canvas-header.html"],function(e,t,n,r,i,s,o,u){var a=n.ItemView.extend({template:u,ui:{inboxBubble:"#inbox-link .unread-bubble",notiBubble:"#noti-link .unread-bubble",profileImg:".header-profile-picture",inboxDropdown:".dropdown-inbox",notiDropdown:".dropdown-notification"},events:{"click #posts-link":"onPostsClick"},initialize:function(e){this.model=e.user,this.inboxSet=!1,this.listenTo(this.model,"change:picture",this.updatePicture)},onRender:function(){this.renderInboxDropdown(),this.renderNotiDropdown()},updatePicture:function(){this.ui.profileImg.attr("src",this.model.get("picture_thumb"))},updateInboxCount:function(e){this.ui.inboxBubble.text(e),e===0?this.ui.inboxBubble.addClass("hidden"):this.ui.inboxBubble.removeClass("hidden")},updateNotiCount:function(e){this.ui.notiBubble.text(e),e===0?this.ui.notiBubble.addClass("hidden"):this.ui.notiBubble.removeClass("hidden")},renderInboxDropdown:function(){this.inboxPopView=s.request("messages:dropdown"),this.ui.inboxDropdown.append(this.inboxPopView.el),this.ui.inboxDropdown.on("click",function(e){e.stopPropagation(),e.preventDefault()});var e=this;this.listenTo(i,"navigate:messages:post navigate:messages",function(){e.ui.inboxDropdown.parent().removeClass("open").blur()})},renderNotiDropdown:function(){this.notifView=s.request("notifications:dropdown"),this.ui.notiDropdown.append(this.notifView.el),this.ui.notiDropdown.on("click",function(e){e.stopPropagation(),e.preventDefault()});var e=this;this.listenTo(i,"notifications:click",function(){e.ui.notiDropdown.parent().removeClass("open").blur()})},onPostsClick:function(){i.trigger("navigate:account:posts")},onSettingsClick:function(){i.trigger("navigate:account:settings")},onBookmarkClick:function(){i.trigger("navigate:account:bookmarks")}});return a}),define("header/HeaderController",["jquery","marionette","vent","reqres","header/DefaultHeaderView","header/LoggedInHeaderView","header/CanvasHeaderView"],function(e,t,n,r,i,s,o){var u=t.Controller.extend({initialize:function(){this.header=null},updateHeaderView:function(){is_canvas?this.showCanvasHeader():r.request("isLoggedIn")?this.showLoggedinHeader():this.showDefaultHeader()},showDefaultHeader:function(){this.header=new i({collection:r.request("categories")}),n.trigger("headerRegion:show",this.header),n.trigger("flash:always-alert:close"),this.header.registerSearch()},showLoggedinHeader:function(){this.header=new s({collection:r.request("categories"),user:r.request("currentUser")});var t=function(){n.trigger("flash:always-alert",{type:"info",msg:"We temporarily added you in the <a href='#' data-navigate='settings:groups'>UCLA group</a>, please <a href='#' data-navigate='settings:emails'>add and verify a valid ucla.edu email</a> to remain in it!"},{timer:!1})};console.log(),r.request("currentUser").get("ucla_temp")?(console.log("NOOOOO"),n.trigger("show:addVerifyEmail:modal")):r.request("currentUser").checkUCLAVerified({success:function(e){e.data?n.trigger("close:modal"):n.trigger("show:addVerifyEmail:modal")},error:function(e){console.log(e.responseText)}}),n.trigger("headerRegion:show",this.header),this.header.registerSearch(),e(".navbar-collapse").on("shown.bs.collapse",function(){})},showCanvasHeader:function(){this.header=new o({user:r.request("currentUser")}),n.trigger("headerRegion:show",this.header),n.trigger("flash:always-alert:close")}}),a=new u;return a.listenTo(n,"app:start:auth:done",function(e){a.updateHeaderView(),a.listenTo(r.request("session"),"change:logged_in",function(e){a.updateHeaderView()})}),a.listenTo(n,"messages:updateCount",function(e){r.request("isLoggedIn")&&a.header.updateInboxCount&&a.header.updateInboxCount(e)}),a.listenTo(n,"notifications:updateCount",function(e){r.request("isLoggedIn")&&a.header.updateNotiCount&&a.header.updateNotiCount(e)}),u}),define("text!auth/tpl-login-page.html",[],function(){return'<div class="signup-content auth-dialog-content">\n\n   <a href="#" id="fb-login-btn" class="btn btn-lg btn-primary btn-block" data-loading-text="Loading Facebook...">Log in with Facebook</a>\n   <div class="signup-or-separator">\n      <h5 class="special-text">or</h5>\n      <hr>\n   </div>\n   \n   \n   <div id=\'login-form\'></div>\n   <p>\n      <a id="forgot-password-link" href="/forgot_password">Forgot Password?</a>\n   </p>\n   <a href="#" id="login-btn" class="btn btn-lg btn-primary btn-block">Log In</a>\n\n \n   <hr>\n   <p class=\'text-center\'>\n      Don\'t have an account? <a class=\'signup-link\' href=\'/signup\'>Sign up</a>\n   </p>\n\n</div>\n   \n'}),define("auth/AuthForms",["backbone","backbone-forms","bbf-bootstrap3"],function(e){var t=e.Form.fullColumnTpl,n=e.Form.halfColumnTpl,r=4,i=6,s={title:"Username",type:"Text",editorAttrs:{placeholder:"Username"},template:t,validators:["required",function(t,n){var i={type:"user_name"};if(t.length<r)return i.message="Username must be at least 4 characters long",i;if(!/^[a-zA-Z0-9]*$/.test(t.trim()))return i.message="Username can only contain letters and numbers",i}]},o=["required",function(t,n){if(t.length<i)return{type:"password",message:"Password must be at least 6 characters long"}}],u=new e.Form({schema:{first_name:{title:"First name",type:"Text",validators:["required"],editorAttrs:{placeholder:"First Name"},template:n},last_name:{title:"Last name",type:"Text",validators:["required"],editorAttrs:{placeholder:"Last Name"},template:n},user_name:s,email:{type:"Text",validators:["required","email"],editorAttrs:{placeholder:"Email Address"},template:t},password:{type:"Password",validators:o,editorAttrs:{placeholder:"Password"},template:t},confirm:{type:"Password",editorAttrs:{placeholder:"Confirm Password"},template:t,validators:["required",{type:"match",field:"password",message:"Passwords must match!"}]}},idPrefix:"input-"}),a=new e.Form({schema:{login:{title:"Username",type:"Text",validators:["required"],editorAttrs:{placeholder:"Username"},template:t},password:{title:"Password",type:"Password",validators:o,editorAttrs:{placeholder:"Password"},template:t}},idPrefix:"input-"}),f=new e.Form({schema:{user_name:s},idPrefix:"input-"}),l=new e.Form({schema:{user_name:s,email:{type:"Text",validators:["required","email"],editorAttrs:{placeholder:"Enter Email"},template:t}},idPrefix:"input-"}),c=new e.Form({schema:{email:{type:"Text",validators:["required","email"],editorAttrs:{placeholder:"Enter Email"},template:t}},idPrefix:"input-"}),h=new e.Form({schema:{old_password:{title:"Password",type:"Password",validators:["required"],editorAttrs:{placeholder:"Current Password"},template:t},password:{type:"Password",validators:o,title:"New Password",editorAttrs:{placeholder:"New Password"},template:t},confirm:{type:"Password",editorAttrs:{placeholder:"Re-enter Password"},validators:["required",{type:"match",field:"password",message:"Passwords must match!"}],template:t}},idPrefix:"input-"}),p=new e.Form({schema:{password:{type:"Password",validators:o,title:"New Password",editorAttrs:{placeholder:"Password"},template:t},confirm:{type:"Password",editorAttrs:{placeholder:"Re-enter Password"},validators:["required",{type:"match",field:"password",message:"Passwords must match!"}],template:t}},idPrefix:"input-"});return{SignupForm:u,LoginForm:a,FBSignupForm:f,EmailForm:c,NewPasswordForm:p,ResetPasswordForm:h,FBSignupFormWithEmail:l}}),define("auth/LoginPageView",["backbone","marionette","underscore","vent","reqres","text!auth/tpl-login-page.html","auth/AuthForms"],function(e,t,n,r,i,s,o){var u=t.ItemView.extend({template:s,initialize:function(){},ui:{loginForm:"#login-form",passwordForm:"#input-password",FBLoginBtn:"#fb-login-btn",loginBtn:"#login-btn"},onRender:function(){this.form=o.LoginForm.render(),this.ui.loginForm.append(this.form.el);var e=this;setTimeout(function(){e.form.focus()},1)},events:{"click @ui.loginBtn":"onLoginAttempt","click @ui.FBLoginBtn":"onFBLoginAttempt","click #forgot-password-link":"onForgotPassword",keyup:"onKeyUp","click .signup-link":"onSignupClick"},onKeyUp:function(e){var t=e.keyCode||e.which,n=13;e.preventDefault(),t==n&&this.onLoginAttempt()},onLoginAttempt:function(e){var t=this.form.validate();this.form.on("login:change password:change",function(e,t){e.fields[t.key].validate()});if(t)return;this.ui.loginBtn.button("loading");var n=this;r.trigger("auth:loginAttempt",{login:this.form.getValue("login"),password:this.form.getValue("password")},function(){n.ui.loginBtn.button("reset")})},onFBLoginAttempt:function(){this.ui.FBLoginBtn.button("loading");var e=i.request("FB"),t=this;e.login(function(n){n.status==="connected"&&e.api("/me",function(e){r.trigger("auth:FBLoginAttempt",e,function(){t.ui.FBLoginBtn.button("reset")})})},{scope:"public_profile,email,user_friends, user_groups"})},onForgotPassword:function(){r.trigger("navigate:forgotPassword")},onSignupClick:function(){r.trigger("navigate:signup")}});return u}),define("text!auth/tpl-signup-page.html",[],function(){return"<div class='signup-content auth-dialog-content'>\n   <form method='post' class=\"form-horizontal \" role=\"form\">\n      \n      <button id='fb-signup-btn' class=\"btn btn-lg btn-primary btn-block\" type=\"submit\" data-loading-text=\"Loading Facebook...\">Sign up using Facebook</button>\n      \n   </form>\n   <div class=\"signup-or-separator\">\n      <h5 class=\"special-text\">or</h5>\n      <hr>\n   </div>\n   \n   <div class='text-center signup-using-email'>\n      <a href='#'><h4>Sign up with Email</h4></a>\n   </div>\n\n   <div id='signup-form'>\n   \n   </div>\n   <p class='text-center'><small>\n      By signing up, I agree to the\n      <a data-bypass href='/about/legal/terms' target=\"_blank\">Terms of Service</a>.\n   </small></p>\n   <a href=\"#\" id=\"signup-btn\" class=\"btn btn-lg btn-primary btn-block\">Signup</a>\n\n   \n   <hr>\n   <p class='text-center'>\n      Already a member? <a class='go-login-link' href='/login'>Log in</a>\n   </p>\n</div>\n"}),define("auth/SignupPageView",["backbone","jquery","underscore","marionette","vent","reqres","text!auth/tpl-signup-page.html","auth/AuthForms"],function(e,t,n,r,i,s,o,u){var a=r.ItemView.extend({template:o,events:{"click @ui.signupBtn":"onSignupAttempt","click @ui.FBSignupBtn":"onFBSignupAttempt",keyup:"onKeyUp","click @ui.usingEmailBtn":"onUsingEmailClick","click .go-login-link":"onLoginClick"},ui:{signupForm:"#signup-form",signupBtn:"#signup-btn",FBSignupBtn:"#fb-signup-btn",usingEmailBtn:".signup-using-email"},onRender:function(){this.form=u.SignupForm.render(),this.ui.usingEmailBtn.hide(),this.ui.signupForm.append(this.form.el);var e=this;setTimeout(function(){e.form.focus()},1)},onKeyUp:function(e){var t=e.keyCode||e.which,n=13;e.preventDefault(),t==n&&this.onSignupAttempt()},onSignupAttempt:function(){var e=this.form.validate();this.form.on("change",function(e,t){e.validate()});if(e)return;var t=this.form.getValue();this.ui.signupBtn.button("loading");var n=this;i.trigger("auth:signupAttempt",t,function(){n.ui.signupBtn.button("reset")})},onFBSignupAttempt:function(){var e=this;this.ui.FBSignupBtn.button("loading");var t=s.request("FB");t.login(function(n){n.status==="connected"?t.api("/me",function(t){i.trigger("auth:FBSignupCheck",t,function(){e.ui.FBSignupBtn.button("reset")})}):e.ui.FBSignupBtn.button("reset")},{scope:"public_profile,email,user_friends, user_groups"})},onUsingEmailClick:function(){},onLoginClick:function(){i.trigger("navigate:login")}});return a}),define("text!auth/tpl-fb-signup-page.html",[],function(){return"<div class='fb-signup-content auth-dialog-content'>\n\n\n   <h4>Hi {{first_name}}, you're almost done!</h4>\n   <p>Before we sign you up, we want you to pick a <i>username</i>. It must be unique and cannot be changed so choose wisely!</p>\n   <p class='email-required-too hide'>*We can't get your <i>email</i> from Facebook, please put  your email down below as well! Thanks!</p>\n   <hr>\n   <div id='signup-form-wrapper'>\n      <div class='fb-signup-form'>\n      \n      </div>\n      <a href=\"#\" id=\"fb-singup-btn\" class=\"btn btn-lg btn-primary btn-block\">Okay</a>\n   <div id='signup-form-wrapper'>\n      \n</div>\n"}),define("auth/FBSignupPageView",["jquery","underscore","marionette","app","vent","reqres","text!auth/tpl-fb-signup-page.html","auth/AuthForms"],function(e,t,n,r,i,s,o,u){var a=n.ItemView.extend({template:o,events:{"click @ui.FBSignupBtn":"onFinishFBSignupAttempt","keypress .form-group input":"onKeyPress","keydown .form-group input":"onKeyPress"},initialize:function(e){this.data=e.data,this.process=!1},serializeData:function(){return{first_name:this.data.first_name}},ui:{signupForm:".fb-signup-form",FBSignupBtn:"#fb-singup-btn"},onRender:function(){this.data.email?this.form=u.FBSignupForm.render():(this.form=u.FBSignupFormWithEmail.render(),this.$(".email-required-too").removeClass("hide")),this.ui.signupForm.append(this.form.el);var e=this;setTimeout(function(){e.form.focus()},1)},onKeyPress:function(e){var t=e.keyCode||e.which;if(t==13)return e.preventDefault(),this.onFinishFBSignupAttempt(),!1},onFinishFBSignupAttempt:function(){if(this.process)return;var e=this.form.validate();this.form.on("change",function(e,t){e.validate()});if(e)return;var t=this.form.getValue();this.data.email&&(t.email=this.data.email),this.process=!0,this.ui.FBSignupBtn.button("loading");var n=this;i.trigger("auth:FBsignupAttempt",t,function(){n.process=!1,n.ui.FBSignupBtn.button("reset")})}});return a}),define("text!auth/tpl-forgot-password-page.html",[],function(){return'<div class="forgot-password-content auth-dialog-content">\n   <h3>Reset Password</h3>\n   <hr>\n   <p>Type your primary email address, and we\'ll email you a link to reset your password.</p>\n   <div id=\'email-form\'></div>\n   <a href="#" id="send-email-btn" class="btn btn-lg btn-primary btn-block">Send Email</a>\n</div>\n'}),define("auth/ForgotPasswordPageView",["marionette","vent","reqres","text!auth/tpl-forgot-password-page.html","auth/AuthForms"],function(e,t,n,r,i){var s=e.ItemView.extend({template:r,initialize:function(){},ui:{emailForm:"#email-form",sendBtn:"#send-email-btn"},onRender:function(){this.form=i.EmailForm.render(),this.ui.emailForm.append(this.form.el)},events:{"click @ui.sendBtn":"onSendEmailAttempt",keyup:"onKeyUp"},onKeyUp:function(e){var t=e.keyCode||e.which,n=13;e.preventDefault(),t==n&&this.onSendEmailAttempt()},onSendEmailAttempt:function(){var e=this.form.validate();this.form.on("change",function(e,t){e.validate()});if(e)return;var r=this;this.ui.sendBtn.button("loading"),n.request("session").forgotPassword(this.form.getValue(),{success:function(e){t.trigger("close:modal"),t.trigger("navigate:home"),t.trigger("flash:alert",{type:"success",msg:e})},error:function(e){t.trigger("flash:alert",{type:"error",msg:e.responseText}),r.ui.sendBtn.button("reset")}})}});return s}),define("text!auth/tpl-reset-password-page.html",[],function(){return'<div class="auth-dialog-content">\n   <h3>Reset Password</h3>\n   <h5>Type in new password for your account</h5>\n   <div id=\'password-form\'></div>\n   <a href="#" id="change-btn" class="btn btn-lg btn-primary btn-block">Change Password</a>\n\n</div>\n'}),define("auth/ResetPasswordPageView",["marionette","vent","reqres","text!auth/tpl-reset-password-page.html","auth/AuthForms"],function(e,t,n,r,i){var s=e.ItemView.extend({template:r,initialize:function(e){e=e||{fromVerifyEmail:!0},this.user=n.request("currentUser"),this.fromVerifyEmail=e.fromVerifyEmail,console.log(this.fromVerifyEmail)},ui:{passwordForm:"#password-form",changeBtn:"#change-btn"},onRender:function(){this.user.get("fb_only")==="true"?this.form=i.NewPasswordForm.render():this.form=i.ResetPasswordForm.render(),this.ui.passwordForm.append(this.form.el),t.trigger("close:modal")},events:{"click @ui.changeBtn":"onResetPasswordAttempt",keyup:"onKeyUp"},onKeyUp:function(e){var t=e.keyCode||e.which,n=13;e.preventDefault(),t==n&&this.onResetPasswordAttempt()},onResetPasswordAttempt:function(){var e=this.form.validate();this.form.on("change",function(e,t){e.validate()});if(e)return;var r=this;this.ui.changeBtn.button("loading"),this.fromVerifyEmail?n.request("session").verifyEmail(Backbone.history.location.search,this.form.getValue(),{success:function(e){t.trigger("navigate:login"),t.trigger("flash:alert",{type:"success",msg:e})},error:function(e){t.trigger("flash:alert",{type:"error",msg:e.responseText}),r.ui.changeBtn.button("reset")}}):n.request("session").updatePassword(this.form.getValue(),{success:function(e){t.trigger("close:modal"),t.trigger("global:flash:alert",{type:"success",msg:e}),r.user.get("fb_only")==="true"&&r.user.set({fb_only:"false"})},error:function(e){t.trigger("flash:alert",{type:"error",msg:e.responseText}),r.ui.changeBtn.button("reset")}})}});return s}),define("auth/AuthController",["backbone","marionette","vent","reqres","auth/LoginPageView","auth/SignupPageView","auth/FBSignupPageView","auth/ForgotPasswordPageView","auth/ResetPasswordPageView"],function(e,t,n,r,i,s,o,u,a){var f=t.Controller.extend({showLoginPage:function(){n.trigger("domChange:title",r.request("page:name").login),r.request("isLoggedIn")?n.trigger("navigate:search"):n.trigger("mainRegion:show",new i)},showSignupPage:function(){n.trigger("domChange:title",r.request("page:name").signup),r.request("isLoggedIn")?n.trigger("navigate:search"):n.trigger("mainRegion:show",new s)},showVerifyPage:function(t){n.trigger("domChange:title",r.request("page:name").verify);var i=e.history.location.search.split("&"),s=i[0].substring(8);s==r.request("CONSTANTS").RESET_PASSWORD?n.trigger("mainRegion:show",new a):r.request("session").verifyEmail(e.history.location.search,null,{success:function(e){n.trigger("navigate:emptyPage"),n.trigger("flash:alert",{type:"success",msg:e})},error:function(e){n.trigger("navigate:emptyPage"),n.trigger("flash:alert",{type:"error",msg:e.responseText})}})},showForgotPasswordPage:function(){n.trigger("domChange:title",r.request("page:name").forgotPass),r.request("session").get("logged_in")?n.trigger("navigate:search"):n.trigger("mainRegion:show",new u)},checkAuth:function(e){$("#authenticated_user").length&&typeof AUTHENTICATED_USER!="undefined"?(AUTHENTICATED_USER?(r.request("session").updateSessionUser(AUTHENTICATED_USER),r.request("currentUser").set({ucla_temp:UCLA_TEMP})):r.request("session").clearSessionUser(),e&&e(),$("#authenticated_user").remove()):r.request("session").checkAuth({complete:function(){e&&e()}})},logoutAttempt:function(){r.request("session").logout({},{success:function(e){n.trigger("navigate:home")}})},loginAttempt:function(e,t,i){r.request("session").login(e,t,{success:function(e){var t=r.request("session").getCurrentUser().get("circles");t.length>0&&n.trigger("close:modal"),n.trigger("navigate:account:posts")},error:function(e){i&&i(),n.trigger("flash:alert",{type:"error",msg:e.responseText})}})},signupAttempt:function(e,t,i){var s=this;r.request("session").signup(e,t,{success:function(e){n.trigger("auth:checkAuth",function(){var e=r.request("session").getCurrentUser().get("circles");e.length>0&&n.trigger("close:modal"),n.trigger("navigate:account:posts")})},error:function(e){i&&i(),n.trigger("flash:alert",{type:"error",msg:e.responseText})}})},FBSignupCheck:function(e,t){var i;r.request("session").check_fb_id({fb_id:e.id},{success:function(e){i=e.data.status},error:function(e){i="error"}});if(i==="taken")return n.trigger("auth:FBLoginAttempt",e);if(i==="error")return n.trigger("flash:alert",{type:"error"});if(e.email){r.request("session").check_email({email:e.email},{success:function(e){i=e.data.status},error:function(e){i="error"}});if(i==="taken")return t&&t(),n.trigger("flash:alert",{type:"error",msg:"The email in your fb account is already registered by a user."});if(i==="error")return n.trigger("flash:alert",{type:"error"})}var e={first_name:e.first_name,email:e.email};n.trigger("open:modal",new o({data:e}),{dialogClass:"auth-dialog"})}}),l=new f;l.listenTo(n,"auth:FBSignupCheck",function(e,t){l.FBSignupCheck(e,t)}),l.listenTo(n,"auth:FBsignupAttempt",function(e,t){l.signupAttempt(e,"fb",t)}),l.listenTo(n,"auth:FBLoginAttempt",function(e,t){r.request("session").check_fb_id({fb_id:e.id},{success:function(e){status=e.data.status},error:function(e){status="error"}});if(status==="available")l.FBSignupCheck(e,t);else if(status==="error")return n.trigger("flash:alert",{type:"error"});status==="taken"&&l.loginAttempt({},"fb",t)}),l.listenTo(n,"auth:loginAttempt",function(e,t){l.loginAttempt(e,"normal",t)}),l.listenTo(n,"auth:logoutAttempt",function(e){l.logoutAttempt()}),l.listenTo(n,"auth:signupAttempt",function(e,t){l.signupAttempt(e,"normal",t)}),l.listenTo(n,"auth:checkAuth",function(e){l.checkAuth(e)});var c=function(e){return _.indexOf(["signup","login","forgot_password","session/verify"],e)!=-1},h={dialogClass:"auth-dialog",onShow:function(e){setTimeout(function(){e.options.content.form.focus()},1)}};return l.listenTo(n,"navigate:signup",function(){c(e.history.fragment)?(l.showSignupPage(),e.history.navigate("signup")):n.trigger("open:modal",new s,h)}),l.listenTo(n,"navigate:login",function(t){t=t||!1,t||c(e.history.fragment)?(l.showLoginPage(),e.history.navigate("login")):n.trigger("open:modal",new i,h)}),l.listenTo(n,"navigate:forgotPassword",function(){c(e.history.fragment)?(l.showForgotPasswordPage(),e.history.navigate("forgot_password")):n.trigger("open:modal",new u,h)}),l}),define("posts/PostModel",["reqres"],function(e){var t=function(t){var n;return t.is_fb()?n="/fb/":n="/us/",e.request("api").bookmarks+n+t.id},n=Backbone.Model.extend({urlRoot:function(){return e.request("api").search+"/"+this.user_name},initialize:function(e){this.user_name=e.user_name}}),r=Backbone.Model.extend({modalMode:!1,urlRoot:function(){return e.request("api").posts},initialize:function(e){!this.is_fb()&&!_.isUndefined(e)&&this.put_primary_in_front(e)},put_primary_in_front:function(e){var t=_.find(e.images,function(e){return e.is_primary==1}),n=_.filter(e.images,function(e){return e.is_primary==0});n.unshift(t),this.set({images:n})},imgSelected:null,selectPrevImage:function(){var e=this.imgSelected-1;e<0&&(e=this.getImagesLength()-1),this.selectImage(e)},getImagesLength:function(){return this.get("images").length},selectNextImage:function(){var e=this.imgSelected+1;e>=this.getImagesLength()&&(e=0),this.selectImage(e)},selectImage:function(e){if(!this.has("images")||!(e in this.get("images")))return!1;this.imgSelected=parseInt(e),this.trigger("change:imgSelected")},getSelectedImageSrc:function(e){return e=e||!1,e?this.is_fb()?this.get("images")[this.imgSelected].link:this.get("images")[this.imgSelected].thumbnail:this.get("images")[this.imgSelected].link},toggleStatus:function(e){var t={};return this.get("status")=="active"?t.status_code=2:this.get("status")=="inactive"&&(t.status_code=0),this.save(t,{patch:!0,wait:!0,url:this.urlRoot()+"/"+this.id+"/status"})},getBookmarkStatus:function(){var e=this.get("is_bookmarked");if(_.isBoolean(e))return e;var n={url:t(this),method:"GET"},r=this;return this.ajax(null,n).done(function(e){r.set({is_bookmarked:e.data.has_bookmarked})}),null},bookmark:function(e){if(!this.get("is_bookmarked")){this.set({is_bookmarked:!0});var n={url:t(this),method:"POST"},r=this;return this.ajax(null,n).fail(function(e){r.set({is_bookmarked:!1})})}},unbookmark:function(e){if(this.get("is_bookmarked")){this.set({is_bookmarked:!1});var n={url:t(this),method:"DELETE"},r=this;return this.ajax(null,n).fail(function(e){r.set({is_bookmarked:!0})})}},is_active:function(){return this.is_fb()?!0:this.get("status")=="active"},is_fb:function(){return this.get("src")=="fb"},is_owner:function(){return this.is_fb()?!1:this.get("user")?this.get("user").user_name===e.request("currentUser").get("user_name"):!1},toJSON:function(){return _.extend({},this.attributes,{is_selling:this.is_active(),modalMode:this.modalMode,is_owner:this.is_owner()})}}),i=Backbone.Collection.extend({model:r,initialize:function(){this.setElement(this.at(0)),this.strategy==="sellingFirst"},url:function(){return e.request("api").posts},byStatus:function(e){var t=this.filter(function(t){return t.get("status")===e});return new i(t)},getElement:function(){return this.currentElement},setElement:function(e){this.currentElement=e},next:function(){var e=this.indexOf(this.getElement())+1;return e>=this.length&&(e=0),this.at(e)},prev:function(){var e=this.indexOf(this.getElement())-1;return e<0&&(e=this.length-1),this.at(e)}}),s=Backbone.Model.extend({initialize:function(e){},getPosts:function(t){var n={url:e.request("api").posts+"/subscribe",method:"GET"};this.ajax(null,n,t)}}),o=Backbone.Model.extend({getPosts:function(){var t={url:e.request("api").bookmarks,method:"GET"};return this.ajax(null,t)}});return{model:r,UserPostModel:n,subscribe:s,bookmark:o,collection:i}}),define("buy_requests/BuyRequestModel",["reqres"],function(e){var t=Backbone.Model.extend({urlRoot:function(){return e.request("api").buy_requests},initialize:function(e){},toggleStatus:function(e){var t={};return this.get("status")=="active"?t.status_code=2:this.get("status")=="inactive"&&(t.status_code=0),this.save(t,{patch:!0,wait:!0,url:this.urlRoot()+"/"+this.id+"/status"})},is_active:function(){return this.get("status")=="active"},is_fb:function(){return this.get("src")==="fb"},is_owner:function(){return this.is_fb()?!1:this.get("user")?this.get("user").user_name===e.request("currentUser").get("user_name"):!1},toJSON:function(){return _.extend({},this.attributes,{is_owner:this.is_owner()})}}),n=Backbone.Collection.extend({model:t,url:function(){return e.request("api").buy_requests}});return{model:t,collection:n}}),define("search/SearchModel",["underscore","reqres"],function(e,t){var n=["date-desc","price-asc","price-desc"],r=["all","today","this-week","this-month"],i=["sell","buy"],s=["all","fb","us"],o={hashtag:null,name:null,page:1,order:"date-desc",from:"all",user_name:null,status:0,type:"sell",src:"all"},u=Backbone.Model.extend({filterArgs:function(t){var u=e.object(e.map(o,function(e,n){return n in t?[n,t[n]]:[n,o[n]]}));return e.indexOf(n,u["order"])==-1&&(u.order=o.order),e.indexOf(r,u["from"])==-1&&(u.from=o.from),e.indexOf(i,u["type"])==-1&&(u.type=o.type),e.indexOf(s,u["src"])==-1&&(u.src=o.src),u.page=parseInt(u.page),e.isNaN(u.page)&&(u.page=o.page),u.type==="buy"&&(u.order=o.order),u},initialize:function(e,t){this.args=this.filterArgs(t),this.circle=e,this.isLoading=!1},createHistoryUrl:function(){return e.compact(e.map(this.args,function(t,n){if(!e.isNull(t)&&o[n]!=t)return n+"="+t}))},url:function(){var e=this.createHistoryUrl();return e.push("circle="+this.circle),t.request("api").search+"?"+e.join("&")},getPosts:function(e){var t={url:this.url(),method:"GET"};this.isLoading=!0;var n=this;return this.ajax(null,t,e).always(function(){n.isLoading=!1})},updateArgs:function(t,o){t==="order"&&e.indexOf(n,o)>-1&&(this.args.order=o),t==="from"&&e.indexOf(r,o)>-1&&(this.args.from=o),t==="type"&&e.indexOf(i,o)>-1&&(this.args.type=o),t==="src"&&e.indexOf(s,o)>-1&&(this.args.src=o)},toJSON:function(){return{circle:this.circle.toUpperCase(),q:""}},loadNextPage:function(){return this.args.page+=1,this.getPosts()}});return u}),define("text!posts/templates/tpl-post-list-item.html",[],function(){return'<div class="post-list-item-padding">\n<div class=\'post-list-item-wrap\'>\n\n   {{#if_eq src \'fb\'}}\n   <div class="post-list-item fb-post" data-content="{{description}}">\n      <a class="post-list-item-img-wrap" href="https://www.facebook.com/{{feed_id}}" >\n         <img class=\'list-item-img\' data-src="{{images.0.link}}">\n         \n      </a>\n      <a href="#" class="post-list-item-control list-item-prev"><span class="fui-arrow-left"></span></a>\n      <a href="#" class="post-list-item-control list-item-next"><span class="fui-arrow-right"></span></a>\n      <!--<a href="#" class="post-list-item-control list-item-bookmark"><span class="glyphicon glyphicon-star"></span></a>!-->\n   </div>   \n   <div class="post-description">\n      <div class="item-source">\n         <a href="https://www.facebook.com/{{feed_id}}" data-bypass target="_blank"><span class="fui-facebook"></span> View on Facebook</a>\n      </div>\n      <div class=\'item-price\'>{{showPrice price}}</div>  \n   </div>\n   {{else}}\n   <div class="post-list-item normal-post" data-content="{{description}}">\n      {{#unless is_selling}}\n         <div class="ribbon ribbon-red"><span>Sold Out</span></div>\n      {{/unless}}\n   \n      <a class="post-list-item-img-wrap" href="/posts/{{id}}">\n         {{#if images.0.link}}\n            <img class=\'list-item-img\' data-src="{{images.0.thumbnail}}">\n         {{else}}\n            <img class=\'list-item-img\' data-src="/static/img/thumb.svg">\n         {{/if}}\n        \n         <!--<div class=\'hover-mask hover-mask-animate\'></div>!-->\n      </a>\n      <a href="#" class="post-list-item-control list-item-prev"><span class="fui-arrow-left"></span></a>\n      <a href="#" class="post-list-item-control list-item-next"><span class="fui-arrow-right"></span></a>\n      <!--<a href="#" class="post-list-item-control list-item-bookmark"><span class="glyphicon glyphicon-star"></span></a>!-->\n      {{#if is_owner}}\n         <a href="#" class="post-list-item-control list-item-edit"><span class="glyphicon glyphicon-pencil"></span></a>\n         <a href="#" class="post-list-item-control list-item-delete"><span class="fui-trash"></span></a>\n      {{/if}}\n   </div>\n   <div class="post-description">\n      <div class="item-name"><a href="/posts/{{id}}">{{name}}</a></div>\n      <div class=\'item-price\'>{{showPrice price}}</div>\n   </div>\n   {{/if_eq}}\n</div>\n</div>\n'}),define("posts/templates/PostItemView",["underscore","handlebars","marionette","vent","posts/PostModel","text!posts/templates/tpl-post-list-item.html","jquery.unveil"],function(e,t,n,r,i,s){var o="From FB free&for sale",u=n.ItemView.extend({defaults:{imgRatio:5/4,unveilThreshold:1e3,debounce:60},template:s,tagName:"div",className:"col-xs-12 col-sm-6 col-md-4 col-lg-3 nopadding",initialize:function(e){this.listenTo(this.model,"change:imgSelected",this.changeMainImage),this.is_owner=e.is_owner||!1},events:{"click @ui.container":"onClick","click .item-name":"onNameClick","click .list-item-prev":"onPrevImgClick","click .list-item-next":"onNextImgClick","click .list-item-edit":"onEditClick","click .list-item-delete":"onDeleteClick"},ui:{container:".post-list-item",imgLink:".post-list-item a",img:".post-list-item .list-item-img"},onRender:function(){this.ui.container.popover({placement:function(e,t){var n=$(t).offset().top-window.scrollY;return n>110?"top":"bottom"},trigger:"hover",html:!0,container:this.ui.container,animation:!0}),this.model.getImagesLength()<=1&&this.$(".list-item-next, .list-item-prev").addClass("hide"),this.model.imgSelected=0},onShow:function(){this.ui.img.on("unveil",e.bind(this.onLoad,this)).unveil({threshold:this.defaults.unveilThreshold,debounce:this.defaults.debounce})},onLoad:function(){var e=this;this.ui.img.load(function(){e.updateCSS(),this.style.opacity=1,this.style.border=0}).bind("error",function(){console.log("[INFO] image did not load. "+e.model.get("feed_id"))})},updateCSS:function(){var e=this.ui.img.height(),t=this.ui.img.width();t/e<this.defaults.imgRatio?this.ui.container.removeClass("landscape").addClass("portrait"):this.ui.container.removeClass("portrait").addClass("landscape")},onClick:function(e){$(e.target).attr("class")==="list-item-img"&&r.trigger("open:modal:post",this.model)},changeMainImage:function(e){this.ui.container.find("img").attr("src",this.model.getSelectedImageSrc(!0)),this.updateCSS()},onNameClick:function(){r.trigger("navigate:posts:item",this.model.id)},onPrevImgClick:function(){this.model.selectPrevImage()},onNextImgClick:function(){this.model.selectNextImage()},beforeDestroy:function(){this.stopListening()},onEditClick:function(){r.trigger("navigate:posts:edit",this.model.id)},onDeleteClick:function(){r.trigger("posts:deleteAttempt",this.model)}});return u}),define("posts/templates/PostListView",["marionette","vent","posts/PostModel","posts/templates/PostItemView"],function(e,t,n,r){var i=Backbone.Marionette.ItemView.extend({template:"<p>No posts.</p>"}),s=Backbone.Marionette.ItemView.extend({template:'<a class="create-new">                   <span class="glyphicon glyphicon-plus"></span>                </a>',events:{"click .create-new":function(){t.trigger("navigate:createPost")}},onRender:function(){this.$(".create-new").attr("title","Sell an item!").tooltip({placement:"bottom"})}}),o=e.CollectionView.extend({id:"post-list-wrapper",childView:r,getEmptyView:function(){return this.is_owner?s:i},childViewOptions:function(){return{is_owner:this.is_owner}},initialize:function(e){this.is_owner=e.is_owner||!1},onDestroy:function(){$(window).off("resize.unveil scroll.unveil lookup.unveil")}});return o}),define("templates/TimeagoView",["marionette","vent"],function(e,t){var n=e.ItemView.extend({template:'<span class="timeago" title="{{time}}"></span>',serializeData:function(){return{time:this.time}},tagName:"span",ui:{timeago:".timeago"},initialize:function(e){this.time=e.time,this.showTooltip=e.showTooltip||!1},onRender:function(){this.ui.timeago.timeago();if(this.showTooltip){var e=this.ui.timeago.attr("title");e=(new Date(e)).toLocaleDateString(),this.ui.timeago.attr("title",e).tooltip({placement:"bottom"})}},onBeforeDestroy:function(){this.ui.timeago.timeago("dispose")}});return n}),define("templates/HashtagsView",["marionette","vent"],function(e,t){var n='{{#each hashtags}}                        <a href="/ucla?hashtag={{this.name}}">                           <span class="hashtag-link" data-value="{{this.name}}">#{{this.name}}</span>                        </a>                    {{/each}}',r=e.ItemView.extend({template:n,events:{"click .hashtag-link":"onHashtagClick"},serializeData:function(){return{hashtags:this.hashtags}},initialize:function(e){this.hashtags=e.hashtags,this.modalMode=e.modalMode||!1},onHashtagClick:function(e){if(is_canvas)return;this.modalMode&&t.trigger("close:modal");var n=$(e.target).data("value");t.trigger("navigate:search:hashtag","ucla",null,n)}});return r}),define("text!buy_requests/templates/tpl-buy-request-list-item.html",[],function(){return'<div class=\'row \'>\n   <div class=\'col-xs-12 col-md-9\'>\n      <div class=\'buy-request-description\'>\n         <p><b>{{name}}</b><br>{{description}}</p>\n      </div>\n      <div class=\'hashtags-region\'></div>\n      <div class=\'timeago-region\'></div>\n   </div>\n   \n   {{#if_eq src \'fb\'}}\n      <div class=\'col-xs-12 col-md-3 buy-request-action\'>\n         <a href="https://www.facebook.com/{{feed_id}}" data-bypass target="_blank">\n            <span class="fui-facebook"></span> View on Facebook\n         </a>\n      </div>\n      \n   {{else}}\n      <div class=\'col-xs-12 col-md-3 buy-request-action\'>\n         {{#if is_owner}}\n            <a class="dropdown-toggle buy-request-edit" data-toggle="dropdown" href="#">\n               <span class="glyphicon glyphicon-pencil"></span> Edit post<span class="caret"></span>\n            </a>\n            <ul class="dropdown-menu no-transition dropdown-action">\n               <li><a href="/buy_requests/{{id}}/edit" id="edit-btn">Edit</a></li>\n               <li><a href="#" id="toggle-status-btn"></a></li>\n               <li><a href="#" id="delete-btn">Delete</a></li>\n            </ul>\n            \n        {{else}}\n            <a href="#" class=\'contact-owner\'>\n               <span class="fui-mail"></span> Contact\n            </a>\n         {{/if}}\n      </div>\n     \n      \n   \n   {{/if_eq}}\n</div>\n<hr>'}),define("buy_requests/templates/BuyRequestItemView",["marionette","vent","templates/TimeagoView","buy_requests/BuyRequestModel","templates/HashtagsView","text!buy_requests/templates/tpl-buy-request-list-item.html"],function(e,t,n,r,i,s){var o=e.LayoutView.extend({template:s,initialize:function(e){this.listenTo(this.model,"change:status",this.renderStatus,this)},ui:{toggleStatusBtn:"#toggle-status-btn"},regions:{timeago:".timeago-region",hashtags:".hashtags-region"},onRender:function(){this.renderStatus(),this.timeago.show(new n({time:this.model.get("created_at"),showTooltip:!0})),this.hashtags.show(new i({hashtags:this.model.get("hashtags")}))},renderStatus:function(){this.model.is_active()?this.ui.toggleStatusBtn.text("Set to Bought"):this.ui.toggleStatusBtn.text("Set to Buying")},events:{"click #edit-btn":"onEditClick","click #delete-btn":"onDeleteClick","click .contact-owner":"onContactClick","click @ui.toggleStatusBtn":"onToggleStatusClick"},onEditClick:function(){t.trigger("navigate:buyRequests:edit",this.model.id)},onDeleteClick:function(){t.trigger("buyRequests:deleteAttempt",this.model)},onContactClick:function(){t.trigger("messages:contactSeller",this.model)},onToggleStatusClick:function(){this.model.toggleStatus()}});return o}),define("buy_requests/templates/BuyRequestListView",["marionette","vent","buy_requests/BuyRequestModel","buy_requests/templates/BuyRequestItemView"],function(e,t,n,r){var i=Backbone.Marionette.ItemView.extend({template:"<p>No buy requests...</p>"}),s=Backbone.Marionette.ItemView.extend({template:'<a class="create-new">                   <span class="glyphicon glyphicon-plus"></span>                </a>',events:{"click .create-new":function(){t.trigger("navigate:createBuyRequest")}},onRender:function(){this.$(".create-new").attr("title","Looking for an item?").tooltip({placement:"bottom"})}}),o=e.CompositeView.extend({template:'<div class="request-list-wrapper col-xs-12"></div>',childView:r,emptyView:i,childViewContainer:".request-list-wrapper",getEmptyView:function(){return this.is_owner?s:i},initialize:function(e){this.is_owner=e.is_owner||!1}});return o}),define("text!posts/user/tpl-user-page-layout.html",[],function(){return'<div class="row user-page-header">\n   <div class="col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2 panel panel-default">\n     <div class="panel-body">\n        <div class = "row">\n           <div class="col-sm-4">\n              <img src="{{user.picture}}" alt="user image" class="img-circle myposts-user-picture">\n           </div>\n           <div class="col-sm-8">\n              <h3>{{user.user_name}}</h3>\n              <span class="edit-profile-link btn btn-primary">Edit Profile</span>\n           </div>\n        </div>\n     </div>\n   </div>\n</div>\n<div class="row">\n   Total of <span class="num-posts" class="badge"></span> Posts\n   <div class="btn-group btn-group-lg pull-right">\n      <button type="button" class="btn btn-primary post-tabs" data-tab-type="sell">Selling</button> \n      <button type="button" class="btn btn-primary post-tabs" data-tab-type="buy" >Wishlist</button>\n   </div>\n</div>\n\n<hr>\n<div class="post-wrap"></div>\n'}),define("posts/user/UserPostPageView",["marionette","vent","reqres","posts/PostModel","buy_requests/BuyRequestModel","search/SearchModel","posts/templates/PostListView","buy_requests/templates/BuyRequestListView","text!posts/user/tpl-user-page-layout.html"],function(e,t,n,r,i,s,o,u,a){var f=e.LayoutView.extend({template:a,serializeData:function(){return{user:this.user.toJSON()}},regions:{postWrapRegion:".post-wrap"},events:{"click @ui.postTabs":"onTabClick","click @ui.editProfileLink":function(){t.trigger("navigate:account:settings")}},ui:{postTabs:".post-tabs",numPosts:".num-posts",editProfileLink:".edit-profile-link"},initialize:function(e){e=e||{},this.user=e.user,this.is_owner=e.is_owner||!1,this.tab=e.tab||"sell",this.posts=new r.collection,this.buy_requests=new i.collection,this.setCollection(),this.hideHeader=e.hideHeader||!1},onRender:function(){this.hideHeader?this.$(".user-page-header").addClass("hide"):this.user.id!==n.request("currentUser").id&&this.ui.editProfileLink.remove()},updateData:function(){var e=(new s("ucla",{type:this.tab,user_name:this.user.get("user_name"),status:"all"})).getPosts(),n=this;t.trigger("region:deferredShow",this.postWrapRegion,e,{success:function(e){e.data.result=_.sortBy(e.data.result,function(e){return e.status}),n.collection.reset(e.data.result),n.updateView()},error:function(e){t.trigger("flash:alert",{type:"error",msg:e.responseText})}})},onTabClick:function(e){var t=$(e.target);if(t.hasClass("active"))return;this.tab=t.data("tab-type"),this.setCollection(),this.updateData(),this.ui.postTabs.removeClass("active"),t.addClass("active")},updateView:function(e){this.tab==="sell"?this.postWrapRegion.show(new o({collection:this.collection,hideHeader:this.hideHeader,is_owner:this.is_owner})):this.postWrapRegion.show(new u({collection:this.collection,is_owner:this.is_owner})),this.ui.numPosts.text(this.collection.length)},onShow:function(){this.updateData(),this.$("[data-tab-type="+this.tab+"]").addClass("active")},setCollection:function(){this.tab==="sell"?this.collection=this.posts:this.collection=this.buy_requests}});return f}),define("account/settings/EmailCollection",["reqres"],function(e){var t=Backbone.Model.extend({initialize:function(){},is_primary:function(){return this.get("is_primary")==1},is_verified:function(){return this.get("status")=="verified"},toggle_primary:function(){return this.set("is_primary",1-this.get("is_primary"))},sync:function(t,n,r){return t==="delete"&&(t="create",r.data=JSON.stringify(r.data),r.url=this.collection.url()+"/"+this.id+e.request("api").delete_email,r.contentType="application/json"),Backbone.sync(t,n,r)},set_primary:function(t){t.url=this.collection.url()+"/"+this.id+e.request("api").update_email,this.save({},t)},resend_verification:function(t){var n={url:e.request("api").emails+"/"+this.id+e.request("api").resend_verify,method:"GET"};this.ajax(null,n,t)}}),n=Backbone.Collection.extend({model:t,url:function(){return e.request("api").emails}});return n}),define("account/settings/CircleCollection",["reqres"],function(e){var t=Backbone.Model.extend({initialize:function(){},joinCircle:function(e){},leaveCircle:function(e){}}),n=Backbone.Collection.extend({model:t,initialize:function(){},url:function(){return e.request("api").circles}});return n}),define("text!general/tpl-flash-msg.html",[],function(){return'<div class="alert alert-{{type}} fade in">\n   <button id=\'close-flash-btn\' class="close" data-dismiss="alert">×</button>\n   {{{msg}}}\n</div>\n'}),define("general/FlashMessageView",["jquery","underscore","backbone","marionette","app","vent","text!general/tpl-flash-msg.html"],function(e,t,n,r,i,s,o){var u=r.ItemView.extend({template:o,initialize:function(e,t){this.type=e.type,this.type==="error"&&(this.type="danger"),this.msg=e.msg,this.opts=t},serializeData:function(){return{type:this.type,msg:this.msg}},events:{"click #close-flash-btn":"closeAlert"},closeAlert:function(){this.opts.type==="always"?s.trigger("flash:always-alert:close"):s.trigger("flash:close")}});return u}),define("account/settings/PasswordView",["marionette","app","vent","reqres","general/FlashMessageView","auth/ResetPasswordPageView","auth/AuthForms"],function(e,t,n,r,i,s,o){var u=e.ItemView.extend({template:'<span class="password-edit btn btn-primary"></span>',events:{"click @ui.passwordEdit":"onPasswordClick"},ui:{passwordEdit:".password-edit"},initialize:function(){this.user=r.request("currentUser"),this.listenTo(this.user,"change:fb_only",this.renderPassword)},onRender:function(){this.renderPassword()},renderPassword:function(){this.user.get("fb_only")==="true"?this.ui.passwordEdit.text("Setup Password"):this.ui.passwordEdit.text("Change Your Password")},onPasswordClick:function(){var e={dialogClass:"auth-dialog",onShow:function(e){setTimeout(function(){e.options.content.form.focus()},1)}};n.trigger("open:modal",new s({fromVerifyEmail:!1}),e)}});return u}),define("text!account/settings/tpl-profile.html",[],function(){return'<div class="panel panel-default">\n   <div class="panel-heading">\n      <h3 class="panel-title">Account Settings</h3>\n   </div>\n   \n   <div class="panel-body">\n      <class = "row">\n         <div class="col-md-10 col-md-offset-1">\n            <div class="row">   \n               <label class="col-sm-2 control-label">Name</label>   \n               <div class="col-sm-10">\n                  {{first_name}} {{last_name}}\n               </div>\n            </div>\n            <div class="row">   \n               <label class="col-sm-2 control-label">Email</label>   \n               <div class="col-sm-10">\n                  test@gmail.com\n               </div>\n            </div>\n            <div class="row">   \n               <label class="col-sm-2 control-label">Network</label>   \n               <div class="col-sm-10">\n                  UCLA\n               </div>\n            </div>\n            <a href="#" id="save-btn" class="btn btn-lg btn-primary btn-block">Save Changes</a>\n         </div>\n      </class>\n   </div>\n</div>\n'}),define("account/settings/ProfileView",["jquery","marionette","app","vent","reqres","text!account/settings/tpl-profile.html","backbone-forms","bbf-bootstrap3"],function(e,t,n,r,i,s){var o=new Backbone.Form({schema:{first_name:{type:"Text",validators:["required"],title:"First Name",editorAttrs:{placeholder:"First name"}},last_name:{type:"Text",validators:["required"],title:"Last Name",editorAttrs:{placeholder:"Last name"}}},data:{sex_code:1},idPrefix:"input-"}),u=t.ItemView.extend({template:s,initialize:function(e){this.form=o.render()},ui:{settingsForm:"#settings-form"},events:{"click #save-btn":"onSaveAttempt"},onRender:function(){this.ui.settingsForm.append(this.form.el),this.refreshData()},reset:function(){this.ui.picUploadBtn.removeClass("disabled").removeAttr("disabled").find("span").text("Change Picture")},onSaveAttempt:function(){var e=this.form.validate();this.form.on("change",function(e,t){e.validate()});if(e)return;r.trigger("account:saveSettingsAttempt",this.form.getValue())},refreshData:function(){this.form.setValue({first_name:this.model.get("first_name")}),this.form.setValue({last_name:this.model.get("last_name")})}});return u}),define("account/settings/FBAccountView",["marionette","app","vent","reqres"],function(e,t,n,r){var i=e.ItemView.extend({template:'<button id="fb-connect-btn" type="button" class="btn btn-default btn-primary "></button>                 <p><span class="fb-account-status"></span></p>',events:{"click #save-btn":"onSaveAttempt","click @ui.fbConnectBtn":"onFbClick"},ui:{fbConnectBtn:"#fb-connect-btn",fbStatus:".fb-account-status"},initialize:function(){this.user=r.request("currentUser")},onRender:function(){this.renderFB()},renderFB:function(){this.user.get("fb")==="connected"?(this.ui.fbStatus.text("You are linked to a Facebook account"),this.ui.fbConnectBtn.hide()):(this.ui.fbStatus.text("You are not linked to Facebook"),this.ui.fbConnectBtn.text("Connect"))},onFbClick:function(){var e=this;if(this.user.get("fb")==="connected")return;if(this.user.get("fb")==="connected"&&this.user.get("fb_only")==="true"){var t="You can't disconnect your facebook account unless you set up a password first.";return n.trigger("flash:alert",{type:"error",msg:t})}this.ui.fbConnectBtn.button("loading");var i=r.request("FB");this.user.get("fb")==="connected"?i.getLoginStatus(function(t){t.status==="connected"?e.revokeFBAttempt():i.login(function(t){t.status==="connected"?e.revokeFBAttempt():e.ui.fbConnectBtn.button("reset")})}):i.login(function(t){t.status==="connected"?e.FBLinkAttempt():e.ui.fbConnectBtn.button("reset")},{scope:"public_profile,email",auth_type:"rerequest"})},revokeFBAttempt:function(){var e=r.request("FB"),t=this;e.api("/me/permissions","delete",function(e){if(e!==!0)return t.ui.fbConnectBtn.button("reset"),n.trigger("flash:alert",{type:"error",msg:e.error.message});t.FBLinkAttempt()})},FBLinkAttempt:function(){var e=this;n.trigger("account:updateFBLinkAttempt",{success:function(){e.user.toggleFBStatus(),e.render()},complete:function(){e.ui.fbConnectBtn.button("reset")}})}});return i}),define("account/templates/AddEmailView",["marionette","app","vent","reqres","account/settings/EmailCollection","backbone-forms"],function(e,t,n,r,i){var s=e.ItemView.extend({template:'<span class="add-email-form"></span>',ui:{addEmailForm:".add-email-form"},events:{"keyup @ui.addEmailForm":"onKeyUp"},tagName:"span",initialize:function(e){e=e||{},this.preventOnEnter=e.preventOnEnter||!1,this.collection||(this.collection=new i);var t=new Backbone.Form({schema:{email:{type:"Text",validators:["required","email"],editorAttrs:{placeholder:"New Email"}}},idPrefix:"input-"});this.form=t.render()},onRender:function(){this.ui.addEmailForm.append(this.form.fields.email.editor.el)},onKeyUp:function(e){var t=e.keyCode||e.which;t==r.request("KEYS").ENTER&&!this.preventOnEnter&&(e.preventDefault(),this.addEmailFromInput())},addEmailFromInput:function(){var e=this.form.validate();if(e){n.trigger("flash:alert",{type:"error",msg:"Email: "+e.email.message});return}this.attemptCreateEmail(this.form.getValue())},attemptCreateEmail:function(e){this.form.setValue({email:""}),this.trigger("create:email:loading");var t=this;this.collection.create(e,{wait:!0,success:function(e,n){t.collection.add(e),t.form.setValue({email:"",password:""}),t.trigger("create:email:success",n)},error:function(e,t,r){n.trigger("flash:alert",{type:"error",msg:t.responseText})},complete:function(){t.trigger("create:email:finish")}})}});return s}),define("text!account/settings/tpl-emails.html",[],function(){return'<table class="table">\n<span class=\'email-list-region\'></span>\n</table>\n<hr>\n<a href="#" class="show-add-email-link"><h4><span class="glyphicon glyphicon-plus"></span>Add More Emails</h4></a>\n<div class=\'row add-email-wrap hide\'>\n   <div class="add-email-form-region col-xs-9"></div>\n   <div class="col-xs-3">\n      \n      <a id="add-email-btn" class="btn btn-md btn-primary">Add</a>\n   </div>\n</div>\n\n\n'}),define("text!account/settings/tpl-emails-item.html",[],function(){return"\n<td>{{address}} <span class='email-labels'></span></td>\n\n\n<td>\n   <span class='email-actions pull-right'>\n      \n      <a id='delete-btn' href='#'><span class=\"glyphicon glyphicon-trash\"></span></a>\n   </span>   \n   \n   \n</td>\n"}),define("account/settings/EmailsView",["marionette","app","vent","reqres","account/templates/AddEmailView","text!account/settings/tpl-emails.html","text!account/settings/tpl-emails-item.html"],function(e,t,n,r,i,s,o){var u=e.ItemView.extend({template:o,tagName:"tr",ui:{labels:".email-labels",actions:".email-actions"},constant:{primaryLabel:'<span class="label label-success">Primary</span>',unverifiedLabel:'<span class="label label-warning">Unverified</span>',verifiedLabel:'<span class="label label-info">Verified</span>',setPrimaryBtn:'<span id="set-primary-btn" class="btn btn-xs btn-default">Set to Primary</span>',setResendBtn:'<span id="resend-verify-btn" class="btn btn-xs btn-default">Resend Verify</span>'},events:{"click #delete-btn":"onDeleteClick","click #set-primary-btn":"onSetPrimaryClick","click #resend-verify-btn":"onResendVerifyClick"},initialize:function(){this.listenTo(this.model,"change",this.render,this)},onRender:function(){this.updatePrimary(),this.updateVerify()},updatePrimary:function(){this.model.is_primary()?this.ui.labels.append(this.constant.primaryLabel):this.ui.actions.prepend(this.constant.setPrimaryBtn)},updateVerify:function(){this.model.is_verified()?this.ui.labels.append(this.constant.verifiedLabel):(this.ui.labels.append(this.constant.unverifiedLabel),this.ui.actions.prepend(this.constant.setResendBtn))},onDeleteClick:function(){var e=confirm("Are you sure you want to remove this email? You may be removed from the group that you are authorized by with this email.");if(e==0)return;this.model.destroy({data:{},wait:!0,success:function(e,t){n.trigger("flash:alert",{type:"success",msg:t})},error:function(e,t){n.trigger("flash:alert",{type:"error",msg:t.responseText})}})},onSetPrimaryClick:function(){var e=this;this.model.set_primary({success:function(t,r){e.model.collection.fetch({reset:!0}),n.trigger("flash:alert",{type:"success",msg:r})},error:function(e,t){n.trigger("flash:alert",{type:"error",msg:t.message})}})},onResendVerifyClick:function(){this.model.resend_verification({success:function(e){n.trigger("flash:alert",{type:"success",msg:e})},error:function(e){n.trigger("flash:alert",{type:"error",msg:e.message})}})}}),a=e.CollectionView.extend({childView:u,tagName:"tbody"}),f=e.LayoutView.extend({template:s,childView:u,childViewContainer:"#email-list-wrapper",ui:{addEmailBtn:"#add-email-btn",showAddEmailLink:".show-add-email-link"},regions:{addEmailRegion:".add-email-form-region",emailListRegion:".email-list-region"},initialize:function(){this.addEmailView=new i({collection:this.collection});var e=this;this.listenTo(this.addEmailView,"create:email:loading",function(){e.ui.addEmailBtn.button("loading")}),this.listenTo(this.addEmailView,"create:email:finish",function(){e.ui.addEmailBtn.button("reset")}),this.listenTo(this.addEmailView,"create:email:success",function(e){n.trigger("flash:alert",{type:"success",msg:e})})},onRender:function(){this.addEmailRegion.show(this.addEmailView),this.emailListRegion.show(new a({collection:this.collection}))},events:{"click @ui.addEmailBtn":"onAddEmailClick","click @ui.showAddEmailLink":"onShowAddEmail"},onShowAddEmail:function(){this.$(".add-email-wrap").removeClass("hide"),this.ui.showAddEmailLink.addClass("hide")},onAddEmailClick:function(){this.addEmailView.addEmailFromInput()}});return f}),define("text!account/settings/tpl-groups-item.html",[],function(){return'<p><a class=\'group-link\' href=\'/{{name}}\'>{{toUpperCase name}}</a></p>\n\n<!--\n<td>\n   <span class=\'group-actions pull-right\'>\n         <span id="leave-btn" class="btn btn-xs btn-primary">Leave Group</span>   \n         <span id="join-btn" class="btn btn-xs btn-primary">Join Group</span>\n   </span>   \n   \n   \n</td>\n!-->\n'}),define("account/settings/GroupsView",["marionette","app","vent","reqres","text!account/settings/tpl-groups-item.html","backbone-forms","bbf-bootstrap3"],function(e,t,n,r,i){var s=e.ItemView.extend({template:i,tagName:"li",initialize:function(e){},ui:{leaveBtn:"#leave-btn",joinBtn:"#join-btn"},events:{"click @ui.leaveBtn":"onLeaveClick","click @ui.joinBtn":"onJoinClick","click .group-link":"onGroupClick"},onRender:function(){this.ui.joinBtn.hide(),this.ui.leaveBtn.hide(),this.model.get("is_member")?this.ui.joinBtn.hide():this.ui.leaveBtn.hide()},onLeaveClick:function(){var e=this;this.model.leaveCircle({success:function(t){n.trigger("flash:alert",{type:"success",msg:t}),e.ui.leaveBtn.hide(),e.ui.joinBtn.show()},error:function(e,t){n.trigger("flash:alert",{type:"error",msg:e.message})}})},onJoinClick:function(){var e=this;this.model.joinCircle({success:function(t){n.trigger("flash:alert",{type:"success",msg:t}),e.ui.joinBtn.hide(),e.ui.leaveBtn.show()},error:function(e,t){n.trigger("flash:alert",{type:"error",msg:e.message})}})},onGroupClick:function(){n.trigger("navigate:search",this.model.get("name"))}}),o=e.ItemView.extend({template:"<p>Join the UCLA group by verifying @ucla.edu email!</p>"}),u=e.CompositeView.extend({template:"<ul class='group-list-wrapper list-unstyled'></ul>",childView:s,childViewContainer:".group-list-wrapper",emptyView:o,initialize:function(e){},ui:{},events:{},onRender:function(){}});return u}),define("text!account/settings/tpl-settings-layout.html",[],function(){return'\n<div class="row account-settings">\n   <div class="panel panel-default">\n   <div class="panel-heading">\n      <h3 class="panel-title">Account Settings</h3>\n   </div>\n   <div class="panel-body">\n      <div class="col-md-10 col-md-offset-1">\n         <div class="profile-region"></div>\n         <div class="settings-row row">\n            <div class="col-md-3 settings-label">Password <a class="tooltip-helper" href="#" title="Setup your password or change the existing one."><span class="glyphicon glyphicon-info-sign"></span></a></div>\n            <div class="password-region col-md-9"></div>\n         </div>\n         <div class="settings-row row">\n            <div class="col-md-3 settings-label">Facebook <a class="tooltip-helper" href="#" title="Link to a Facebook account. You can receive Facebook notifications, tag Facebook friends and share posts on Facebook."><span class="glyphicon glyphicon-info-sign"></span></a></div>\n            <div class="fb-account-region col-md-9"></div>\n         </div>\n         <div class="settings-row row">\n            <div class="col-md-3 settings-label">Emails <a class="tooltip-helper" href="#" title="Your .edu email will be used to join university groups. The primary email will be used for account-related notifications."><span class="glyphicon glyphicon-info-sign"></span></a></div>\n            <div class="email-region col-md-9"></div>\n         </div>\n         <div class="settings-row row">\n            <div class="col-md-3 settings-label">Groups <a class="tooltip-helper"  href=\'#\' title="Your posts will be visible only to the groups that you join."><span class="glyphicon glyphicon-info-sign"></span></a></div>\n            <div class="group-region col-md-9"></div>\n         </div>\n      </div>\n   </div>\n</div>\n<div>\n'}),define("account/settings/SettingsLayoutView",["marionette","app","vent","reqres","account/settings/EmailCollection","account/settings/CircleCollection","account/settings/PasswordView","account/settings/ProfileView","account/settings/FBAccountView","account/settings/EmailsView","account/settings/GroupsView","text!account/settings/tpl-settings-layout.html"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=e.LayoutView.extend({template:c,regions:{profileRegion:".profile-region",emailRegion:".email-region",passwordRegion:".password-region",FBAccountRegion:".fb-account-region",groupRegion:".group-region"},initialize:function(){},onShow:function(){this.showEmail()},onRender:function(){this.showPassword(),this.showFBAccount(),this.showGroup(),this.$(".tooltip-helper").tooltip({placement:"bottom",html:!0,container:"body"})},showProfile:function(){var e=this,t=r.request("session").getSettings();n.trigger("region:deferredShow",e.profileRegion,t,{success:function(t){e.profileRegion.show(new u({model:r.request("currentUser")}))},error:function(e){n.trigger("flash:alert",{type:"error",msg:e.responseText})}})},showPassword:function(){this.passwordRegion.show(new o)},showFBAccount:function(){this.FBAccountRegion.show(new a)},showEmail:function(){var e=new i,t=this;n.trigger("region:deferredShow",t.emailRegion,e.fetch(),{success:function(n){t.emailRegion.show(new f({collection:e}))},error:function(e){n.trigger("flash:alert",{type:"error",msg:e.responseText})}})},showGroup:function(){var e=r.request("session").getCurrentUser().get("circles"),t=new s(e);this.groupRegion.show(new l({collection:t}))}});return h}),define("text!account/tpl-account-header.html",[],function(){return'<div class="row settings-picture-wrap">     \n   <div class="col-xs-6 col-sm-3">\n      <div class=\'profile-img-wrap\'>\n         <img src="{{picture}}" alt="user image" class="img-circle profile-picture">   \n         <span class="glyphicon glyphicon-pencil"></span>\n         <input type="file" name="file">\n      </div>\n      <!--\n      <div class="pull-left">\n         <span class=\'profile-upload-wrap\'>\n         <span class="btn btn-primary profile-upload-btn btn-block">\n   \n            <span>Change Picture</span>\n            \n         </span>\n      </div>\n   \n      <div class="clearfix"></div>\n      !-->\n   </div>\n   <div class="col-xs-6 col-sm-9">\n      <h3><a href="#" class="public-profile-link">{{user_name}}</a></h3>\n      </div>\n</div>\n<hr>\n'}),define("account/AccountHeaderView",["jquery","marionette","app","vent","reqres","text!account/tpl-account-header.html","jquery.fileupload","jquery.iframe-transport"],function(e,t,n,r,i,s){var o=t.ItemView.extend({template:s,initialize:function(e){this.listenTo(this.model,"change:picture",this.updatePicture),this.isLoading=!1},ui:{picUpload:".profile-img-wrap input[type=file]",profileImg:".profile-img-wrap img",publicProfileLink:".public-profile-link"},events:{"click @ui.publicProfileLink":"onPublicProfileClick"},updatePicture:function(){this.ui.profileImg.attr("src",this.model.get("picture"))},onRender:function(){this.renderFileUpload(),this.$(".profile-img-wrap").attr("title","Change your picture").tooltip({placement:"bottom"}),this.ui.publicProfileLink.attr("title","View your public profile").tooltip({placement:"bottom"})},renderFileUpload:function(){this.upload=this.ui.picUpload.fileupload({dataType:"json",url:i.request("api").account_picture,autoUpload:!0,singleFileUploads:!0});var t=this;this.upload.on("fileuploadadd",e.proxy(this.uploading,this)),this.upload.on("fileuploadalways",e.proxy(this.reset,this)),this.upload.on("fileuploaddone",function(e,n){t.model.set(n.result.data)}),this.upload.on("fileuploadfail",function(e,t){r.trigger("flash:alert",{type:"error",msg:"Something is wrong with uploading. Please try again."})})},uploading:function(e,t){if(this.isLoading)return;var n=t.files[0].name.split(".").pop(),i="jpeg,jpg,png";if(i.indexOf(n)<0)return r.trigger("flash:alert",{type:"error",msg:"Image can only be of type JPG, JPEG, and or PNG"}),!1;this.isLoading=!0},reset:function(){this.isLoading=!1},onPublicProfileClick:function(){r.trigger("navigate:posts:user",this.model.get("user_name"))}});return o}),define("text!account/tpl-layout-page.html",[],function(){return'<class = "row">\n   <div class="col-xs-12 col-lg-10 col-lg-offset-1">\n      <div class="row">\n         <div class="col-xs-12 col-md-3">\n            <div class="layout-side-region"></div>\n         </div>\n         <div class="col-xs-12 col-md-9">\n            <div class="layout-header-region"></div>\n            <div class="layout-main-region"></div>\n         </div>\n      <div>\n   </div>\n</class>\n'}),define("text!account/tpl-account-sidebar.html",[],function(){return'<div class="settings-side-wrap" >\n   <h3>My Account</h3>\n   <div class="settings-nav">\n      \n      <a href="/settings/account" id=\'posts-link\' >Posts</a>\n      <!--<a href="/settings/emails" id=\'wishlist-link\' class="list-group-item">Wish List</a>!-->\n      <a href="/settings/groups" id=\'bookmarks-link\'>Bookmarks</a>\n      <a href="/messages" id=\'messages-link\'>Messages</a>\n      <a href="/settings/profile" id=\'settings-link\'>Settings</a>\n      {{#unless is_canvas}}\n         <a href="/settings/help" id=\'help-link\' >Help</a>\n      {{/unless}}\n   </div>\n</div>\n'}),define("account/AccountLayoutView",["marionette","app","reqres","vent","account/AccountHeaderView","text!account/tpl-layout-page.html","text!account/tpl-account-sidebar.html","backbone-forms","bbf-bootstrap3"],function(e,t,n,r,i,s,o){var u=e.ItemView.extend({template:o,initialize:function(){this.listenTo(r,"account:selected",this.markSelected)},serializeData:function(){return{is_canvas:is_canvas}},ui:{sidebar:".settings-nav",sidebarItems:".settings-nav >a"},events:{"click .settings-nav >a":"onSidebarClick"},onShow:function(){this.$(".settings-side-wrap").affix({offset:{top:70}})},onSidebarClick:function(e){if($(e.target).hasClass("active"))return;var t=e.target.id.replace("-link","");t==="messages"&&r.trigger("navigate:messages"),r.trigger("navigate:account:"+t)},markSelected:function(e){this.ui.sidebarItems.removeClass("active");var t="#"+e+"-link";this.ui.sidebar.find(t).addClass("active")}}),a=e.LayoutView.extend({template:s,regions:{sideRegion:".layout-side-region",headerRegion:".layout-header-region",mainRegion:".layout-main-region"},onRender:function(){this.sideRegion.show(new u({model:n.request("currentUser")})),this.headerRegion.show(new i({model:n.request("currentUser")}))}});return a}),define("account/BookmarkView",["marionette","vent","reqres","posts/PostModel","posts/templates/PostListView"],function(e,t,n,r,i){var s=e.LayoutView.extend({template:"<h3>My Bookmarks</h3><hr><div class='post-wrap'></div>",regions:{postWrapRegion:".post-wrap"},initialize:function(e){this.collection=e.collection},onShow:function(){this.postWrapRegion.show(new i({collection:this.collection}))}});return s}),define("tour/BasicTour",["jquery","marionette","vent","reqres","bootstrap-tour"],function(e,t,n,r){var i=t.Object.extend({initialize:function(){this.setupTour()},start:function(){this.tour.start()},end:function(){this.tour.end()},setupTour:function(){var t=this;this.tour=new Tour({storage:!1,keyboard:!1,onShow:function(t){e("a").bind("click.myDisable",function(){return!1}),e("button.close").prop("disabled",!0)},onEnd:function(t){e("a").unbind("click.myDisable"),e("button.close").prop("disabled",!1)}}),this.addSteps(),this.tour.init()},addSteps:function(){var t=this,r=!1;this.tour.addSteps([{title:"Welcome to DoubleDibz!",placement:"bottom",orphan:!0,content:"This tour will guide you through some core features of DoubleDibz. You can start this tour again anytime by going to the help tab under MyAccount."},{title:"Verify Email",element:".alert",placement:"bottom",backdrop:!0,content:"Before using DoubleDibz please first verify a valid ucla email. This is to ensure that you are actually a UCLA student.",onPrev:function(){n.trigger("navigate:account:help")},onNext:function(){n.trigger("navigate:account:settings")}},{title:"My Account",element:"#settings-nav a#settings-link",placement:"bottom",content:"This is where you can change your account settings. You can update your personal information, look at posts you've created and access your bookmarks"},{title:"Creating, Messaging, Notifications",element:"#header-region .navbar-right",placement:"bottom",content:'The header contains shortcuts for easy navigation.<br /><span class="glyphicon glyphicon-plus"></span>: You can request an item to buy or sell something of your own.<br /> <span class="glyphicon glyphicon-envelope"></span>: You can message others for items that you are selling or buying.<br /><span class="glyphicon glyphicon-globe"></span>: You will recieve notifications for any post you are interested in.'},{title:"Searching",element:"#header-region #nav-search",placement:"bottom",content:"You can easily search for items that you need. All you need to do is type it into the search bar!",onShow:function(){e("#header-region #nav-search").trigger("click")}},{title:"Categories",element:"#header-region #nav-categories",placement:"bottom",content:"Still unsure of what it is exactly that you need to buy? Don't worry, you can also easily search for items by category. We have everything including Hair & Beauty, Tickets, Electronics, etc...",onNext:function(){n.trigger("navigate:home")}},{title:"Search Results",orphan:!0,content:'Here is what the general listings page looks like. Use filters to further specify what you are looking for. Pictures with Facebook icons on them indicate that they are "Free and For Sale" posts.',onPrev:function(){n.trigger("navigate:account:settings")}},{title:"Click a Post",orphan:!0,content:"You can see more details of a post when you click on their picture. Try it out yourself!",onShown:function(){e(".post-list-item-img-wrap").unbind("click.myDisable"),e(".post-control").unbind("click.myDisable"),e(".post-list-item-img-wrap").on("click",function(){t.tour.goTo(8)})},onNext:function(){n.trigger("open:modal:first:post")}},{title:"Individual Post",orphan:!0,content:'Use the left and right buttons to navigate between different posts. If the item was pulled from "Free and For Sale", you can contact the seller directly on Facebook. You can come back to any post later by bookmarking it. Items posted on DoubleDibz will also display the status of the post.'},{title:"End of Tutorial",orphan:!0,content:"This concludes our basic tutorial. You can start this tour again anytime by going to the help tab under My Account Page.",onPrev:function(){n.trigger("open:modal:first:post")}}])}});return i}),define("text!account/tpl-help-page.html",[],function(){return'<div class="panel panel-default">\n   <div class="panel-heading">\n      <h3 class="panel-title">Site Tutorials</h3>\n   </div>\n   <div class="panel-body">\n      <class = "row">\n         <div class="col-md-10 col-md-offset-1">\n            <button id=\'signup-tutorial\' type="button" class="btn btn-lg btn-default btn-primary btn-block">Basic Tutorial</button>\n            \n         </div>\n      </class>\n   </div>\n</div>\n'}),define("account/HelpView",["marionette","app","vent","reqres","tour/BasicTour","text!account/tpl-help-page.html"],function(e,t,n,r,i,s){var o=e.ItemView.extend({template:s,events:{"click @ui.signupTut":"onClickSignupTut"},ui:{signupTut:"#signup-tutorial"},initialize:function(){},onRender:function(){},onClickSignupTut:function(){this.tour=new i,this.tour.start()}});return o}),define("account/VerifyEmailModalView",["marionette","vent","account/templates/AddEmailView"],function(e,t,n){var r='<div class="no-email-modal">                           <h2>Hello there!</h2>                           <p>Let\'s get you started on DoubleDibz.<br>                              But first, please add & verify a ucla.edu email to get started!</p>                           <div class="form-inline">                              <label>Email:</label>                              <span class="add-email-form-region"></span>                           </div><br>                            <a class="btn btn-md btn-primary add-email-btn">Submit</a>                         </div>',i=e.LayoutView.extend({template:r,events:{"click @ui.addEmailBtn":"onClick"},regions:{addEmailInput:".add-email-form-region"},ui:{addEmailBtn:".add-email-btn"},initialize:function(){this.input=new n({preventOnEnter:!0});var e=this;this.listenTo(this.input,"create:email:loading",function(){e.ui.addEmailBtn.button("loading")}),this.listenTo(this.input,"create:email:finish",function(){e.ui.addEmailBtn.button("reset")}),this.listenTo(this.input,"create:email:success",function(e){t.trigger("close:modal"),t.trigger("flash:alert",{type:"success",msg:e})})},onRender:function(){this.addEmailInput.show(this.input)},onClick:function(){this.input.addEmailFromInput()}});return i}),define("account/AccountController",["backbone","marionette","vent","reqres","posts/PostModel","posts/user/UserPostPageView","account/settings/SettingsLayoutView","account/AccountLayoutView","account/BookmarkView","account/HelpView","account/VerifyEmailModalView"],function(e,t,n,r,i,s,o,u,a,f,l){var c=t.Controller.extend({initialize:function(e){this.layout=null},initializeSettingLayout:function(){if(!this.layout||this.layout.isDestroyed)this.layout=new u,n.trigger("mainRegion:show",this.layout)},showMyPostsPage:function(){this.initializeSettingLayout(),this.layout.mainRegion.show(new s({user:r.request("currentUser"),hideHeader:!0,is_owner:!0})),n.trigger("account:selected","posts")},showMyBookmarksPage:function(){this.initializeSettingLayout(),n.trigger("account:selected","bookmarks");var e=this,t=(new i.bookmark).getPosts();n.trigger("region:deferredShow",this.layout.mainRegion,t,{success:function(t){e.layout.mainRegion.show(new a({collection:new i.collection(t.data)}))}})},showSettingsPage:function(){this.initializeSettingLayout(),this.layout.mainRegion.show(new o),n.trigger("account:selected","settings")},showHelpPage:function(){n.trigger("domChange:title",r.request("page:name").help),this.initializeSettingLayout(),this.layout.mainRegion.show(new f),n.trigger("account:selected","help")},saveSettingsAttempt:function(e){r.request("session").updateSettings(e,{success:function(e){n.trigger("flash:alert",{type:"success",msg:e})},error:function(e){n.trigger("flash:alert",{type:"error",msg:e.responseText})}})},updateFBLinkAttempt:function(e){r.request("session").updateFBLink({success:function(t){n.trigger("flash:alert",{type:"success",msg:t}),e&&"success"in e&&e.success()},error:function(e){n.trigger("flash:alert",{type:"error",msg:e.responseText})},complete:function(){e&&"complete"in e&&e.complete()}})}}),h=new c,p=["showMyPostsPage","showMyBookmarksPage","showSettingsPage","showHelpPage"];return r.request("session").setLoginRequired(h,p),n.on("account:saveSettingsAttempt",function(e){h.saveSettingsAttempt(e)}),n.on("show:addVerifyEmail:modal",function(){n.trigger("open:modal",new l,{dialogClass:"verify-email-modal",animate:!1})}),n.on("account:updateFBLinkAttempt",function(e){h.updateFBLinkAttempt(e)}),n.on("navigate:account:settings",function(){h.showSettingsPage(),e.history.navigate("/my/settings")}),n.on("navigate:account:help",function(){h.showHelpPage(),e.history.navigate("/help")}),n.on("navigate:account:bookmarks",function(){h.showMyBookmarksPage(),e.history.navigate("/my/bookmarks")}),n.on("navigate:account:posts",function(){h.showMyPostsPage(),e.history.navigate("/my/posts")}),h}),define("general/ModalView",["underscore","marionette","app","vent","bbf-bootstrap3","bootstrap-modal"],function(e,t,n,r){return function(t,n){n=n||{};var i={title:null,okText:"Ok",showFooter:!1,dialogClass:null,onShow:null,animate:!0,escape:!0},s=e.extend({},i,n),o=(new Backbone.BootstrapModal({animate:s.animate,content:t,title:s.title,okText:s.okText,focusOk:!1,showFooter:s.showFooter,dialogClass:s.dialogClass,escape:s.escape})).open();return o.onShow=s.onShow,o.renderContent=function(e,t){var n=this.$el;if(e&&e.$el){this.options.content.destroy(),this.options.content=e,e.render(),n.find(".modal-body-content").html(e.$el);var r=s.dialogClass;s.dialogClass=t.dialogClass,this.$el.find(".modal-dialog").removeClass(r).addClass(s.dialogClass),t.onShow&&t.onShow(o)}},o.on("shown",function(){this.onShow&&this.onShow(o)}),o.showAlert=function(e,t){var n=this.$el.find(".modal-flash");r.trigger("flash:alert:on",n,e,t)},o.on("ok",function(){if(n.beforeOkay){var e=n.beforeOkay(o.options.content);if(!e)return o.preventClose()}n.afterOkay&&n.afterOkay(o.options.content)}),o}}),define("text!general/tpl-home-page.html",[],function(){return'<div id=\'home-page-wrap\'>\n<header>\n   <div class=\'overlay\'></div>\n   <div class="container">\n      <div class="intro-text">\n         <div class="intro-lead-in">We’ll make your life easier</div>\n         <div class="intro-search">\n         \n            <div class="search-wrap form-group">\n               <span class=\'search-icon glyphicon glyphicon-search\'></span>\n               <span class="search-typed"><span class=\'typed-element\'></span></span>\n               <input type="text" autocomplete=\'off\' id="home-search" name="search">\n            </div>\n         </div>\n         <div class=\'intro-btns\'>\n            <button id=\'tell-more\' type="button" class="btn btn-xl">Tell me more</button>\n            <button id=\'signup-btn\' type="button" class="btn btn-xl">Signup</button>\n         </div>\n      </div>\n   </div>\n</header>\n\n<section id=\'about\'>\n   <div class=\'section-header\'>\n      <div class="container">\n         <div class="row">\n             <div class="col-lg-12">\n                    <h2 class="section-heading">Why <br>DoubleDibz?</h2>\n            </div>\n         </div>\n      </div>\n   </div>\n   <div class="container">\n       <div class="section-content">\n         <p>We’re just a couple of students here at UCLA who used Free and for Sale on a daily basis. The community was great, but we thought that we could make the experience - your experience - even better. We want the platform to have a cleaner interface, we want users to be able to easily search for items, and we want sellers and buyers to connect more efficiently. This is why we created DoubleDibz, a platform for UCLA students to come together to sell and buy anything. We want you to be part of our community, so sign up today! !</p>\n      </div>\n   </div>\n</section>\n\n<section id=\'x-factor\'>\n   <div class=\'section-header\'>\n      <h2 class="section-heading">FEATURES</h2>\n   </div>\n   <div class="container">\n      <div class="section-content row text-center">\n          <div class="col-xs-12 col-sm-6 col-md-6">\n              <span class="fa-stack fa-4x">\n                  <i class="fa fa-circle fa-stack-2x text-primary"></i>\n                  <i class="fa fa-shopping-cart fa-stack-1x fa-inverse"></i>\n              </span>\n              <h3 class="service-heading">Bookmarks</h4>\n              <p class="text-muted">Have you ever wasted a lot of time scrolling for that one post you had an interest in? With bookmarking, you can instantly find that post again!</p>\n          </div>\n          <div class="col-xs-12 col-sm-6 col-md-6">\n              <span class="fa-stack fa-4x">\n                  <i class="fa fa-circle fa-stack-2x text-primary"></i>\n                  <i class="fa fa-laptop fa-stack-1x fa-inverse"></i>\n              </span>\n              <h3 class="service-heading">Integrated Chat</h4>\n              <p class="text-muted">Isn’t it annoying keeping track of all the messages from different people who want to buy your stuff? We organize all messages by item for you to make communications between you and buyers easier and more efficient.</p>\n          </div>\n          \n          <div class="col-xs-12 col-sm-6 col-md-6">\n              <span class="fa-stack fa-4x">\n                  <i class="fa fa-circle fa-stack-2x text-primary"></i>\n                  <i class="fa fa-lock fa-stack-1x fa-inverse"></i>\n              </span>\n              <h3 class="service-heading">FB integration</h4>\n              <p class="text-muted">See something cool on DoubleDibz? Let your friends know on Facebook by tagging them in a post! Want to share your posts? Give your post exposure by sharing on multiple Facebook groups and get your item sold ASAP!</p>\n          </div>\n          <div class="col-xs-12 col-sm-6 col-md-6">\n              <span class="fa-stack fa-4x">\n                  <i class="fa fa-circle fa-stack-2x text-primary"></i>\n                  <i class="fa fa-lock fa-stack-1x fa-inverse"></i>\n              </span>\n              <h3 class="service-heading">Buy Requests</h4>\n              <p class="text-muted">Do you hate posting online to look for an item, only to be ignored? Now you can create a special "buy request" on our site that would help you connect with sellers more easily!</p>\n          </div>\n          <div class="col-xs-12 col-sm-12 col-md-12">\n              <span class="fa-stack fa-4x">\n                  <i class="fa fa-circle fa-stack-2x text-primary"></i>\n                  <i class="fa fa-lock fa-stack-1x fa-inverse"></i>\n              </span>\n              <h3 class="service-heading">Better Free & for Sale experience</h4>\n              <p class="text-muted">Ever felt like you\'ve been scrolling through tons of posts on Free and for Sale that are irrelevant to you? We grab, categorize, and display posts from “Free and for Sale” group to save you time finding what matters to you!</p>\n          </div>\n      </div>\n   </div>\n</section>\n<!--\n<section id=\'listings\'>\n   <div class=\'section-header\'>\n      <div class="container">\n         <div class="row">\n             <div class="col-lg-12">\n                    <h2 class="section-heading">FEATURED <br>LISTINGS</h2>\n            </div>\n         </div>\n      </div>\n   </div>\n   <div class="container">\n      <div class="row text-center">\n         <div class="section-content col-md-10 col-md-offset-1">\n            <h2>SIGN UP NOW</h2>\n            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Minima maxime quam architecto quo inventore harum ex magni, dicta impedit.</p>\n            <button id=\'signup-btn\' type="button" class="btn btn-xl">Signup</button>\n         </div>\n      </div>\n   </div>\n</section>\n!-->\n</div>\n'}),define("general/HomePageView",["jquery","underscore","marionette","app","vent","text!general/tpl-home-page.html","typed"],function(e,t,n,r,i,s){var o='<li class="home-page-extra"><a class="page-scroll" href="#about">About</a></li>                      <li class="home-page-extra"><a class="page-scroll" href="#x-factor">Features</a></li>',u=n.ItemView.extend({template:s,initialize:function(){this.changeHeaderOn=300},ui:{search:"#home-search",searchWrap:".search-wrap",typedWrap:".search-typed",searchTyped:".typed-element"},onRender:function(){e("body").addClass("on-home-page"),t.bindAll(this,"onScroll"),e(window).on("scroll.homepage",t.throttle(this.onScroll,100)),e("#navbar-right").prepend(o),e("body a.page-scroll").on("click",this.onScrollClick),e(window).on("resize.homepage",t.throttle(this.resizeHeader,500))},onShow:function(){this.resizeHeader(),this.ui.searchTyped.typed({strings:["Search, buy, repeat."],typeSpeed:200})},resizeHeader:function(){e("header").css("height",e(window).height()+"px")},events:{"focus @ui.search":"onSearchFocus","blur  @ui.search":"onSearchBlur","click @ui.typedWrap":"onTypedClick","click #signup-btn":"onSignupClick","click #tell-more":"onTellMoreClick","keyup @ui.search":"onSearchKeyUp","click .search-icon":"onSubmitClick"},onTypedClick:function(){this.ui.typedWrap.remove(),this.ui.search.focus()},onTellMoreClick:function(){e("html, body").animate({scrollTop:e("#about").offset().top},800,"swing")},onSignupClick:function(){i.trigger("navigate:signup")},onScroll:function(){var t=window.pageYOffset||document.documentElement.scrollTop;t>=this.changeHeaderOn?e("body").addClass("home-navbar-show"):e("body").removeClass("home-navbar-show")},onScrollClick:function(){var t=e(this);e("html, body").animate({scrollTop:e(t.attr("href")).offset().top},800,"swing")},onSearchFocus:function(){this.ui.searchWrap.addClass("focus")},onSearchBlur:function(){this.ui.searchWrap.removeClass("focus")},onSearchKeyUp:function(e){var t=e.keyCode||e.which,n=13;e.preventDefault(),t==n&&this.onSubmitClick()},onSubmitClick:function(){var e=this.ui.search.val().trim();i.trigger("navigate:search:name","ucla",null,e)},onBeforeDestroy:function(){e("body").removeClass("on-home-page home-navbar-show"),e(window).off("scroll.homepage resize.homepage"),e(".home-page-extra").remove()}});return u}),define("bugs/BugPostModel",["reqres"],function(e){var t=Backbone.Model.extend({initialize:function(){},url:function(){return e.request("api").bugposts}});return t}),define("bugs/ReportBugView",["marionette","app","vent","backbone-forms","bbf-bootstrap3","bootstrap-modal"],function(e,t,n){var r=new Backbone.Form({schema:{name:{type:"Text",title:"Title",validators:["required"],editorAttrs:{placeholder:"Brief Title"}},description:{type:"TextArea",validators:["required"],editorAttrs:{placeholder:"Description",rows:"6"}}},idPrefix:"input-"}),i=e.ItemView.extend({ui:{reportBugForm:"#report-form"},initialize:function(){this.listenTo(this,"ok",this.onOkClick)},template:"<p class='text-center'>Tell us what we can improve!</p><div id='report-form'></div>",onRender:function(){this.form=r.render(),this.ui.reportBugForm.append(this.form.el)},validate:function(){return!this.form.validate()}});return i}),define("text!general/tpl-404-page.html",[],function(){return"<h4>Sorry man, this page isn't available :( </h4>\n\n<p>This link is either broken or you don't have the permission to see it.</p>\n"}),define("text!general/tpl-footer.html",[],function(){return'<div class="footer">\n   <div class="container">\n      <div class="footer-wrap">\n         <nav>\n             <ul>\n                 <!--<li><a id=\'about-us-link\' href="/about/us/">About us</a></li>!-->\n                 <!--<li><a id=\'support-link\' href="/support">Support</a></li>\n                 <li><a id=\'blog-link\' href="/blogs">Blog</a></li>!-->\n                 <li><a id=\'terms-link\' href="/about/legal/terms">Terms</a></li>\n             </ul>\n         </nav>\n         <p class="copyright">© 2014 <span>DoubleDibz</span></p>\n      </div>\n   </div>\n</div>\n'}),define("text!general/tpl-terms-of-service-page.html",[],function(){return"<h2>Terms of Service</h2>\n<hr>\n\n<article>\n   <h4>DoubleDibz Terms of Service</h4>\n   <p>By using the website you accept and agree to be bound by the terms and provisions of this agreement. In addition, when using this website’s particular services, you shall be subject to any posted guidelines or rules applicable to such services, which may be posted and modified from time to time. All such guidelines or rules are hereby incorporated by reference into the TOS. “Client”, “Users”, “You”, and “Your” refers to you, the person accessing this website and accepting the Company’s terms and conditions. “The Company”, “Ourselves”, “We”, “The Team”, “The Developers”, “The Owners”, and “Us”, refers to our Company. Any use of the above terminology or other words in the singular, plural, capitalization and/or he/she or they, are taken as interchangeable and therefore referring to same. </p>\n   <p>Any participation in this site will constitute acceptance of this agreement. If you do not agree to abide by the above, please do not use this site. We reserve the right to ban any account at any time for any reason.</p>\n   <p><i>This website has rules. Please follow them so everyone can have a good time.</i></p>\n   \n   <br>\n   <h4>Disclaiming Accuracy of Information</h4>   \n   <p>This site and its components are offered for informational purposes only. This site shall not be responsible or liable for any error or omissions in that information. This site is also not responsible or liable for the actions or words of the other users of this site. We are also not responsible for any liability resulting from the use of our site. This includes, without limitation, direct loss, loss of business or profits, damage caused to your computer, computer software, systems and programs and the data thereon or any other direct or indirect, consequential and incidental damages. </p>\n   <p>We do not monitor or review the content of our other member’s websites which are linked to from this website. Opinions expressed or materials appearing on such websites are not necessarily shared or endorsed by us and should not be regarded as the publisher of such opinions or material. Please be aware that we are not responsible for the privacy practices, or content, of these sites. We encourage our users to be aware when they leave our site and to read the privacy statements of these sites. You should evaluate the security and trustworthiness of any other site connected to this site or accessed through this site yourself, before disclosing any personal information to them. We will not accept any responsibility for any loss or damage in whatever manner, howsoever caused, resulting from your accessing to third parties websites via links posted on our website. </p>\n   <p><i>We are not responsible for other people’s actions</i></p>\n   \n   <br>\n   <h4>Intellectual Property Rights</h4>\n   <p>If this website infringes on your copyright, you can report it by sending an email to DoubleDibz@gmail.com. Please provide all legal documents supporting your claim.</p>\n   <p><i>We’re not about violating copyrights. Let us know if you feel like you’ve been infringed.</i></p>\n   \n   <br>\n   <h4>Advertisements</h4>\n   <p>All advertisements on this website have been provided by Google AdSense. The owners and developers of this website may not have personally tried and/or researched each product that is endorsed by these advertisements. We are being paid by Google AdSense.</p>\n   <p><i> The ads are provided by AdSense. We may not have tried every product advertised.</i></p>\n   \n   <br>\n   <h4>Data and Privacy</h4>\n   <p>We are committed to protecting your privacy. Authorized employees within the company on a need to know basis only use any information collected from individual customers. We constantly review our systems and data to ensure the best possible service to our customers. We will not sell or give your information without your personal consent. Your personal data will only be used to set up and maintain your personal account. The personal information in the account will be used to match other users in the area and will be used to facilitate contacting each other.  Client records are regarded as confidential and therefore will not be divulged to any third party unless legally required to do so to the appropriate authorities. We will investigate any unauthorized actions against our computer systems and data with a view to prosecuting and/or taking civil proceedings to recover damages against those responsible. </p>\n   <p><i>We won’t pass on your personal information. Your information is safe with us. </i></p>\n   \n   <br>\n   <h4>Delivering Goods</h4>\n   <p>This website is not responsible or liable for the delivery of the goods in the trade. Users can use our website to locate a buyer and a seller but need to make their own arrangements to delivering and purchasing the object. Do not send us payment for the item. Contact the seller directly to make the purchase. We are also not responsible or liable if the item purchased from another user is defective, stolen, damaged, or not what was listed. We will not provide the buyer a refund for any item purchased from another user.</p>\n   <p><i>We don’t deliver and are not responsible for any problems with the item in question. It is the buyer’s responsibility to check the item before making the final purchase.</i></p>\n   \n   <br>\n   <h4>Drugs and Sex/Nudity</h4>\n   <p>You agree not post items or services that are illegal. This includes, but is not limited to the sale or consumption of illegal or recreational drugs or posts with a sexual emphasis. While we do not allow the sale of such products or services on our site, we realize that it may still happen and we take no responsibility for the consequences for said actions. We intend to remove all posts in this category as quickly as possible. </p>\n   \n   <br>\n   <h4>Complaints</h4>\n   <p>Any complaints about items, sellers, or members in general may be sent to our support team: customersupport@DoubleDibz.com. There is no guarantee of a resolution. Each case will be looked at individually and the member who the complaint was filed upon will be contacted as well. </p>\n   <p><i>If you have a problem with someone, let us know.</i></p>\n   \n   <br>\n   <h4>Cookies</h4>\n   <p>This Company’s website uses cookies to enable us to retrieve user details for each visit. Cookies are used in some areas of our site to enable the functionality of this area and ease of use for those people visiting. </p>\n   \n   <br>\n   <h4>Legalities</h4>\n   <p>Our team and our owners are not responsible for any health or safety concerns once the buyer has received the item. We are also not responsible for any health or safety concerns regarding the transaction of the item. If any harm is incurred from items purchased by the buyer, we share no responsibility.   </p>\n   \n   <br>\n   <h4>Software</h4>\n   <p>You agree to not post or link directly or indirectly to a site that contains spyware/malware downloads or any software that results in an unexpected, deceptive, or unfair user experience, including but not limited to software which may alter, corrupt, disable, or replace any hardware or software on a user’s computer without the express permission from the user. </p>\n   <p><i>Don’t upload Malware to our site!</i></p>\n   \n   <br>\n   <h4>Notification of Changes</h4>\n   <p>These terms and conditions are subject to change from time to time as it sees fit. If there are any changes to our privacy policy, we will announce that these changes have been made on our home page and on other key pages on our site. Last updated July 27, 2014.</p>\n</article>\n\n"}),define("text!general/tpl-about-us-page.html",[],function(){return"\n<div id=about-container>\n   <div class='row'>\n      <div class='col-md-8 col-md-offset-2'>\n         <h1>About Us</h1>\n         <hr>\n         <p>Poor and broke? Can’t afford new things? You’ve come to the right place! At DoublDibz you can find hundreds of nice things at cheap prices from people in your community. </p>\n         <p>We were college students who lived the typical college life. We ate Ramen 24/7 and bought all of our furniture and books from friends and on Craigslist. We were dissatisfied with the amount of scams on Craigslist but it was the only option at the time. Suddenly, a holy light shined down on us and presented itself. It was the Facebook group “Free and for Sale”. Now we could sell or give away our stuff to people in our community. We knew that we were dealing with legit people because these guys went to our school. After the initial honeymoon phase, we came to the realization that this was just a wall post and not a full fledged peer to peer trading network. It lacks categorization, organization, and presentation. We decided to build a website to improve on the core concept of the “Free and for Sale” group and to enhance the peer to peer trading network.</p>\n         \n         <p>There are two kinds of posts on our site: those created on our site and those created on Facebook. Posts created on our site can be categorized by adding hashtags in their posts. This increases the chance that their post will be found with the search tool. Potential buyers are able to contact sellers directly through the use of the in house chat that functions similarly to Facebook chat. Chats are separated by items to make keeping track of conversations simple. Almost any activity done on our site will notify the user on Facebook!</p>\n         <p>The second type of posts comes directly from the Facebook group “Free and for Sale”. These posts are indicated by the Facebook logo on the bottom left corner of every image. When someone clicks on a Facebook post, they will be linked to the Free and for Sale listing on Facebook. Users need to be a part of the Free and for Sale group to be able to see or comment on any Facebook post. We do not store/display/ or give away private user information.</p>\n         <p>We’re doing our best to improve the peer to peer selling experience. If you have any comments, feedback, or concerns, we will be more than happy to chat with you. You can contact us at customerservice@DoubleDibz.com</p>\n      </div>\n   </div>\n</div>\n"}),define("general/GeneralController",["jquery","underscore","backbone","marionette","app","vent","reqres","general/ModalView","general/HomePageView","bugs/BugPostModel","bugs/ReportBugView","text!general/tpl-home-page.html","text!general/tpl-404-page.html","text!general/tpl-footer.html","text!general/tpl-terms-of-service-page.html","text!general/tpl-about-us-page.html"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=r.ItemView.extend({}),g=r.ItemView.extend({template:p,events:{"click #about-us-link":function(){s.trigger("navigate:about")},"click #support-link":function(){s.trigger("flash:alert",{type:"info",msg:"Support is coming soon!"},{timer:!0})},"click #blog-link":function(){s.trigger("flash:alert",{type:"info",msg:"Blog is coming soon!"},{timer:!0})},"click #terms-link":function(){s.trigger("navigate:terms")}}}),y=r.Controller.extend({showHomePage:function(){if(!o.request("isLoggedIn"))return s.trigger("mainRegion:show",new a);s.trigger("navigate:search:home","ucla")},showEmptyPage:function(){s.trigger("mainRegion:close")},show404Page:function(){s.trigger("mainRegion:show",new m({template:h}))},showFooter:function(){s.trigger("footerRegion:show",new g)},showTermPage:function(){s.trigger("domChange:title",o.request("page:name").terms),s.trigger("mainRegion:show",new m({template:d}))},showAboutPage:function(){s.trigger("domChange:title",o.request("page:name").about),s.trigger("mainRegion:show",new m({template:v}))},openReportBugModal:function(){var e=this;s.trigger("open:modal",new l,{title:"Give Feedback!",okText:"Send",showFooter:!0,beforeOkay:function(e){return e.validate()},afterOkay:function(t){e.attemptReportBug(t.form.getValue())}})},attemptReportBug:function(e){var t=this,n=new f;n.save(e,{wait:!0,success:function(e,t){s.trigger("_flash:alert",{type:"success",msg:t})},error:function(e,t,n){s.trigger("_flash:alert",{type:"error",msg:t.responseText})}})},openInviteFriendsDialog:function(){var e="http://www.doubledibz.com/",t=o.request("FB");t.ui({method:"send",display:"iframe",link:e})}}),b=new y;return b.listenTo(s,"navigate:home",function(){b.showHomePage(),n.history.navigate("")}),b.listenTo(s,"navigate:emptyPage",function(){b.showEmptyPage()}),b.listenTo(s,"navigate:404Page",function(){b.show404Page()}),b.listenTo(s,"navigate:terms",function(){b.showTermPage(),n.history.navigate("about/legal/terms")}),b.listenTo(s,"navigate:about",function(){b.showAboutPage(),n.history.navigate("about/us")}),b.listenTo(s,"showFooter",function(){b.showFooter()}),b.listenTo(s,"open:reportbug",function(){b.openReportBugModal()}),b.listenTo(s,"open:inviteFriends",function(){b.openInviteFriendsDialog()}),b.listenTo(s,"open:modal",function(e,t){b.modal?b.modal.renderContent(e,t):(b.modal=u(e,t),b.modal.$el.one("hidden.bs.modal",function(e){b.modal.options.content.destroy(),b.modal.remove(),b.modal=null}))}),b.listenTo(s,"close:modal",function(){b.modal&&b.modal.$el.modal("hide")}),b.listenTo(s,"flash:alert",function(e,t){b.modal?b.modal.showAlert(e,t):s.trigger("_flash:alert",e,t)}),b.listenTo(s,"global:flash:alert",function(e,t){s.trigger("_flash:alert",e,t)}),b}),define("posts/user/UserModel",["reqres"],function(e){var t=Backbone.Model.extend({urlRoot:function(){return e.request("api").user+"/"+this.user_name},initialize:function(e){this.user_name=e.user_name}});return t}),define("text!posts/edit/tpl-create-posts.html",[],function(){return'<div class="row">\n    <div class="col-sm-8 col-md-8 col-md-offset-2 col-sm-offset-2" >\n      <h3>What are you selling?</h3>\n      <hr>\n      <div id="create-post-form"></div>\n      \n      <hr>\n      <h4>Add more pictures!</h4>\n      <p>No more than 6 pictures</p>\n      <div id=\'post-picture-error\'></div>\n      <div id=\'post-picture-wrap\'></div>\n      \n      <hr>\n      <a href="#" id="create-btn" class="btn btn-lg btn-primary btn-block">Create</a>\n      \n   </div>\n   \n</div>\n'}),define("posts/templates/priceTemplate",["underscore"],function(e){return e.template('    <div class="form-group field-<%= key %>">      <label class="col-sm-2 control-label" for="<%= editorId %>"><%= title %></label>      <div class="col-sm-10">         <div class="input-group"><div class="input-group-addon">$</div>        <span data-editor></span></div>        <p class="help-block" data-error></p>        <p class="help-block"><%= help %></p>      </div>    </div>  ')}),define("posts/edit/PostForm",["backbone","posts/PostModel","posts/templates/priceTemplate","backbone-forms","bbf-bootstrap3"],function(e,t,n){var r=6,i=e.Form.extend({schema:{name:{type:"Text",validators:["required"],editorAttrs:{placeholder:"What are you selling?"}},categories:{type:"Select",title:"Category",validators:["required"],options:[]},hashtags:{type:"Text",title:"Hashtags",validators:["required",function(t,n){var i={type:"hashtags",message:"Please enter no more than 6 tags"};if(t.split(",").length>r)return i},function(t,n){var r={type:"hashtags",message:"Hashtags can only be underscore (_), uppercase or lowercase caracters."},i=_.find(t.split(","),function(e){return!/^([a-zA-Z0-9_]+)$/.test(e.trim())});if(i)return r}]},price:{type:"Text",editorAttrs:{placeholder:"XX.XX"},template:n,validators:["required",function(t,n){var r={type:"price",message:"Please put valid prices that is up to 2 decimals"};if(!/^(\d{1,8})?(.\d{1,2})?$/.test(t.trim()))return r}]},description:{type:"TextArea",validators:["required"],editorAttrs:{rows:10,placeholder:"Brief description of the item..."}}},idPrefix:"input-"});return i}),define("posts/upload-manager/FileModel",["jquery","underscore","backbone","marionette"],function(e,t,n,r){var i=n.Model.extend({"default":{sync:null,data:null,processor:null},state:"pending",start:function(){this.isPending()&&(this.get("processor").submit(),this.state="running",this.trigger("filestarted",this))},cancel:function(){this.get("processor").abort(),this.destroy(),this.state="canceled",this.trigger("filecanceled",this)},progress:function(e){this.trigger("fileprogress",this.get("processor").progress())},fail:function(e){this.state="error",this.cancel()},done:function(e){this.set({sync:e.data}),this.id=e.data.id,this.state="done",this.get("force_primary")===1&&this.setPrimary(!0),this.trigger("filedone",e)},sync:function(e,t,r){return e==="delete"&&(r.url=this.url+"/"+this.id),n.sync(e,t,r)},isPending:function(){return this.getState()=="pending"},isRunning:function(){return this.getState()=="running"},isDone:function(){return this.getState()=="done"},isError:function(){return this.getState()=="error"||this.getState=="canceled"},getState:function(){return this.state},isPrimary:function(){return this.get("sync")&&this.get("sync").is_primary==1},setPrimary:function(e){var t=this.isPrimary();e?this.get("sync").is_primary=1:this.get("sync").is_primary=0,t!==this.isPrimary()&&this.trigger("updatePrimary")}}),s=n.Collection.extend({model:i,initialize:function(){this.on("add",this.onAdd),this.on("remove",this.onRemove)},setPrimary:function(e){var n=t.filter(this.models,function(e){return e.isPrimary()});t.each(n,function(e){e.setPrimary(!1)}),e.setPrimary(!0)},onAdd:function(e){this.length===1&&t.isUndefined(e.get("sync"))&&e.set({force_primary:1})},onRemove:function(e){e.isPrimary()&&this.length>0&&this.at(0).setPrimary(!0)}});return{model:i,collection:s}}),define("text!posts/upload-manager/upload-file-view.html",[],function(){return'<div class="col col-md-4 col-sm-6 col-xs-6">\n<div class="upload-manager-file uploading">\n   <span class="is-primary-label">\n      <span class="fui-check"></span>Primary\n   </span>\n   <div class=\'file-img\'>\n      <img src=\'\' alt=\'\'>\n   </div>\n   <div class="img-loader"><img src="/static/img/ajax-loader.gif"></div>\n   \n   <div class="upload-process">\n      <div class="progress">\n         <div class="progress-bar progress-bar progress-bar-striped" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">\n            <span class="progress-label"></span>\n         </div>\n      </div>\n      \n      <!--<span class="message hidden"></span>!-->\n   </div>\n   \n   <a href="#" class="control-buttons btn-set-primary"><span class="fui-check"></span></a>\n   <a href="#" class="control-buttons btn-cancel"><span class="glyphicon glyphicon-remove"></span></a>\n   <a href="#" class="control-buttons btn-clear"><span class="glyphicon glyphicon-remove"></span></a>\n\n</div>\n</div>\n'}),define("posts/upload-manager/FileView",["jquery","underscore","backbone","marionette","posts/upload-manager/FileModel","text!posts/upload-manager/upload-file-view.html"],function(e,t,n,r,i,s){var o=function(){return{displaySize:function(e){var t=["B","KB","MB","GB","TB"];if(e==0)return"0 B";var n=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return(e/Math.pow(1024,n)).toFixed(2)+" "+t[n]}}},u=r.ItemView.extend({template:s,ui:{row:".upload-manager-file",cancelBtn:".btn-cancel",clearBtn:".btn-clear",setPrimaryBtn:".btn-set-primary",progress:"div.progress .progress-bar",progress_wrap:"div.progress",size:"span.size",message:"span.message",name:"span.name",img:".file-img"},events:{"click @ui.cancelBtn":function(){this.model.cancel()},"click @ui.clearBtn":function(){this.ui.clearBtn.button("loading"),this.model.destroy({wait:!0})},"click @ui.setPrimaryBtn":function(){this.model.collection.setPrimary(this.model)}},initialize:function(e){this.listenTo(this.model,"destroy",this.destroy),this.listenTo(this.model,"fileprogress",this.updateProgress),this.listenTo(this.model,"filefailed",this.hasFailed),this.listenTo(this.model,"filedone",this.hasDone),this.listenTo(this.model,"updatePrimary",this.updateIsPrimary)},onRender:function(){this.updateIsPrimary(),this.ui.setPrimaryBtn.attr("title","Set to primary").tooltip({placement:"top",container:this.ui.setPrimaryBtn}),this.ui.clearBtn.attr("title","Remove this picture").tooltip({placement:"top",container:this.ui.clearBtn})},updateIsPrimary:function(){if(this.model.isPrimary())return this.ui.row.addClass("is-primary");this.ui.row.removeClass("is-primary")},updateProgress:function(e){var t=parseInt(e.loaded/e.total*100,10);this.ui.progress.css("width",t+"%").attr("aria-valuenow",t).parent().find(".progress-label").html(o().displaySize(e.loaded)+" of "+o().displaySize(e.total))},hasDone:function(e){this.ui.row.removeClass("uploading"),this.ui.img.find("img").attr("src",this.model.get("sync").thumbnail)}});return u}),define("text!posts/upload-manager/upload-manager.html",[],function(){return'<div class="upload-manager">\n   <div class="no-data"><em></em></div>\n   <div class=\'file-list clearfix\'></div>\n   <span class="btn fileinput-button" id="fileinput-button">\n      <span class="glyphicon glyphicon-plus"></span>\n      <input id="fileupload" type="file" name="file" multiple="multiple">\n   </span>\n</div>\n'}),define("posts/upload-manager/backbone.upload-manager",["jquery","underscore","backbone","marionette","posts/upload-manager/FileModel","posts/upload-manager/FileView","text!posts/upload-manager/upload-manager.html","jquery.fileupload","jquery.iframe-transport"],function(e,t,n,r,i,s,o){var u=i.model,a=i.collection,f=r.ItemView.extend({template:o,defaults:{maxNumFiles:6,uploadUrl:"/upload",autoUpload:!1,dataType:"json",images:[]},ui:{input:"input#fileupload",filelist:".file-list",cancel_upload_btn:"button#cancel-uploads-button",start_upload_btn:"button#start-uploads-button"},getImageId:function(){return t.map(this.files.models,function(e,t){return e.id})},getPrimaryImageId:function(){var e=t.find(this.files.models,function(e){return e.isPrimary()});return e.id},events:{"change @ui.input":function(t){var n=e(this.ui.input).get(0).files.length;if(this.files.size()+n>this.options.maxNumFiles){this.trigger("error","We can't have more than "+this.options.maxNumFiles+" files :( ");return}this.uploadProcess.fileupload("add",{fileInput:e(this.ui.input)}),this.ui.input.val("")},"click @ui.cancel_upload_btn":function(){this.files.each(function(e){e.cancel()})},"click @ui.start_upload_btn":function(){this.files.each(function(e){e.start()})}},file_id:0,initialize:function(t){this.options=e.extend(this.defaults,t),this.files=new a,this.uploadProcess=e('<input id="fileupload" type="file" name="file" multiple="multiple">').fileupload({dataType:this.options.dataType,url:this.options.uploadUrl,formData:this.options.formData,autoUpload:this.options.autoUpload,singleFileUploads:!0});var n=this;e.each(this.options.images,function(e,t){var r=new u({data:{size:0}});r.done({data:t}),r.url=n.options.uploadUrl,n.files.add(r)}),this.bindProcessEvents(),this.bindLocal()},onRender:function(){var e=this;this.files.each(function(t,n){e.renderFile(t)}),this.update()},bindLocal:function(){var e=this;this.on("fileadd",function(t){this.trigger("uploadManager:start"),e.files.add(t),e.renderFile(t)}).on("fileprogress",function(e,t){e.progress(t)}).on("filefail",function(t,n){e.trigger("error",n),t.fail(n)}).on("filedone",function(e,t){e.done(t.result)}),this.files.on("all",this.update,this)},renderFile:function(t){var n=new s(e.extend(this.options,{model:t}));this.ui.filelist.append(n.render().el),t.isDone()&&n.hasDone()},update:function(){var t=e().add(this.ui.cancel_upload_btn).add(this.ui.start_upload_btn),n=this.ui.filelist.find(".no-data",this.el);this.files.length>0?(t.removeClass("hidden"),n.addClass("hidden")):(t.addClass("hidden"),n.removeClass("hidden"))},checkDoneStatus:function(){var e=t.every(this.files.models,function(e){if(e.state!="pending"&&e.state!="running")return!0});e&&this.trigger("uploadManager:done")},bindProcessEvents:function(){var n=this;this.uploadProcess.on("fileuploadadd",function(e,t){t.uploadManagerFiles=[];var r=t.files[0],i=r.name.split(".").pop(),s="jpeg,jpg,png";if(s.indexOf(i)<0)return n.trigger("error","Only jpg, jpeg and png please."),!1;r.id=n.file_id++;var o=new u({data:r,processor:t});o.url=n.options.uploadUrl,t.uploadManagerFiles.push(o),n.trigger("fileadd",o)}).on("fileuploadprogress",function(t,r){e.each(r.uploadManagerFiles,function(e,t){n.trigger("fileprogress",t,r)})}).on("fileuploadfail",function(r,i){e.each(i.uploadManagerFiles,function(e,r){var s="Unknown error";t.isString(i.errorThrown)?s=i.errorThrown:t.isObject(i.errorThrown)?s=i.errorThrown.message:i.result&&(i.result.error?s=i.result.error:i.result.files&&i.result.files[e]&&i.result.files[e].error?s=i.result.files[e].error:s="Unknown remote error"),n.trigger("filefail",r,s)}),n.checkDoneStatus()}).on("fileuploaddone",function(t,r){e.each(r.uploadManagerFiles,function(e,t){n.trigger("filedone",t,r)}),n.checkDoneStatus()})}});n.UploadManager=f}),define("posts/edit/BaseView",["marionette","vent","posts/PostModel","posts/edit/PostForm","general/FlashMessageView","bloodhound","bootstrap-tagsinput","typeahead","posts/upload-manager/backbone.upload-manager"],function(e,t,n,r,i){var s=e.LayoutView.extend({regions:{pictureErrorRegion:"#post-picture-error",pictureRegion:"#post-picture-wrap"},initializeBase:function(e){this.categories=e.categories,this.uploadManager=null,this.tags=null,this.cat={name:"",text:"",type:"category"},this.hashtags=null,this.form=(new r).render(),this.form.fields.categories.editor.setOptions(this.categories.toOptions()),this.initializeBloodhound()},events:{"change #input-categories":"updateCategory"},initializeBloodhound:function(){this.hashtags=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:"/api/hashtags",ttl:6e5,filter:function(e){return $.map(e.data,function(e){return{name:e,type:"hashtag"}})}}}),this.hashtags.initialize()},renderBase:function(){this.renderForm(),this.renderUploadManager(),this.cat.name=this.form.getValue("categories"),this.renderTags()},renderForm:function(){this.ui.PostForm.append(this.form.el)},renderUploadManager:function(){this.uploadManager=new Backbone.UploadManager({uploadUrl:"/api/images",autoUpload:!0,maxNumFiles:6,images:this.model.get("images")||[]});var e=this;this.uploadManager.on("error",function(t){if(t==="REQUEST ENTITY TOO LARGE")t="The picture is too big! Maximum size is 8MB";else if(t==="BAD REQUEST"||t==="UNPROCESSABLE ENTITY")t="Something is wrong...try again?";else if(t==="abort")return;e.pictureErrorRegion.show(new i({type:"error",msg:t}))})},onShow:function(){this.pictureRegion.show(this.uploadManager)},renderTags:function(){this.tags=$(this.el).find("input#input-hashtags"),this.tags.tagsinput({trimValue:!0,itemValue:"name",itemText:function(e){return"#"+e.name},freeInput:!0,tagClass:"label label-primary",confirmKeys:[13,32,44],typeaheadjs:{name:"hashtags",displayKey:"name",source:this.hashtags.ttAdapter(),templates:{suggestion:Handlebars.compile("<p>#{{name}}</p>")}}}),this.tags.tagsinput("add",this.cat),this.tagInput=this.tags.tagsinput("input"),this.tagInput.on("blur",$.proxy(function(e){this.tagInput.val("")},this)),this.tags.on("beforeItemRemove",function(e){e.item.type&&e.item.type=="category"&&(e.cancel=!0)}),this.tags.on("itemAdded",$.proxy(function(){var e=this.form.fields.hashtags.validate()},this)),this.tags.on("itemRemoved",$.proxy(function(){var e=this.form.fields.hashtags.validate()},this)),$(document.body).on("focus.tagsinput",".bootstrap-tagsinput",function(){$(this).addClass("focus")}).on("blur.tagsinput",".bootstrap-tagsinput",function(){$(this).removeClass("focus")})},updateCategory:function(e){this.cat.name=this.form.getValue("categories"),this.tags.tagsinput("refresh")},getFormValue:function(){return{name:this.form.getValue("name"),price:this.form.getValue("price").trim(),images:this.uploadManager.getImageId().join(","),primary_image_id:this.uploadManager.getPrimaryImageId(),hashtags:this.getHashtags(),description:this.form.getValue("description")}},getHashtags:function(){var e=_.map(this.tags.tagsinput("items"),function(e){return e.name});return e.join(",")},validate:function(){var e=this.form.validate();return this.form.on("change",function(e,t){e.validate()}),e?!0:this.uploadManager.getImageId().length==0?(t.trigger("flash:alert",{type:"error",msg:"Must have at least 1 picture."}),!0):!1},onBeforeDestroy:function(){$(document.body).off("focus.tagsinput blur.tagsinput")}});return s}),define("posts/edit/PostCreatePageView",["jquery","marionette","vent","posts/PostModel","text!posts/edit/tpl-create-posts.html","posts/edit/BaseView"],function(e,t,n,r,i,s){var o=s.extend({template:i,initialize:function(e){this.initializeBase(e),this.block_create=!1,this.form.setValue({categories:this.categories.at(0).get("name")})},ui:_.extend({},s.prototype.ui,{PostForm:"#create-post-form",createBtn:"#create-btn"}),events:_.extend({},s.prototype.events,{"click @ui.createBtn":"createPost"}),onRender:function(){this.renderBase();var e=this;this.listenTo(this.uploadManager,"uploadManager:start",function(){e.block_create=!0}),this.listenTo(this.uploadManager,"uploadManager:done",function(){e.block_create=!1})},createPost:function(){if(this.block_create)return;var t=this.validate();if(t){e(document).scrollTop(0);return}this.ui.createBtn.button("loading");var r=this;this.model.save(this.getFormValue(),{wait:!0,success:function(e,t){n.trigger("navigate:posts:item",r.model.id),n.trigger("flash:alert",{type:"success",msg:t})},error:function(e,t,i){n.trigger("flash:alert",{type:"error",msg:t.responseText}),r.ui.createBtn.button("reset")}})}});return o}),define("posts/CommentModel",["reqres"],function(e){var t=Backbone.Model.extend({initialize:function(){}}),n=Backbone.Collection.extend({model:t,initialize:function(e,t){this.post_id=t.post_id},url:function(){return e.request("api").posts+"/"+this.post_id+"/comments"}});return n}),define("text!posts/item/tpl-item-layout.html",[],function(){return'\n<div class="post-item panel panel-default">\n   {{#if modalMode}}\n      <a class="modal-close-btn close">&times;</a>\n      <a href="#" class="post-control post-prev"><span class="fui-arrow-left"></span></a>\n      <a href="#" class="post-control post-next"><span class="fui-arrow-right"></span></a>\n   {{/if}}\n   <div class="panel-body">\n      <div class=\'row\'>\n         <div class="post-item-images-side col-sm-8"></div>\n      \n         <div class=\'post-item-side col-sm-4\'>\n            <div class=\'row\'>\n            \n               <div class="col-xs-12">\n                  <div class="user-profile-region"></div>\n                  <hr>\n                  {{#if modalMode}}\n                     <h2><a class=\'name-link\' href="/posts/{{id}}">{{name}}</a></h2>\n                  {{else}}\n                     <h2 >{{name}} </h2>\n                  {{/if}}\n                  <p class=\'post-header-line post-price\'>\n                     <span class="glyphicon glyphicon-tag"></span> ${{decimal price}}   | <small><span class="timeago-region"></span></small>\n                  </p>                   \n               </div>\n               <div class="post-item-action col-xs-12"></div>\n\n               \n               <div class="col-xs-12">\n                  <hr>\n                  \n                  <p class=\'post-header-line\'>\n                     <span class=\'hashtags-region\'></span>\n                  </p>\n                  <p>\n\n                     <span class="post-description">{{description}}</span>\n                  </p>\n                  <a href="#" class="btn btn-xs btn-primary fb-share-btn"><span class="fui-facebook"></span> Share!</a>\n                  <hr>\n               </div>\n               <div class="post-item-comments col-xs-12"></div>\n\n            </div>\n         </div>\n         \n      </div>\n   </div>\n\n</div>\n'}),define("text!posts/item/tpl-item-buyer-action.html",[],function(){return'<span class="bookmark-btn-region"></span>\n<a href="#" id="contact-btn" class="btn btn-primary btn-block"><span class="glyphicon glyphicon-shopping-cart"></span> Contact seller</a>\n\n\n'}),define("text!posts/item/tpl-item-seller-action.html",[],function(){return'<div class=\'col-xs-6\'>\n   <a class="btn btn-primary" href="/posts/{{id}}/edit" id="edit-btn">Edit</a>\n</div>'}),define("posts/item/ItemSellerActionView",["jquery","marionette","vent","reqres","posts/PostModel","text!posts/item/tpl-item-seller-action.html","timeago"],function(e,t,n,r,i,s){var o=t.ItemView.extend({template:s,events:{"click #edit-btn":"onEditClick"},onRender:function(){is_canvas&&this.hideButtons()},onEditClick:function(){var e=this.model.id;this.model.modalMode&&n.trigger("close:modal"),n.trigger("navigate:posts:edit",e)},hideButtons:function(){this.$("#edit-btn").hide(),this.ui.toggleStatusBtn.hide()}});return o}),define("posts/templates/BookmarkButtonView",["underscore","marionette","vent","reqres"],function(e,t,n,r){var i='<a href="#" class="btn btn-primary btn-block bookmark-btn"></a>',s='<span class="glyphicon glyphicon-star"></span>Bookmarked',o='<span class="glyphicon glyphicon-star-empty"></span>Bookmark',u=t.ItemView.extend({template:i,initialize:function(e){this.listenTo(this.model,"change:is_bookmarked",this.renderText,this)},tagName:"span",ui:{bookmarkBtn:".bookmark-btn"},events:{"click @ui.bookmarkBtn":"onClick"},onRender:function(){this.renderText()},renderText:function(){if(!r.request("isLoggedIn")){this.ui.bookmarkBtn.html(o);return}var t=this.model.getBookmarkStatus();e.isBoolean(t)?t?this.ui.bookmarkBtn.html(s):this.ui.bookmarkBtn.html(o):this.ui.bookmarkBtn.html("<img src='/static/img/ajax-loader-bg-green.gif'>")},onClick:function(){n.trigger("posts:bookmarkAttempt",this.model)}});return u}),define("posts/item/ItemBuyerActionView",["marionette","vent","reqres","posts/PostModel","posts/templates/BookmarkButtonView","text!posts/item/tpl-item-buyer-action.html"],function(e,t,n,r,i,s){var s=e.LayoutView.extend({template:s,regions:{bookmarkBtn:".bookmark-btn-region"},events:{"click #contact-btn":"onContactClick","click @ui.toggleSubscribeBtn":"onToggleSubscribeClick"},ui:{toggleSubscribeBtn:"#toggle-subscribe-btn",subscribeLabel:"#subscribe-label"},initialize:function(e){this.in_circle=n.request("currentUser").isInCircle(this.model.get("joined_circles"))},onRender:function(){this.bookmarkBtn.show(new i({model:this.model}))},renderSubscribe:function(){var e=this.model.get("has_subscribed");e?(this.ui.toggleSubscribeBtn.text("Unsubscribe"),this.ui.subscribeLabel.empty().append('<span class="label label-danger">'+e+"</span>")):(this.ui.toggleSubscribeBtn.text("Subscribe"),this.ui.subscribeLabel.empty().append('<span class="label label-success">'+e+"</span>"))},onContactClick:function(){t.trigger("messages:contactSeller",this.model)},onToggleSubscribeClick:function(){if(!n.request("isLoggedIn"))return t.trigger("navigate:login");this.model.toggleSubscribe().fail(function(e){t.trigger("flash:alert",{type:"error",msg:e.responseText})})}});return s}),define("text!posts/item/tpl-item-images.html",[],function(){return'{{#unless is_selling}}\n   <div class="sold-tag ribbon ribbon-red"><span>Sold Out</span></div>\n{{/unless}}\n{{#if has_images}}\n\n   <div class="post-item-image-view">\n      <img src="">\n      <a href="#" class="image_control image_next"><span class="glyphicon glyphicon-chevron-right"></span></a>\n      <a href="#" class="image_control image_prev"><span class="glyphicon glyphicon-chevron-left"></span></a>\n   </div>\n   <div class="row thumbnail-list">\n   {{#each images}}\n      <div class="col-xs-2">\n         <a  href="#" class="thumbnail-list-item">\n            <img id=\'{{@index}}\' src="{{this.thumbnail}}">\n         </a>\n      </div>\n   {{/each}}\n   </div>\n{{else}}\n   <p>No images</p>\n{{/if}}\n'}),define("posts/item/ItemImagesView",["marionette","vent","posts/PostModel","text!posts/item/tpl-item-images.html"],function(e,t,n,r){var i=e.ItemView.extend({template:r,events:{"click .thumbnail-list-item":"onThumbnailClick","click .post-item-image-view":"onClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mousemove:"onMouseMove"},ui:{imgWrap:".post-item-image-view",img:".post-item-image-view img",leftControl:".image_prev",rightControl:".image_next"},initialize:function(e){this.listenTo(this.model,"change:imgSelected",this.changeMainImage),this.listenTo(this.model,"change:status",this.renderStatus,this)},serializeData:function(){var e=this.model.toJSON();return e=_.extend(e,{has_images:e.images.length>0}),e},onRender:function(){this.model.getImagesLength()<=1?(this.$(".image_control").addClass("hide"),this.$(".thumbnail-list").addClass("hide")):this.$el.addClass("hover"),this.model.selectImage(0)},renderStatus:function(){this.model.is_active()?this.$(".sold-tag").addClass("hide"):this.$(".sold-tag").removeClass("hide")},onThumbnailClick:function(e){this.model.selectImage(e.target.id)},changeMainImage:function(e){this.ui.imgWrap.find("img").attr("src",this.model.getSelectedImageSrc())},onImageOut:function(){this.ui.imgWrap.find("a").removeClass("hover")},onMouseEnter:function(){this.$el.addClass("hover")},onMouseLeave:function(){this.$el.removeClass("hover")},onMouseMove:function(e){var t=e.clientX-this.$el.offset().left;t<this.$el.width()/2?(this.ui.leftControl.addClass("active"),this.ui.rightControl.removeClass("active")):(this.ui.rightControl.addClass("active"),this.ui.leftControl.removeClass("active"))},onClick:function(e){var t=e.clientX-this.$el.offset().left;t<this.$el.width()/2?this.model.selectPrevImage():this.model.selectNextImage()},beforeDestroy:function(){this.stopListening()}});return i}),define("text!posts/item/tpl-item-comment.html",[],function(){return'\n<div class="comment-img">\n   <img src="{{user.picture_thumb}}">\n</div>\n<div id="comment-{{id}}" class="comment-text">\n   {{#if is_owner}}\n      <a class="dropdown-toggle edit-comment-btn" data-toggle="dropdown" href="#">\n         <span class="glyphicon glyphicon-pencil"></span>\n      </a>\n      <ul class="dropdown-menu no-transition dropdown-comments-edit">\n         <li><a id=\'edit-{{id}}\' class=\'edit\' href="#">Edit</a></li>\n         <li><a class=\'delete\' href="#">Delete</a></li>\n      </ul>\n   {{/if}}\n   <p ><a href="/u/{{user.user_name}}" class=\'comment-username\'>{{user.user_name}}</a> <span class="timeago date sub-text" title="{{created_at}}"></span></p>\n   <p class="comment-content">{{comment}}</p> \n   \n</div>\n\n<div id="edit-form-{{id}}" class="edit-form"></div>\n\n'}),define("posts/item/ItemCommentsView",["jquery","underscore","marionette","vent","reqres","posts/CommentModel","text!posts/item/tpl-item-comment.html","jquery.textcomplete","jquery.slimscroll","jQuery-linkify"],function(e,t,n,r,i,s,o){var u=!1,a="Press ESC to cancel. @ to tag friends",f="#edit-form-",l="#comment-",c=new Backbone.Form({schema:{comment:{type:"TextArea",validators:["required"],title:""}},idPrefix:"input-"}),h=new Backbone.Form({schema:{comment:{type:"TextArea",validators:["required"],title:"",editorAttrs:{placeholder:"Write a comment..."}}},idPrefix:"input-"}),p=function(e,n){var r=this,i=t.map(e.match(/@(\w+)( \w+)*/g),function(e){return e.slice(1)});i=t.intersection(i,t.keys(n));var s=t.map(i,function(e){return n[e].id});return s.join()},d=function(n,r){var i=this;n.textcomplete([{mentions:t.keys(r),match:/@(\w*)( \w+)*$/,search:function(t,n){n(e.map(this.mentions,function(e){var n=new RegExp(t,"i");return t.length!=0&&n.test(e)?e:null}))},template:function(e){return'<img src="'+r[e].picture+'"></img><span>'+e+"</span>"},index:1,replace:function(e){return"@"+e+"  "}}],{maxCount:5,className:"dropdown-textcomplete-tagging",debounce:50}).on({"textComplete:show":function(e){u=!0},"textComplete:hide":function(e){u=!1}})},v=n.ItemView.extend({template:o,tagName:"li",ui:{timeago:".timeago",editForm:".edit-form",content:".comment-content"},events:{"click .delete":"onClickDelete","click .edit":"onClickEdit","keyup @ui.editForm":"onEditKeyUp","click .comment-username":"onCommentUserClick"},initialize:function(e){var t=this;i.request("currentUser").getFBFriends(function(e){t.friends=e})},onRender:function(){this.form=c.render(),this.ui.timeago.timeago(),this.ui.content.linkify()},onClickDelete:function(){var e=confirm("Are you sure you want to delete this comment?");if(e==0)return;this.model.destroy()},onClickEdit:function(e){this.trigger("close:last:edit");var t=e.target.id.replace("edit-","");this.goEditMode(t),this.trigger("set:current:edit",this.model),d(this.$(f+t+" > #input-comment"),this.friends)},onEditKeyUp:function(e){var t=e.keyCode||e.which,n=13,r=27;e.preventDefault(),t===n&&!u?this.updateComment():t===r&&(this.showComment(),this.$(f+this.id+" > #input-comment").textcomplete("destroy"))},updateComment:function(){if(this.form.validate())return;var e=this,n=this.form.getValue();this.model.set(n),this.showComment();var i=p(n.comment,this.friends);n.comment=n.comment.trim(),this.model.save(t.extend(n,{fb_ids:i}),{success:function(e,t){},error:function(e,t,n){r.trigger("flash:alert",{type:"error",msg:t.responseText})}})},goEditMode:function(e){this.$(l+e).hide(),this.$(f+e).append(this.form.fields.comment.editor.el).append('<p id="edit-helper-msg">'+a+"</p>").find("textarea").focus().val(this.model.get("comment"))},showComment:function(){this.$(f+this.model.id).empty(),this.ui.content.text(this.model.get("comment")),this.ui.content.linkify(),this.$(l+this.model.id).show()},onCommentUserClick:function(){r.trigger("close:modal"),r.trigger("navigate:posts:user",this.model.get("user").user_name)},onBeforeDestroy:function(){this.ui.timeago.timeago("dispose")}}),m=n.CompositeView.extend({template:'<div class="comment-list-wrap">               <ul class="comment-list"></ul>               </div>               <div id="comment-form"></div>',childView:v,childViewContainer:".comment-list",childEvents:{"close:last:edit":function(){this.current_edit&&(e(f+this.current_edit.id).empty(),e(l+this.current_edit.id).show(),this.current_edit=null)},"set:current:edit":function(e){this.current_edit=e.model}},ui:{commentForm:"#comment-form"},events:{"keyup @ui.commentForm":"onKeyUp"},initialize:function(e){this.in_circle=i.request("currentUser").isInCircle(this.model.get("joined_circles"));var t=this;i.request("currentUser").getFBFriends(function(e){t.friends=e,d(t.$("#comment-form > #input-comment"),t.friends)})},onShow:function(){if(!i.request("isLoggedIn")||!this.in_circle){this.ui.commentForm.append("<hr><small>*Please log in or be in the group to comment</small>");return}this.form=h.render(),this.ui.commentForm.append(this.form.fields.comment.editor.el).append("<small>Hint: @ to tag friends</small>")},onKeyUp:function(e){var t=e.keyCode||e.which,n=13,r=27;if(t===n&&!u)return e.preventDefault(),this.addComment(),!1},addComment:function(){if(this.form.validate())return;var e=this.form.getValue().comment.trim();if(e==="")return;this.form.setValue({comment:""});var n=p(e,this.friends),i=this;this.collection.create(t.extend({comment:e},{fb_ids:n}),{wait:!0,success:function(e,t){i.collection.add(e)},error:function(e,t,n){r.trigger("flash:alert",{type:"error",msg:t.responseText})}})},onBeforeDestroy:function(){}});return m}),define("templates/UserProfileView",["marionette","vent"],function(e,t){var n='<span class="user-wrap"><a class="user-link" href="/u/{{user_name}}">                           <span class="user-name">                              {{user_name}}                           </span>                        </a></span>',r='<span class="user-wrap-with-picture"><a class="user-link" href="/u/{{user_name}}">                           <img src="{{picture}}" class="img-circle user-pic">                           <span class="user-name">                              {{user_name}}                           </span>                        </a></span>',i=e.ItemView.extend({getTemplate:function(){return this.withPicture?r:n},tagName:"span",events:{"click .user-link":"onUserClick"},serializeData:function(){return this.user},initialize:function(e){_.defaults(e,{withPicture:!0,modalMode:!1}),this.user=e.user,this.modalMode=e.modalMode,this.withPicture=e.withPicture},onRender:function(){},onUserClick:function(){if(is_canvas)return;this.modalMode&&t.trigger("close:modal"),t.trigger("navigate:posts:user",this.user.user_name)}});return i}),define("posts/item/PostItemPageView",["marionette","vent","posts/PostModel","posts/CommentModel","text!posts/item/tpl-item-layout.html","text!posts/item/tpl-item-buyer-action.html","posts/item/ItemSellerActionView","posts/item/ItemBuyerActionView","posts/item/ItemImagesView","posts/item/ItemCommentsView","templates/TimeagoView","templates/UserProfileView","templates/HashtagsView","jQuery-linkify"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p=e.LayoutView.extend({template:i,events:{"click @ui.postPrev":"onPrevPostClick","click @ui.postNext":"onNextPostClick","click .fb-share-btn":"onfbShareClick"},ui:{bookmarkLabel:".bookmark-label",postPrev:".post-prev",postNext:".post-next"},regions:{action:".post-item-action",images:".post-item-images-side",comments:".post-item-comments",timeago:".timeago-region",userProfile:".user-profile-region",hashtags:".hashtags-region"},initialize:function(e){this.model=e.model,this.prevenResetUrl=!1,this.fromURL=e.fromURL,this.listenTo(this.model,"change:is_bookmarked",this.renderBookmark,this);if(this.model.modalMode){this.goPrev=!0,this.goNext=!0;if(this.model.collection){var t=this.model.collection.indexOf(this.model);t===0?this.goPrev=!1:t===this.model.collection.length-1&&(this.goNext=!1)}}},onfbShareClick:function(){t.trigger("posts:fb:share",this.model.id)},onRender:function(){if(this.model.modalMode){this.goPrev||this.ui.postPrev.addClass("hide"),this.goNext||this.ui.postNext.addClass("hide");var e=this;window.history.replaceState&&window.history.replaceState({},"","/posts/"+this.model.id),this.$el.find(".name-link").attr("title","See post page").tooltip({placement:"bottom"}).click(function(){t.trigger("close:modal"),t.trigger("navigate:posts:item",e.model.id)});var e=this;$("body").on("keyup.postPopupNavigate",function(n){var r=n.keyCode||n.which,i=37,s=39,o=27;r==i?e.onPrevPostClick():r==s?e.onNextPostClick():r==o&&t.trigger("close:modal")})}this.model.is_owner()?this.action.show(new o({model:this.model})):this.action.show(new u({model:this.model})),this.$(".post-description").linkify(),this.images.show(new a({model:this.model}));var n=new r([],{post_id:this.model.id}),e=this;t.trigger("region:deferredShow",this.comments,n.fetch(),{success:function(t){e.comments&&e.comments.show(new f({model:e.model,collection:n}))},error:function(e){t.trigger("flash:alert",{type:"error",msg:e.responseText})}}),this.timeago.show(new l({time:this.model.get("created_at"),showTooltip:!0})),this.userProfile.show(new c({user:this.model.get("user"),modalMode:this.model.modalMode})),this.hashtags.show(new h({hashtags:this.model.get("hashtags"),modalMode:this.model.modalMode}))},renderBookmark:function(){var e=this.model.get("is_bookmarked");e?this.ui.bookmarkLabel.empty().append('<span class="label label-danger">'+e+"</span>"):this.ui.bookmarkLabel.empty().append('<span class="label label-success">'+e+"</span>")},onPrevPostClick:function(){this.goPrev&&(this.prevenResetUrl=!0,t.trigger("open:modal:post",this.model.collection.prev(),this.fromURL))},onNextPostClick:function(){this.goNext&&(this.prevenResetUrl=!0,t.trigger("open:modal:post",this.model.collection.next(),this.fromURL))},onBeforeDestroy:function(){this.model.modalMode&&window.history.replaceState&&!this.prevenResetUrl&&window.history.replaceState({},"","/"+this.fromURL),$("body").off("keyup.postPopupNavigate")}});return p}),define("text!posts/edit/tpl-post-edit.html",[],function(){return'<div class="row">\n    <div class="col-sm-8 col-md-8 col-md-offset-2 col-sm-offset-2" >\n       <h3>Update Your Post!</h3>\n       <hr>\n       <div id="edit-post-form"></div>\n       <hr>\n              \n       <h4>Edit or add more pictures!</h4>\n       <p>No more than 6 pictures</p>\n       <div id=\'post-picture-error\'></div>\n       <div id=\'post-picture-wrap\'></div>\n      \n       <hr>\n       <a href="#" id="save-btn" class="btn btn-lg btn-primary btn-block">Save Changes</a>\n       \n   </div>\n   \n</div>\n'}),define("posts/edit/PostEditPageView",["marionette","vent","posts/PostModel","text!posts/edit/tpl-post-edit.html","posts/edit/BaseView"],function(e,t,n,r,i){var s=i.extend({template:r,initialize:function(e){this.initializeBase(e),this.block_edit=!1},ui:_.extend({},i.prototype.ui,{PostForm:"#edit-post-form",saveBtn:"#save-btn"}),events:_.extend({},i.prototype.events,{"click @ui.saveBtn":"editPost"}),onRender:function(){this.form.setValue({name:this.model.get("name"),price:this.model.get("price"),description:this.model.get("description"),categories:this.categories.getCategory(this.model.get("hashtags"))}),this.renderBase();var e=this;_.each(this.model.get("hashtags"),function(t){e.tags.tagsinput("add",t)});var e=this;this.listenTo(this.uploadManager,"uploadManager:start",function(){e.block_edit=!0}),this.listenTo(this.uploadManager,"uploadManager:done",function(){e.block_edit=!1})},editPost:function(){if(this.block_edit)return;var e=this.validate();if(e)return $(document).scrollTop(0);this.ui.saveBtn.button("loading");var n=this;this.model.save(this.getFormValue(),{patch:!0,wait:!0,success:function(e,r){t.trigger("navigate:posts:item",n.model.id),t.trigger("flash:alert",{type:"success",msg:r})},error:function(e,r){t.trigger("flash:alert",{type:"error",msg:r.responseText}),n.ui.saveBtn.button("reset")}})}});return s}),define("messages/messageView/MessageForm",["backbone-forms","bbf-bootstrap3"],function(){var e=new Backbone.Form({schema:{message:{type:"TextArea",validators:["required"],editorAttrs:{placeholder:"Type your message...",rows:3}}},idPrefix:"input-"});return e}),define("messages/messageView/MessageInputView",["underscore","marionette","vent","messages/messageView/MessageForm"],function(e,t,n,r){var i=Backbone.Marionette.ItemView.extend({template:'<div id="message-input-form"></div>',initialize:function(e){e||(e={}),this.options.sendOnEnter=e.sendOnEnter||"true"},ui:{inputForm:"#message-input-form"},events:{"keypress @ui.inputForm":"sendOnEnter"},onRender:function(){this.form=r.render(),this.ui.inputForm.append(this.form.fields.message.editor.el)},sendOnEnter:function(e){var t=e.keyCode||e.which,n=13;t==n&&!e.shiftKey&&(e.preventDefault(),this.onMessageSend())},onMessageSend:function(){var e=this.form.validate();if(e)return;var t=this;return this.trigger("messageSubmit",this.form.getValue(),function(){t.resetForm()})},resetForm:function(){this.form&&this.form.setValue({message:""})}});return i}),define("text!messages/messageView/tpl-messages-board-item.html",[],function(){return"<div>\n   <p class='message-title'>\n      <b>\n      {{#if is_owner}}\n         You:\n      {{else}}\n         {{name}}\n      {{/if}}\n      </b>\n      <small><span class=\"timeago-region\"></span></small>\n   </p>\n   <div class='message-bubble'>\n      {{body}}\n   </div>\n\n</div>\n"}),define("messages/messageView/MessagesBoardView",["backbone","marionette","vent","reqres","templates/TimeagoView","templates/LoadingSignView","messages/messageView/MessageForm","messages/messageView/MessageInputView","text!messages/messageView/tpl-messages-board-item.html","jquery.slimscroll"],function(e,t,n,r,i,s,o,u,a){var f=t.LayoutView.extend({template:a,tagName:"div",className:"message-item",regions:{timeago:".timeago-region"},onRender:function(){this.timeago.show(new i({time:this.model.get("created_at")}))}}),l=t.CollectionView.extend({childView:f,tagName:"div",className:"message-board",initialize:function(e){this.rendered=!1,this.container=e.container},onRender:function(){this.rendered=!0},scrollBot:function(){var e=$(this.el).height();this.container.slimScroll({scrollTo:e})},onAddChild:function(){this.rendered&&this.scrollBot()}}),c=t.LayoutView.extend({tagName:"div",template:"<div class='messages-container'></div>                   <div class='message-main-input-region'></div>",regions:{container:".messages-container",inputRegion:".message-main-input-region"},ui:{noChatView:".no-chat"},defaults:{height:"400px"},initialize:function(e){this.chat=e.chat,this.inputView=new u,this.listenTo(this.inputView,"messageSubmit",this.sendMessage),this.chat&&this.listenTo(this.chat,"change:read",this.onChatUpdate),this.msgView=null},onShow:function(){this.$(".messages-container").slimScroll({height:this.defaults.height,distance:"2px"}).closest(".slimScrollDiv").css({height:this.defaults.height}),this.fetchMessages(),this.inputRegion.show(this.inputView)},updateChat:function(e){if(this.chat){if(this.chat.get("id")==e.get("id"))return;this.stopListening(this.chat)}this.chat=e,this.inputView.resetForm(),this.listenTo(this.chat,"change:read",this.onChatUpdate),this.fetchMessages()},onChatUpdate:function(){if(!this.chat)return;this.chat.hasRead()||this.fetchMessages()},fetchMessages:function(){if(!this.chat)return;var e=this;e.container.show(new s),this.chat.fetchMessages().done(function(t){if(!e.container)return;e.msgView=new l({collection:t,container:e.$(".messages-container")}),e.container.show(e.msgView),e.msgView.scrollBot()})},sendMessage:function(e,t){n.trigger("messages:send",this.chat,e,t)},onBeforeDestroy:function(){console.log("destroy Message board view")}});return c}),define("text!messages/postChats/tpl-post-chats-list.html",[],function(){return""}),define("messages/postChats/PostChatsView",["marionette","vent","reqres","templates/TimeagoView","messages/messageView/MessagesBoardView","text!messages/postChats/tpl-post-chats-list.html"],function(e,t,n,r,i,s){var o=e.LayoutView.extend({template:'<td>{{contact_name}}{{#if is_unread}}<small>(unread)</small>{{/if}} </td>                 <td><span class="item-time"></span></td>',tagName:"tr",className:"chat-list-item",events:{click:"onClick"},regions:{itemTime:".item-time"},initialize:function(){this.listenTo(this.model,"change:read",this.render)},onRender:function(){this.itemTime.show(new r({time:this.model.get("modified_at")}))},onClick:function(){t.trigger("navigate:messages:chatList",this.model)}}),u=e.ItemView.extend({template:'<div style="padding:10px">No chats yet</div>'}),a='<table class="table table-condensed table-hover"><thead><tr>           <th>Contact user</th>           <th>time</th>         </tr></thead><tbody></tbody></table>',f=e.CompositeView.extend({template:a,childViewContainer:"tbody",childView:o,emptyView:u}),l=e.LayoutView.extend({template:'<div class="post-chats-list-region"></div>                 <div class="message-board-wrap">                     <a href="#" class="go-back-link">Go Back</a>                     <div class="message-board-region"></div>                   </div>',initialize:function(e){this.post=e.post,this.listenTo(t,"navigate:messages:chatList",this.onChatClick),this.post?this.chatListView=new f({collection:this.post.get("chats")}):this.chatListView=new f,this.messageView=new i},events:{"click .go-back-link":"onBackClick"},className:"post-chat-list-wrap",regions:{content:".post-chats-list-region",messageBoard:".message-board-region"},onShow:function(){this.content.show(this.chatListView),this.messageBoard.show(this.messageView)},onChatClick:function(e){this.$el.addClass("message-mode"),this.messageView.updateChat(e)},onBackClick:function(){this.$el.removeClass("message-mode")}});return l}),define("text!posts/owner/tpl-item-owner.html",[],function(){return'<ul class="nav nav-pills">\n  <li class=\'owner-tab\' data-tab-option="view"><a href="#">View</a></li>\n  <li class=\'owner-tab\' data-tab-option="edit"><a href="#">Edit</a></li>\n  <li class=\'owner-tab\' data-tab-option="chats"><a href="#">Offers/chats</a></li>\n  <li role="presentation" class="dropdown">\n    <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-expanded="false">\n      Action <span class="caret"></span>\n    </a>\n    <ul class="dropdown-menu no-transition dropdown-action" role="menu">\n      <li><a href="#" id="toggle-status-btn"></a></li>\n      <li><a href="#" id="delete-btn">Delete</a></li>\n    </ul>\n  </li>\n</ul>\n<div class=\'item-content-region\'></div>'}),define("posts/owner/ItemOwnerView",["backbone","marionette","vent","reqres","posts/item/PostItemPageView","posts/edit/PostEditPageView","messages/postChats/PostChatsView","text!posts/owner/tpl-item-owner.html"],function(e,t,n,r,i,s,o,u){var a=t.LayoutView.extend({template:u,regions:{content:".item-content-region"},events:{"click .owner-tab ":"onTabClick","click #delete-btn":"onDeleteClick","click @ui.toggleStatusBtn":"onToggleStatusClick"},ui:{toggleStatusBtn:"#toggle-status-btn"},className:"post-item-owner",initialize:function(e){e=e||{},this.tab=e.tab||"view",this.listenTo(this.model,"change:status",this.renderStatus,this)},onShow:function(){this.renderContent(),this.renderStatus()},renderContent:function(){this.$(".owner-tab").removeClass("active"),this.$('[data-tab-option="'+this.tab+'"]').addClass("active");if(this.tab==="view")this.content.show(new i({model:this.model})),e.history.navigate("posts/"+this.model.id);else if(this.tab==="edit")this.content.show(new s({model:this.model,categories:r.request("categories")})),e.history.navigate("posts/"+this.model.id+"/edit");else if(this.tab==="chats"){var t=this;n.trigger("messages:getPost",this.model.id,function(e){t.content.show(new o({post:e}))}),e.history.navigate("posts/"+this.model.id+"/chats")}},renderStatus:function(){var e=this.model.get("status");e=="active"?this.ui.toggleStatusBtn.text("Set to Sold"):this.ui.toggleStatusBtn.text("Set to Selling")},updateTab:function(e){if(this.tab===e)return;this.tab=e,this.renderContent()},onTabClick:function(e){var t=$(e.target).parent().data("tab-option");this.updateTab(t)},onDeleteClick:function(){var e=this;n.trigger("posts:deleteAttempt",this.model,function(){e.model.modalMode&&n.trigger("close:modal")})},onToggleStatusClick:function(){console.log("TOGGLE"),this.model.toggleStatus().done(function(e){}).fail(function(e){n.trigger("flash:alert",{type:"error",msg:e.responseText})})}});return a}),define("posts/PostController",["backbone","marionette","vent","reqres","posts/PostModel","posts/user/UserModel","posts/edit/PostCreatePageView","posts/user/UserPostPageView","posts/item/PostItemPageView","posts/edit/PostEditPageView","posts/owner/ItemOwnerView"],function(e,t,n,r,i,s,o,u,a,f,l){var c=t.Controller.extend({showMyPostPage:function(){n.trigger("mainRegion:show",new u({user:r.request("currentUser")}))},showUserPostPage:function(e){if(e==r.request("currentUser").get("user_name"))return this.showMyPostPage();var t=new s({user_name:e}),i=t.fetch();n.trigger("mainRegion:deferredShow",i,{success:function(e){n.trigger("mainRegion:show",new u({user:t}))}})},showItemPostPageModel:function(e){n.trigger("domChange:title",r.request("page:name").viewItem),n.trigger("mainRegion:show",new a({model:e}))},showCreatePostPage:function(){n.trigger("domChange:title",r.request("page:name").create);var e=new o({categories:r.request("categories"),model:new i.model});n.trigger("mainRegion:show",e)},showOwnerItemPage:function(e,t){this.ownerPageView=new l({model:e,tab:t}),n.trigger("mainRegion:show",this.ownerPageView)},showItemPostPage:function(e){n.trigger("domChange:title",r.request("page:name").viewItem);var t=new i.model({id:e}),s=t.fetch(),o=this;n.trigger("mainRegion:deferredShow",s,{success:function(e){t.is_owner()?o.showOwnerItemPage(t,"view"):n.trigger("mainRegion:show",new a({model:t}))}})},showEditPostPage:function(e){n.trigger("domChange:title",r.request("page:name").editItem);var t=new i.model({id:e}),s=this,o=t.fetch();n.trigger("mainRegion:deferredShow",o,{success:function(e){t.is_owner()?s.showOwnerItemPage(t,"edit"):n.trigger("navigate:404Page")}})},showPostChatsPage:function(e){n.trigger("domChange:title",r.request("page:name").editItem);var t=new i.model({id:e}),s=this,o=t.fetch();n.trigger("mainRegion:deferredShow",o,{success:function(e){t.is_owner()?s.showOwnerItemPage(t,"chats"):n.trigger("navigate:404Page")}})},deleteAttempt:function(e,t){var r=confirm("Are you sure you want to delete this?");if(r==0)return;e.destroy({wait:!0,success:function(e,r){n.trigger("navigate:account:posts"),t&&t(),n.trigger("flash:alert",{type:"success",msg:r})},error:function(e,t){n.trigger("flash:alert",{type:"error",msg:t.responseText})}})},bookmarkAttempt:function(e,t){if(!r.request("isLoggedIn"))return n.trigger("navigate:login");var i;e.get("is_bookmarked")?i=e.unbookmark():i=e.bookmark(),i.done(function(e){t&&t(e)}).fail(function(e){n.trigger("flash:alert",{type:"error",msg:e.responseText})})}}),h=new c,p=["showCreatePostPage","showMyPostPage","showEditPostPage","showPostChatsPage","deleteAttempt"];return r.request("session").setLoginRequired(h,p),h.listenTo(n,"posts:deleteAttempt",function(e,t){h.deleteAttempt(e,t)}),h.listenTo(n,"navigate:posts:user",function(t){h.showUserPostPage(t),e.history.navigate("/u/"+t)}),h.listenTo(n,"navigate:posts:edit",function(t){h.showEditPostPage(t),e.history.navigate("posts/"+t+"/edit")}),h.listenTo(n,"navigate:createPost",function(){h.showCreatePostPage(),e.history.navigate("posts/create")}),h.listenTo(n,"navigate:posts:item:model",function(t){h.showItemPostPageModel(t),e.history.navigate("posts/"+t.get("id"))}),h.listenTo(n,"navigate:posts:item",function(t){h.showItemPostPage(t),e.history.navigate("/posts/"+t)}),h.listenTo(n,"posts:bookmarkAttempt",function(e,t){h.bookmarkAttempt(e,t)}),h.listenTo(n,"posts:fb:share",function(e){var t="http://www.facebook.com/sharer.php?u=http://www.DoubleDibz.com/posts/"+e;window.open(t,"Facebook","width=675,height=376,resizable=0")}),h}),define("buy_requests/edit/BuyRequestForm",["backbone","backbone-forms","bbf-bootstrap3"],function(e){var t=6,n=e.Form.extend({schema:{name:{type:"Text",validators:["required"],editorAttrs:{placeholder:"What are you looking for?"}},categories:{type:"Select",title:"Category",validators:["required"],options:[]},hashtags:{type:"Text",title:"Hashtags",validators:["required",function(n,r){var i={type:"hashtags",message:"Please enter no more than 6 tags"};if(n.split(",").length>t)return i},function(t,n){var r={type:"hashtags",message:"Hashtags can only be underscore (_), uppercase or lowercase caracters."},i=_.find(t.split(","),function(e){return!/^([a-zA-Z0-9_]+)$/.test(e.trim())});if(i)return r}]},description:{type:"TextArea",validators:["required"],editorAttrs:{rows:10,placeholder:"Brief description of item..."}}},idPrefix:"input-"});return n}),define("buy_requests/edit/BaseView",["marionette","vent","buy_requests/BuyRequestModel","buy_requests/edit/BuyRequestForm","general/FlashMessageView","bloodhound","bootstrap-tagsinput","typeahead","posts/upload-manager/backbone.upload-manager"],function(e,t,n,r,i){var s=e.ItemView.extend({initializeBase:function(e){this.categories=e.categories,this.tags=null,this.cat={name:"",text:"",type:"category"},this.hashtags=null,this.form=(new r).render(),this.form.fields.categories.editor.setOptions(this.categories.toOptions()),this.initializeBloodhound()},events:{"change #input-categories":"updateCategory"},initializeBloodhound:function(){this.hashtags=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:"/api/hashtags",ttl:6e5,filter:function(e){return $.map(e.data,function(e){return{name:e,type:"hashtag"}})}}}),this.hashtags.initialize()},renderBase:function(){this.renderForm(),this.cat.name=this.form.getValue("categories"),this.renderTags()},renderForm:function(){this.ui.BuyRequestForm.append(this.form.el)},renderTags:function(){this.tags=$(this.el).find("input#input-hashtags"),this.tags.tagsinput({trimValue:!0,itemValue:"name",itemText:function(e){return"#"+e.name},freeInput:!0,tagClass:"label label-primary",confirmKeys:[13,32,44],typeaheadjs:{name:"hashtags",displayKey:"name",source:this.hashtags.ttAdapter(),templates:{suggestion:Handlebars.compile("<p>#{{name}}</p>")}}}),this.tags.tagsinput("add",this.cat),this.tagInput=this.tags.tagsinput("input"),this.tagInput.on("blur",$.proxy(function(e){this.tagInput.val("")},this)),this.tags.on("beforeItemRemove",function(e){e.item.type&&e.item.type=="category"&&(e.cancel=!0)}),this.tags.on("itemAdded",$.proxy(function(){var e=this.form.fields.hashtags.validate()},this)),this.tags.on("itemRemoved",$.proxy(function(){var e=this.form.fields.hashtags.validate()},this)),$(document.body).on("focus.tagsinput",".bootstrap-tagsinput",function(){$(this).addClass("focus")}).on("blur.tagsinput",".bootstrap-tagsinput",function(){$(this).removeClass("focus")})},updateCategory:function(e){this.cat.name=this.form.getValue("categories"),this.tags.tagsinput("refresh")},getFormValue:function(){return{name:this.form.getValue("name"),hashtags:this.getHashtags(),description:this.form.getValue("description")}},getHashtags:function(){var e=_.map(this.tags.tagsinput("items"),function(e){return e.name});return e.join(",")},validate:function(){var e=this.form.validate();return this.form.on("change",function(e,t){e.validate()}),e?!0:!1},onBeforeDestroy:function(){$(document.body).off("focus.tagsinput blur.tagsinput")}});return s}),define("text!buy_requests/edit/tpl-create-buy-request.html",[],function(){return'<div class="row">\n    <div class="col-sm-8 col-md-8 col-md-offset-2 col-sm-offset-2" >\n      <h3>What are you looking for?</h3>\n      <hr>\n      <div id="create-buy-request-form"></div>\n      \n      <hr>\n      <a href="#" id="create-btn" class="btn btn-lg btn-primary btn-block">Create</a>\n      \n   </div>\n   \n</div>\n'}),define("buy_requests/edit/BuyRequestCreatePageView",["jquery","marionette","vent","buy_requests/BuyRequestModel","buy_requests/edit/BaseView","text!buy_requests/edit/tpl-create-buy-request.html","general/FlashMessageView","backbone-forms","bbf-bootstrap3"],function(e,t,n,r,i,s,o){var u=i.extend({template:s,initialize:function(e){this.initializeBase(e),this.form.setValue({categories:this.categories.at(0).get("name")})},ui:_.extend({},i.prototype.ui,{BuyRequestForm:"#create-buy-request-form",createBtn:"#create-btn"}),events:_.extend({},i.prototype.events,{"click @ui.createBtn":"createBuyRequest"}),onRender:function(){this.renderBase()},createBuyRequest:function(){var t=this.form.validate();this.form.on("change",function(e,t){e.validate()});if(t){e(document).scrollTop(0);return}this.ui.createBtn.button("loading");var r=this;this.model.save(this.getFormValue(),{wait:!0,success:function(e,t){n.trigger("navigate:account:posts"),n.trigger("flash:alert",{type:"success",msg:t})},error:function(e,t,i){n.trigger("flash:alert",{type:"error",msg:t.responseText}),r.ui.createBtn.button("reset")}})}});return u}),define("text!buy_requests/edit/tpl-edit-buy-request.html",[],function(){return'<div class="row">\n    <div class="col-sm-8 col-md-8 col-md-offset-2 col-sm-offset-2" >\n      <h3>Edit your wishlist</h3>\n      <hr>\n      <div id="edit-buy-request-form"></div>\n      \n      <hr>\n      <a href="#" id="save-btn" class="btn btn-lg btn-primary btn-block">Save Changes</a>\n      \n   </div>\n   \n</div>\n'}),define("buy_requests/edit/BuyRequestEditPageView",["marionette","vent","buy_requests/BuyRequestModel","buy_requests/edit/BaseView","text!buy_requests/edit/tpl-edit-buy-request.html","backbone-forms","bbf-bootstrap3"],function(e,t,n,r,i){var s=r.extend({template:i,ui:_.extend({},r.prototype.ui,{BuyRequestForm:"#edit-buy-request-form",saveBtn:"#save-btn"}),events:_.extend({},r.prototype.events,{"click @ui.saveBtn":"editBuyRequest"}),initialize:function(e){this.initializeBase(e)},onRender:function(){this.form.setValue({name:this.model.get("name"),description:this.model.get("description"),categories:this.categories.getCategory(this.model.get("hashtags"))}),this.renderBase();var e=this;_.each(this.model.get("hashtags"),function(t){e.tags.tagsinput("add",t)})},editBuyRequest:function(){if(this.block_edit)return;var e=this.validate();if(e){$(document).scrollTop(0);return}this.ui.saveBtn.button("loading");var n=this;this.model.save(this.getFormValue(),{patch:!0,wait:!0,success:function(e,n){t.trigger("navigate:account:posts"),t.trigger("flash:alert",{type:"success",msg:n})},error:function(e,r){t.trigger("flash:alert",{type:"error",msg:r.responseText}),n.ui.saveBtn.button("reset")}})}});return s}),define("buy_requests/BuyRequestController",["backbone","marionette","vent","reqres","buy_requests/BuyRequestModel","buy_requests/edit/BuyRequestCreatePageView","buy_requests/edit/BuyRequestEditPageView","buy_requests/templates/BuyRequestListView"],function(e,t,n,r,i,s,o,u){var a=t.Controller.extend({initialize:function(e){},showCreateBuyRequestPage:function(){n.trigger("domChange:title",r.request("page:name").create);var e=new s({categories:r.request("categories"),model:new i.model});n.trigger("mainRegion:show",e)},showEditBuyRequestPage:function(e){n.trigger("domChange:title",r.request("page:name").editItem);var t=new i.model({id:e}),s=this,u=t.fetch();n.trigger("mainRegion:deferredShow",u,{success:function(e){if(!t.is_owner())return n.trigger("navigate:404Page");n.trigger("mainRegion:show",new o({categories:r.request("categories"),model:t}))}})},showBuyRequestListPage:function(){n.trigger("domChange:title",r.request("page:name").myposts);var e=new i.collection,t=e.fetch();n.trigger("mainRegion:deferredShow",t,{success:function(t){var r=new u({collection:e});n.trigger("mainRegion:show",r)}})},deleteAttempt:function(e,t){var r=confirm("Are you sure you want to delete this?");if(r==0)return;e.destroy({wait:!0,success:function(e,r){n.trigger("navigate:account:posts"),t&&t(),n.trigger("flash:alert",{type:"success",msg:r})},error:function(e,t){n.trigger("flash:alert",{type:"error",msg:t.responseText})}})}}),f=new a,l=["showCreateBuyRequestPage","showEditBuyRequestPage"];return r.request("session").setLoginRequired(f,l),f.listenTo(n,"buyRequests:deleteAttempt",function(e){f.deleteAttempt(e)}),f.listenTo(n,"navigate:createBuyRequest",function(){f.showCreateBuyRequestPage(),e.history.navigate("buy_requests/create")}),f.listenTo(n,"navigate:buyRequests:edit",function(t){f.showEditBuyRequestPage(t),e.history.navigate("buy_requests/"+t+"/edit")}),f.listenTo(n,"navigate:buyRequests:list",function(){f.showBuyRequestListPage(),e.history.navigate("buy_requests/list")}),f}),define("text!search/tpl-search-filter.html",[],function(){return'<div class="row">\n   \n   <div class=\'col-xs-12\'>\n      <div class="input-group search-bar">\n         <span class="category-filter-wrap input-group-addon no-transition">\n            <a class="selected-category" href="#">\n               <span class=\'selected-text\'></span>\n               <span class="fui-triangle-down-small"></span>\n            </a>\n            \n            <select class="category-filter form-control">\n               <option value=\'everything\'>Everything</option>\n            </select>\n         </span>\n         <input class="form-control no-transition search-box-filter" type="search" placeholder="">\n         <span class="input-group-btn">\n            <button type="submit" class="btn search-btn"><span class="fui-search"></span></button>\n         </span>            \n      </div>\n   </div>\n   <div class=\'col-xs-12 \'>\n      <p class="pull-right">\n         I\'m  \n         <a href="#" data-filter-type="type" data-value="sell" class=\'search-filter type-filter\'>buying</a> |\n         <a href="#" data-filter-type="type" data-value="buy" class=\'search-filter type-filter\'>selling</a>\n      </p>\n      \n   </div>\n   <div class="col-xs-12 source-filter-wrap">\n      <p class="pull-right">\n         Source: \n         <a href="#" data-filter-type="src" data-value="all" class=\'search-filter source-filter\'>all</a> |\n         <a href="#" data-filter-type="src" data-value="fb" class=\'search-filter source-filter\'>Facebook</a> |\n         <a href="#" data-filter-type="src" data-value="us" class=\'search-filter source-filter\'>DoubleDibz</a>\n      </p>\n   </div>\n   <div class="col-xs-12 ">\n      <p class="pull-right">\n         From: \n         <a href="#" data-filter-type="from" data-value="all" class=\'search-filter from-filter\'>All Time</a> |\n         <a href="#" data-filter-type="from" data-value="today" class=\'search-filter from-filter\'>Today</a> |\n         <a href="#" data-filter-type="from" data-value="this-week" class=\'search-filter from-filter\'>This Week</a> |\n         <a href="#" data-filter-type="from" data-value="this-month" class=\'search-filter from-filter\'>This Month</a>\n      </p>\n   </div>\n   \n   <div class="col-xs-12 order-filter-wrap">\n      <p class="pull-right">\n         Sort By: \n         <a href="#" data-filter-type="order" data-value="date-desc" class=\'search-filter order-filter\'>Most Recent</a> |\n         <a href="#" data-filter-type="order" data-value="price-asc" class=\'search-filter order-filter\'>Least Expensive</a> |\n         <a href="#" data-filter-type="order" data-value="price-desc" class=\'search-filter order-filter\'>Most Expensive</a>\n      </p>\n   </div>\n   \n   <div class="col-xs-12">\n      <p class="search-result-num hide"><span></span> Results</p>\n   </div>\n</div>'}),define("search/SearchFilterView",["marionette","vent","reqres","text!search/tpl-search-filter.html"],function(e,t,n,r){var i=e.ItemView.extend({template:r,ui:{categorySelect:".category-filter",searchBox:".search-box-filter"},events:{"click .search-filter":"onFilterChange","change @ui.categorySelect":"onCategoryChange","keyup @ui.searchBox":"onSearchBoxKeyUp","click .search-btn":"onSearch"},initialize:function(e){this.search=e.search},onRender:function(){this.renderCategory(),this.renderDynamic()},renderDynamic:function(){this.$(".search-filter").removeClass("active"),this.$(".order-filter[data-value='"+this.search.args.order+"']").addClass("active"),this.$(".from-filter[data-value='"+this.search.args.from+"']").addClass("active"),this.$(".type-filter[data-value='"+this.search.args.type+"']").addClass("active"),this.$(".source-filter[data-value='"+this.search.args.src+"']").addClass("active"),this.search.args.type==="buy"?this.$(".order-filter-wrap").addClass("hide"):this.$(".order-filter-wrap").removeClass("hide"),this.updateCategoryText(),this.updateSearchBoxText()},renderCategory:function(){var e=this,t=n.request("categories");_.each(t.toJSON(),function(t){e.ui.categorySelect.append("<option value='"+t.name+"'>"+t.showName+"</option")})},onCategoryChange:function(){this.search.args.hashtag=this.ui.categorySelect.val(),this.search.args.hashtag==="everything"&&(this.search.args.hashtag=null),this.updateCategoryText()},updateSearchBoxText:function(){this.ui.searchBox.val(this.search.args.name)},updateCategoryText:function(){this.search.args.hashtag?this.ui.categorySelect.find('option[value="'+this.search.args.hashtag+'"]').prop("selected",!0):this.ui.categorySelect.find('option[value="everything"]').prop("selected",!0),this.$(".selected-text").text(this.$(".category-filter option:selected").text())},updateResultTotal:function(e){this.$(".search-result-num").removeClass("hide").find("span").text(e)},onFilterChange:function(e){var t=$(e.target);if(t.hasClass("active"))return;t.parent().children().removeClass("active"),t.addClass("active"),this.search.updateArgs(t.data("filter-type"),t.data("value")),this.onPagerGo(null)},onSearchBoxKeyUp:function(e){var t=e.keyCode||e.which,n=13;e.preventDefault(),t==n&&this.onSearch()},onSearch:function(){this.search.args.name=this.ui.searchBox.val(),this.onPagerGo(null)},onPagerGo:function(e){this.search.args.page=1,t.trigger("navigate:search",this.search.circle,this.search.args),$(document).scrollTop(0)}});return i}),define("text!search/tpl-search-layout.html",[],function(){return'<div class=\'search-filter-region\'></div>\n<hr>\n\n<div class="search-results-region"></div>\n\n<div id=\'post-list-pagination\'>\n\n\n</div>\n\n<div class="navigate-up">\n   <a href="#"><span class="glyphicon glyphicon-arrow-up"></span></a>\n</div>\n'}),define("search/SearchPageView",["marionette","vent","posts/PostModel","buy_requests/BuyRequestModel","posts/templates/PostListView","buy_requests/templates/BuyRequestListView","search/SearchFilterView","text!search/tpl-search-layout.html"],function(e,t,n,r,i,s,o,u){var a=e.LayoutView.extend({template:u,regions:{resultRegion:".search-results-region",filterRegion:".search-filter-region",pagination:"#post-list-pagination"},ui:{upBtn:".navigate-up"},events:{"click @ui.upBtn":"onUpClick"},className:"search-page-view",initialize:function(e){this.search=e.search,this.type=e.search.args.type,this.posts=new n.collection,this.buy_requests=new r.collection,this.filterView=new o({search:this.search}),this.pager=null,this.triggerLoadOffset=600,this.checkScroll=_.throttle(this.checkScroll,30),this.setCollection()},updateSearch:function(e){this.search=e,this.type=e.args.type,this.filterView.search=e,this.filterView.renderDynamic(),this.setCollection()},onShow:function(){var e=this.search.getPosts(),n=this;t.trigger("region:deferredShow",this.resultRegion,e,{success:function(e){n.collection.reset(e.data.result),n.pager=_.pick(e.data,"total","page","per_page"),n.filterView.updateResultTotal(n.pager.total),n.type=="sell"?n.resultRegion.show(new i({collection:n.collection})):n.resultRegion.show(new s({collection:n.collection}))},error:function(e){t.trigger("flash:alert",{type:"error",msg:e.responseText})}})},onRender:function(){this.filterRegion.show(this.filterView),$(window).on("scroll.listPage",_.bind(this.checkScroll,this))},loadNext:function(){var e=this;this.search.loadNextPage().done(function(t){e.collection.add(t.data.result)}).fail(function(e,n){t.trigger("flash:alert",{type:"error",msg:n.responseText})})},onUpClick:function(){$("body").scrollTop(0)},checkScroll:function(){window.scrollY>300?this.ui.upBtn.addClass("show"):this.ui.upBtn.removeClass("show");if(this.search.isLoading||this.pager.total<=this.collection.length)return;window.innerHeight+window.scrollY+this.triggerLoadOffset>=document.body.offsetHeight&&this.loadNext()},onDestroy:function(){$(window).off("scroll.listPage")},setCollection:function(){this.type==="sell"?this.collection=this.posts:this.collection=this.buy_requests}});return a}),define("text!posts/fbpost/tpl-fbpost-view.html",[],function(){return'<a href="#" class="post-control post-prev"><span class="fui-arrow-left"></span></a>\n<a href="#" class="post-control post-next"><span class="fui-arrow-right"></span></a>\n\n<div class="post-item panel panel-default">\n   <a class="modal-close-btn close">&times;</a>\n\n   <div class="panel-body">\n      <div class=\'row\'>\n         <div class="post-item-images-side col-sm-8"></div>\n      \n         <div class=\'post-item-side col-sm-4\'>\n            <div class=\'row\'>\n               <div class="col-xs-12">\n                  <h4><span class="fui-facebook"></span> Facebook Post</h4>\n                  <span class="bookmark-btn-region"></span>\n                  <a href="https://www.facebook.com/{{feed_id}}" id="contact-btn" class="btn btn-primary btn-block" data-bypass target=\'_blank\'>\n                     <span class="fui-mail"></span> Contact seller on FB\n                  </a>\n                  <hr>\n                  <p class=\'post-header-line\'>\n                     <span class=\'hashtags-region\'></span>\n                  </p>\n                  <p class=\'post-header-line post-price\'>\n                     <span class="glyphicon glyphicon-tag"></span> {{showPrice price}}   | <small><span class="timeago-region"></span></small>\n                  </p>\n\n                     <p>\n                        <span class="post-description">{{description}}</span>\n                     </p>\n                  <hr>\n               </div>\n               <div class="post-item-comments col-xs-12"></div>\n            </div>\n         </div>\n         \n      </div>\n   </div>\n\n</div>\n'}),define("posts/fbpost/FBPostView",["underscore","marionette","vent","reqres","templates/TimeagoView","posts/templates/BookmarkButtonView","text!posts/fbpost/tpl-fbpost-view.html","posts/item/ItemImagesView","templates/HashtagsView","jQuery-linkify"],function(e,t,n,r,i,s,o,u,a){var f=t.LayoutView.extend({template:o,events:{"click @ui.postPrev":"onPrevPostClick","click @ui.postNext":"onNextPostClick"},regions:{images:".post-item-images-side",timeago:".timeago-region",bookmarkBtn:".bookmark-btn-region",hashtags:".hashtags-region"},initialize:function(t){this.prevenResetUrl=!1,this.fromURL=t.fromURL,this.model.attributes.images=e.map(this.model.get("images"),function(t){return e.extend(t,{thumbnail:t.link})}),window.history.replaceState&&window.history.replaceState({},"","/posts/fb/"),this.goPrev=!0,this.goNext=!0;var n=this.model.collection.indexOf(this.model);n===0?this.goPrev=!1:n===this.model.collection.length-1&&(this.goNext=!1)},ui:{postPrev:".post-prev",postNext:".post-next"},onRender:function(){this.images.show(new u({model:this.model})),this.goPrev||this.ui.postPrev.addClass("hide"),this.goNext||this.ui.postNext.addClass("hide"),this.timeago.show(new i({time:this.model.get("created_at"),showTooltip:!0}));var e=this;$("body").on("keyup.postPopupNavigate",function(t){var r=t.keyCode||t.which,i=37,s=39,o=27;r==i?e.onPrevPostClick():r==s?e.onNextPostClick():r==o&&n.trigger("close:modal")}),this.$(".post-description").linkify(),this.bookmarkBtn.show(new s({model:this.model})),this.hashtags.show(new a({hashtags:this.model.get("hashtags"),modalMode:!0}))},onPrevPostClick:function(){this.goPrev&&(this.prevenResetUrl=!0,n.trigger("open:modal:post",this.model.collection.prev(),this.fromURL))},onNextPostClick:function(){this.goNext&&(this.prevenResetUrl=!0,n.trigger("open:modal:post",this.model.collection.next(),this.fromURL))},onBeforeDestroy:function(){window.history.replaceState&&!this.prevenResetUrl&&window.history.replaceState({},"","/"+this.fromURL),$("body").off("keyup.postPopupNavigate")}});return f}),define("search/SearchController",["marionette","vent","reqres","search/SearchModel","posts/PostModel","search/SearchPageView","posts/item/PostItemPageView","posts/fbpost/FBPostView"],function(e,t,n,r,i,s,o,u){var a=function(e){return _.isNull(e)?{}:_.object(_.map(e.split("&"),function(e){return e.split("=")}))},f=e.Controller.extend({initialize:function(){this.view=null},showDailyListingPage:function(){this.showSearchPage("ucla",{from:"today"})},showSearchPageFromUrl:function(e,t){this.showSearchPage(e,a(t))},showSearchPage:function(e,i,o){t.trigger("domChange:title",n.request("page:name").search);var u=new r(e,i);o&&o(u.createHistoryUrl().join("&")),!this.view||this.view.isDestroyed?(this.view=new s({search:u}),t.trigger("mainRegion:show",this.view)):(this.view.updateSearch(u),this.view.onShow())}}),l=new f;return t.on("navigate:search",function(e,t){t=t||{},e=e||"ucla",l.showSearchPage(e,t,function(t){Backbone.history.navigate("/"+e+"?"+t)})}),t.on("navigate:search:home",function(e,t,n,r){l.showSearchPage(e,{page:t,order:r},function(t){Backbone.history.navigate("/"+e+"?"+t)})}),t.on("navigate:search:name",function(e,t,n,r){l.showSearchPage(e,{page:t,name:n,order:r},function(t){Backbone.history.navigate("/"+e+"?"+t)})}),t.on("navigate:search:hashtag",function(e,t,n,r){l.showSearchPage(e,{page:t,hashtag:n,order:r},function(t){Backbone.history.navigate("/"+e+"?"+t)})}),t.on("open:modal:post",function(e,n){n=n||Backbone.history.fragment,e.collection.setElement(e),e.is_fb()?t.trigger("open:modal",new u({model:e,fromURL:n}),{dialogClass:"post-modal",animate:!1}):(e.modalMode=!0,t.trigger("open:modal",new o({model:e,fromURL:n}),{dialogClass:"post-modal",animate:!1}))}),t.on("open:modal:first:post",function(){var e=l.view.collection.first();e.is_fb()?t.trigger("open:modal",new u({model:e}),{dialogClass:"post-modal",animate:!1}):(e.modalMode=!0,t.trigger("open:modal",new o({model:e}),{dialogClass:"post-modal",animate:!1}))}),l}),define("messages/models/ChatModel",["reqres","backbone","underscore"],function(e,t,n){var r=t.Model.extend({is_owner:function(){return this.get("created_by")==e.request("currentUser").id},name:function(){if(this.collection)return this.collection.contactName},toJSON:function(){return n.extend({},this.attributes,{is_owner:this.is_owner(),name:this.name()})}}),i=t.Collection.extend({initialize:function(){},parse:function(e,t){return e.data.messages},model:r}),s=t.Model.extend({initialize:function(e){e&&e.modified_at&&this.set({time:new Date(e.modified_at)})},toJSON:function(){return n.extend({},this.attributes,{is_unread:!this.hasRead()})},urlRoot:function(){return e.request("api").chat},hasRead:function(){return this.get("read")==1},setToRead:function(){this.set({read:1})},fetchMessages:function(){var e=new $.Deferred,t=this;return!this.has("messages")||!this.hasRead()?(this.hasRead()||this.setToRead(),this.fetch().done(function(){e.resolve(t.get("messages"))})):e.resolve(this.get("messages")),e.promise()},parse:function(r,s){var o=t.Model.prototype.parse(r,s),u=null;n.isArray(o.messages)&&(u=new i(o.messages),u.url=this.urlRoot()+"/"+this.id,o.contact_name===e.request("currentUser").get("user_name")?u.contactName=o.owner_name:u.contactName=o.contact_name),this.set({messages:u})},addMessage:function(e,t){var n=new r;n.url=this.get("messages").url;var i=this;n.save(e,{wait:!0,success:function(e,n){i.get("messages").add(e),i.set({modified_at:e.get("created_at"),time:new Date(e.get("created_at"))}),t&&t(e)}})},update:function(e){this.set({read:e.read,modified_at:e.modified_at,time:new Date(e.modified_at)})}});return s}),define("messages/models/InboxCollection",["reqres","backbone","underscore","messages/models/ChatModel"],function(e,t,n,r){var i=function(e){var t=0;return n.each(e,function(e){e.read==0&&t++}),t},s=t.Collection.extend({model:r,comparator:function(e){return-e.get("time")}}),o=t.Model.extend({initialize:function(e){this.updateTime(),this.listenTo(this.get("chats"),"change:read",n.bind(this.updateCount,this)),this.get("ref_id")?this.set({deleted:!1}):(this.set({}),this.set({deleted:!0,image:{link:"/static/img/post_deleted2.png",thumbnail:"/static/img/post_deleted2.png"}})),!this.get("image")&&!this.get("deleted")?this.set({type:"buying",image:{link:"/static/img/looking.png",thumbnail:"/static/img/looking.png"}}):this.set({type:"selling"})},updateTime:function(){this.set({time:this.get("chats").models[0].get("time"),timestamp:this.get("chats").models[0].get("modified_at")})},updateCount:function(){var e=i(this.get("chats").toJSON());this.set({unread_count:e})},isOwner:function(){return this.get("owner_name")===e.request("currentUser").get("user_name")},isSelling:function(){return this.attributes.type==="selling"},toJSON:function(){return{id:this.attributes.id,chats:this.attributes.chats.toJSON(),post_name:this.attributes.post_name,owner_name:this.attributes.owner_name,unread_count:this.attributes.unread_count,has_unread:this.attributes.unread_count>0,image:this.attributes.image,timestamp:this.attributes.timestamp,isOwner:this.isOwner(),deleted:this.attributes.deleted,is_selling:this.isSelling()}}}),u=t.Collection.extend({model:o,comparator:function(e){return-e.get("time")}}),a=t.Model.extend({defaults:function(){return{chats:new u,total_unread_count:0,initialized:!1}},url:function(){return e.request("api").chat},reset:function(){this.getChats().reset(),this.clear().set(this.defaults()),this.stopListening()},updateTotalUnread:function(){var e=0;this.getChats().each(function(t){e+=t.get("unread_count")}),this.set({total_unread_count:e})},getChats:function(){return this.get("chats")},getPost:function(e){return this.get("chats").get(e)},getPostAt:function(e){return this.get("chats").at(e)},addPost:function(e){return this.get("chats").add(e)},sort:function(){this.get("chats").sort()},parse:function(e,r){this.get("initialized")||this.get("chats").on("change:unread_count",this.updateTotalUnread,this),this.set({initialized:!0});var o=function(e,t){var r=0;if(n.isEmpty(e))return r;n.each(e,function(e,r){var o=e.chats,u=t.getPost(r);if(!u){var a=i(o),f=t.addPost({id:r,ref_id:e.id,chats:new s(o),post_name:e.name,owner_name:o[0].owner_name,unread_count:0,image:e.image});f.updateCount()}else n.each(o,function(e){var t=u.get("chats").get(e.id);t?t.update(e):u.get("chats").add(e,{sort:!1})}),u.get("chats").sort(),u.updateTime()}),t.sort()},u=t.Model.prototype.parse(e,r);o(u,this)},toJSON:function(){return{chats:this.attributes.chats.toJSON(),total_unread_count:this.attributes.total_unread_count}}});return a}),define("messages/models/InboxControl",["jquery","marionette","vent","reqres"],function(e,t,n,r){var i=Backbone.Model.extend({defaults:function(){return{postSelected:null,empty:!1}},initialize:function(e){this.inbox=e.inbox},reset:function(){this.set(this.defaults(),{silent:!0})},selectPost:function(e){e===this.get("postSelected")?this.getSelectedPost().isOwner()&&this.trigger("change:postSelected"):this.set({postSelected:e,empty:!1})},selectFirstPost:function(){var e=this.inbox.getPostAt(0);if(!_.isUndefined(e))return this.selectPost(e.id),e;this.set({empty:!0})},selectFirstChat:function(){if(this.get("empty"))return;var e=this.getSelectedPost().get("chats").at(0);return e},sendMessage:function(e,t,n){var r=this.getSelectedPost(),i=this;e.addMessage(t,function(e){n&&n(),r.get("chats").sort(),r.updateTime(),i.inbox.sort()})},getSelectedPost:function(){if(this.get("empty"))return null;var e=this.inbox.getPost(this.get("postSelected"));return _.isUndefined(e)&&(e=this.selectFirstPost(),n.trigger("messages:updateurl")),e},getSelectedChat:function(){if(this.get("empty"))return null;var e=this.getSelectedPost().get("chats").get(this.get("chatSelected"));return _.isUndefined(e)&&(e=this.selectFirstChat(),n.trigger("messages:updateurl")),e}});return i}),define("messages/CreateChatModal",["marionette","vent","messages/models/ChatModel","messages/messageView/MessageForm","bootstrap-modal"],function(e,t,n,r){var i=e.ItemView.extend({ui:{ContactSellerForm:"#contact-form"},initialize:function(e){},template:"<div id='contact-form'></div>",onRender:function(){this.form=r.render(),this.ui.ContactSellerForm.append(this.form.el)}});return function(e){var r=(new Backbone.BootstrapModal({animate:!0,content:new i,title:"Contact seller",okText:"Send",focusOk:!1})).open();return r.on("ok",function(){var i=r.options.content.form,s=i.validate();if(s)return r.preventClose();var o=_.extend(i.getValue(),{post_id:e.post_id}),u=this,a=new n;a.save(o,{wait:!0,success:function(e,n){t.trigger("flash:alert",{type:"success",msg:n}),u.trigger("createChat:ok",a.toJSON())},error:function(e,n,r){t.trigger("flash:alert",{type:"error",msg:n.responseText})}})}),r}}),define("text!messages/main/tpl-messages-side.html",[],function(){return"\n<div class='messages-list-wrap'>\n   Offers/Chats\n   <div class='messages-list-content'>\n      <div class='messages-list-region'></div>\n   </div>\n</div>\n"}),define("text!messages/main/tpl-messages-side-item.html",[],function(){return'\n   <div class="media">\n   <span class="pull-left" href="#">\n      <img class="item-image media-object" src="{{image.thumbnail}}" alt="...">\n   </span>\n   <div class="media-body">\n   <h5 class="item-name media-heading">\n      {{#if deleted}} \n         <span style="text-decoration: line-through;">{{post_name}}</span>\n      {{else}}\n         {{post_name}}\n      {{/if}}\n  \n      {{#if has_unread}}\n         <small>({{unread_count}})</small>\n      {{/if}} \n   \n   </h5>\n   <div class=\'item-time-wrap\'>\n      <small><span class=\'item-time\'></span></small>\n   </div>\n   </div>\n   </div>\n'}),define("messages/main/MessagesSideView",["marionette","vent","templates/TimeagoView","text!messages/main/tpl-messages-side.html","text!messages/main/tpl-messages-side-item.html","jquery.slimscroll"],function(e,t,n,r,i){var s="side-item-id-",o=e.LayoutView.extend({template:i,tagName:"a",className:"inbox-post-item",id:function(){return s+this.model.id},events:{click:"onClick"},regions:{itemTime:".item-time"},initialize:function(e){this.listenTo(this.model,"change:unread_count",this.updateRead)},onRender:function(){this.itemTime.show(new n({time:this.model.get("timestamp")}))},onClick:function(){t.trigger("navigate:messages:post",this.model.id)},updateRead:function(){this.render()}}),u=e.ItemView.extend({template:'<div style="padding:10px">No chats...</div>'}),a=e.CollectionView.extend({childView:o,emptyView:u,initialize:function(e){this.control=e.control,this.collection=this.control.inbox.getChats(),this.listenTo(this.control,"change:postSelected",this.renderActiveItem)},onRender:function(){this.renderActiveItem()},renderActiveItem:function(){this.$(".inbox-post-item").removeClass("active"),this.$("#"+s+this.control.get("postSelected")).addClass("active")}}),f=e.LayoutView.extend({template:r,defaults:{boxHeight:"100%"},tagName:"div",className:"messages-side",initialize:function(e){this.control=e.control},regions:{messagesRegion:".messages-list-region"},onRender:function(){this.$(".messages-list-content").slimScroll({height:this.defaults.boxHeight,distance:"2px"}),this.messagesRegion.show(new a({control:this.control}))},onBeforeDestroy:function(){console.log("destroy inbox side view")}});return f}),define("text!messages/main/tpl-messages-header.html",[],function(){return"{{#if exists}}\n   {{#if is_selling}}\n      {{#if isOwner}}\n         <img class='img-circle' src=\"{{image.thumbnail}}\" />\n         <h4 class='post-name'>Name: <a class='post-link' href='/posts/{{id}}'>\n            {{#if deleted}} \n               <span style=\"text-decoration: line-through;\">{{post_name}}</span>\n            {{else}}\n               {{post_name}}\n            {{/if}}\n         </a></h4>\n         \n         <a href=\"/posts/{{id}}/edit\" class=\"edit-post-link btn-sm btn-primary\"><span class=\"glyphicon glyphicon-pencil\"></span> Edit your post</a>\n         \n      {{else}}\n         <img class='img-circle' src=\"{{image.thumbnail}}\" />\n         <h4 class='post-name'>Name: <a class='post-link' href='/posts/{{id}}'>\n            {{#if deleted}} \n               <span style=\"text-decoration: line-through;\">{{post_name}}</span>\n            {{else}}\n               {{post_name}}\n            {{/if}}\n         </a></h4>\n         <h5>Selling by: <span class='owner-name-region'></span></h5>\n      \n      {{/if}}\n   {{else}}\n      {{#if isOwner}}\n         <img class='img-circle' src=\"{{image.thumbnail}}\" />\n         <h4 class='post-name'>Name: \n            {{#if deleted}} \n               <span style=\"text-decoration: line-through;\">{{post_name}}</span>\n            {{else}}\n               {{post_name}}\n            {{/if}}\n         </h4>\n         \n         <a href=\"/buy_requests/{{id}}/edit\" class=\"edit-post-link btn-sm btn-primary\"><span class=\"glyphicon glyphicon-pencil\"></span> Edit your post</a>\n         \n      {{else}}\n         <img class='img-circle' src=\"{{image.thumbnail}}\" />\n         <h4 class='post-name'>Name: \n            {{#if deleted}} \n               <span style=\"text-decoration: line-through;\">{{post_name}}</span>\n            {{else}}\n               {{post_name}}\n            {{/if}}\n         </h4>\n         <h5>Request by: <span class='owner-name-region'></span></h5>\n      \n      {{/if}}\n   {{/if}}\n{{else}}\n   \n\n{{/if}}"}),define("messages/main/MessagesHeaderView",["marionette","vent","reqres","templates/UserProfileView","text!messages/main/tpl-messages-header.html"],function(e,t,n,r,i){var s=Backbone.Marionette.LayoutView.extend({template:i,tagName:"div",className:"message-header",events:{"click .post-link":"onPostLinkClick","click .edit-post-link ":"onEditPostClick"},initialize:function(e){this.control=e.control,this.model=this.control.getSelectedPost(),this.listenTo(this.control,"change:postSelected",this.onChangePost)},serializeData:function(){return this.model?_.extend(this.model.toJSON(),{exists:!0}):{exists:!1}},regions:{chatListRegion:"#chat-list-region",ownerNameRegion:".owner-name-region"},onRender:function(){if(!this.model)return;this.model.isOwner()||this.ownerNameRegion.show(new r({user:{user_name:this.model.get("owner_name")},withPicture:!1})),this.model.isSelling()||this.$(".img-circle").attr("title",this.model.get("owner_name")+" is looking for this item!").tooltip({placement:"bottom"})},onChangePost:function(){this.model=this.control.getSelectedPost(),this.render(),this.delegateEvents()},onPostLinkClick:function(){if(this.model.get("deleted"))return alert("This post is already deleted!");this.model.isSelling()&&t.trigger("navigate:posts:item",this.model.id)},onEditPostClick:function(){if(this.model.get("deleted"))return alert("This post is already deleted!");this.model.isSelling()?t.trigger("navigate:posts:edit",this.model.id):t.trigger("navigate:buyRequests:edit",this.model.id)}});return s}),define("text!messages/main/tpl-messages-layout.html",[],function(){return"<div class='col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2'>\n<div class='row'>\n\n   <div class='messages-side-region hidden-xs col-sm-4 nopadding'>\n    \n   </div>\n   <div class='messages-main-region col-sm-8 nopadding'>\n      <div class='messages-main'>\n         <div class='message-main-header-region'></div>\n      \n         <div class='content-region'></div>\n         \n      </div>\n   </div>\n\n</div>\n"}),define("messages/main/MessagesLayoutView",["marionette","vent","messages/main/MessagesSideView","messages/messageView/MessagesBoardView","messages/main/MessagesHeaderView","messages/postChats/PostChatsView","text!messages/main/tpl-messages-layout.html"],function(e,t,n,r,i,s,o){var u=e.ItemView.extend({template:"<div> </div>"}),a=e.LayoutView.extend({tagName:"div",className:"messages-page-wrap",template:o,regions:{sideRegion:".messages-side-region",headerRegion:".message-main-header-region",contentRegion:".content-region"},initialize:function(e){this.control=e.control,this.listenTo(this.control,"change:postSelected",this.updateContent)},onRender:function(){this.sideRegion.show(new n({control:this.control})),this.headerRegion.show(new i({control:this.control})),this.updateContent()},updateContent:function(){this.isDestroyed;var e=this.control.getSelectedPost();if(!e)return this.contentRegion.show(new u);e.isOwner()?this.contentRegion.show(new s({post:e})):this.contentRegion.show(new r({chat:e.get("chats").at(0)}))},onBeforeDestroy:function(){this.control.reset(),console.log("destroy inbox layout view")}});return a}),define("text!messages/dropdown/tpl-inbox-dropdown-main.html",[],function(){return"\n<li class='dropdown-header'>\n</li>\n<li class='dropdown-content'>\n   <div>\n      <div class='dropdown-messges-wrap'></div>\n   </div>\n</li>\n<li class='dropdown-footer'>\n   <a id='all-msg-link' class='text-center' href=\"#\">See All Messages</a>\n</li>\n"}),define("text!messages/dropdown/tpl-inbox-dropdown-item.html",[],function(){return"<a class='dropdown-list-item' href='#'>\n   <span class='list-item-side pull-left'>\n      <img class=\"img-rounded\" src=\"{{image.thumbnail}}\">\n   </span>\n   <span class=\"list-item-main\">\n   \n      <div class='item-name'>\n         {{#if deleted}} \n            <span style=\"text-decoration: line-through;\">{{post_name}}</span>\n         {{else}}\n            {{post_name}}\n         {{/if}}\n      </div>\n\n      <span class='item-time-wrap'>\n         {{#if has_unread}}\n            <small>({{unread_count}} unread)</small>\n         {{/if}}\n         <small><span class='item-time'></span></small>\n      </span>\n   </span>\n</a>\n   \n"}),define("messages/dropdown/InboxDropdownView",["marionette","vent","templates/TimeagoView","text!messages/dropdown/tpl-inbox-dropdown-main.html","text!messages/dropdown/tpl-inbox-dropdown-item.html","jquery.slimscroll"],function(e,t,n,r,i){var s=e.LayoutView.extend({template:i,tagName:"li",events:{"click a":"onClick"},regions:{itemTime:".item-time"},initialize:function(e){this.listenTo(this.model,"change:unread_count",this.render)},onRender:function(){this.itemTime.show(new n({time:this.model.get("timestamp")}))},onClick:function(){t.trigger("navigate:messages:post",this.model.id)}}),o=e.ItemView.extend({template:'<div style="padding:10px">No chats...</div>',tagName:"li",className:"empty-list"}),u=e.CollectionView.extend({childView:s,emptyView:o,tagName:"ul",initialize:function(e){this.collection=e.inbox.getChats()}}),a=e.LayoutView.extend({template:r,defaults:{boxHeight:"224px"},events:{"click #all-msg-link":"onAllMsgClick"},initialize:function(e){this.inbox=e.inbox},ui:{contentScroll:".dropdown-content >div"},regions:{messagesWrap:".dropdown-messges-wrap"},onRender:function(){this.ui.contentScroll.slimScroll({height:this.defaults.boxHeight,distance:"2px"}),this.messagesWrap.show(new u({inbox:this.inbox}))},onAllMsgClick:function(){t.trigger("navigate:messages")}});return a}),define("messages/MessageController",["marionette","vent","reqres","backbone.poller","messages/models/InboxCollection","messages/models/InboxControl","messages/CreateChatModal","messages/main/MessagesLayoutView","messages/dropdown/InboxDropdownView"],function(e,t,n,r,i,s,o,u,a){var f={delay:5e3,delayed:!1,continueOnError:!0,backoff:!1},l=e.Controller.extend({initialize:function(){this.modal=null,this.view=null,this.inbox=new i({}),this.control=new s({inbox:this.inbox}),this.inboxPoller=r.get(this.inbox,f)},updateInbox:function(){n.request("isLoggedIn")?this.inboxPoller.start():(this.inboxPoller.stop(),this.inbox.reset())},openContactSellerModal:function(e){this.modal&&this.modal.remove();var t=this;this.modal=o({post_id:e.id}),this.listenTo(this.modal,"createChat:ok",function(t){e.set({chat:new Array(t)})})},showInbox:function(){t.trigger("domChange:title","Messages");var e=this;this.checkInboxPresent(function(){c.control.selectFirstPost(),t.trigger("messages:updateurl"),e.showMessagesPage()})},showMessagesPostFromURL:function(e){t.trigger("domChange:title","Messages"),this.control.selectPost(e);var n=this;this.checkInboxPresent(function(){t.trigger("messages:updateurl"),n.showMessagesPage()})},checkInboxPresent:function(e){var t=this;this.inbox.get("initialized")?e&&e():this.inboxPoller.once("success",function(t){e&&e()})},showMessagesPage:function(){if(!this.view||this.view.isDestroyed)t.trigger("domChange:title","Messages"),this.view=new u({control:this.control}),t.trigger("mainRegion:show",this.view)}}),c=new l,h=["showMessagesPage","checkInboxPresent"];return n.request("session").setLoginRequired(c,h),c.listenTo(t,"app:start:auth:done",function(e){c.updateInbox(),c.listenTo(n.request("session"),"change:logged_in",function(e){c.updateInbox()})}),c.listenTo(t,"messages:contactSeller",function(e){if(!n.request("isLoggedIn"))return t.trigger("navigate:login");var r=e.get("joined_circles");if(!n.request("currentUser").isInCircle(e.get("joined_circles")))return t.trigger("flash:alert",{type:"error",msg:"You need to be in the "+r.name+" group to contact seller!"});if(!e.is_active())return t.trigger("flash:alert",{type:"error",msg:"Sorry, the post is sold already!!"});e.get("has_contacted")?t.trigger("navigate:messages:post",e.id):c.openContactSellerModal(e)}),c.listenTo(t,"messages:updateurl",function(){if(c.control.get("empty"))return Backbone.history.navigate("messages/");Backbone.history.navigate("messages/"+c.control.get("postSelected"))}),c.listenTo(t,"navigate:messages",function(){c.showInbox()}),c.listenTo(t,"navigate:messages:post",function(e){c.showMessagesPostFromURL(e)}),c.listenTo(t,"messages:send",function(e,t,n){this.control.get("empty")||this.control.sendMessage(e,t,n)}),c.listenTo(t,"messages:getPost",function(e,t){c.checkInboxPresent(function(){var n=c.inbox.getPost(e);t(n)})}),c.listenTo(c.inbox,"change:total_unread_count",function(){t.trigger("messages:updateCount",c.inbox.get("total_unread_count"))}),n.setHandler("messages:dropdown",function(){return(new a({inbox:c.inbox})).render()}),c}),define("text!notifications/dropdown/tpl-noti-dropdown-item.html",[],function(){return"<a class='dropdown-list-item {{#if_eq has_read 0}}unread{{/if_eq}}' href='#'>\n   <span class='list-item-side pull-left'>\n      <span class=\"glyphicon  {{icon}}\"></span>   \n   </span>\n   <span class=\"list-item-main\">\n\n      <div>\n         <span class='item-message'><p>{{message}}</p></span>\n         <small><div class='item-time'></div></small>\n      </div>\n   </span>\n</a>\n"}),define("text!notifications/dropdown/tpl-noti-dropdown-main.html",[],function(){return"<li class='dropdown-header'>\n   \n</li>\n<li class='dropdown-content'>\n   <div class='notif-dropdown-wrap'>\n      <div class='notif-dropdown-list'></div>\n      <div class='notif-loader'>\n         <img src='/static/img/ajax-loader-white.gif' class='ajax-loader'></div>\n      </div>\n   </div>\n</li>\n<li class='dropdown-footer'>\n</li>\n"}),define("notifications/dropdown/NotiDropdownView",["jquery","marionette","vent","templates/TimeagoView","text!notifications/dropdown/tpl-noti-dropdown-item.html","text!notifications/dropdown/tpl-noti-dropdown-main.html","jquery.slimscroll"],function(e,t,n,r,i,s){var o={post_edit:"glyphicon-pencil",post_status_inactive:"glyphicon-pencil",post_status_active:"glyphicon-pencil",post_delete:"glyphicon-remove",post_comment:"glyphicon-comment",contact_seller:"glyphicon-envelope"},u=function(e,t){return e==="system_notification"?t===0?"fui-user":"fui-gear":o[e]},a=t.LayoutView.extend({template:i,tagName:"li",events:{"click a":"onClick"},regions:{itemTime:".item-time"},serializeData:function(){return _.extend({},this.model.toJSON(),{icon:u(this.model.get("action_type"),this.model.get("object_id"))})},initialize:function(e){this.listenTo(this.model,"change:has_read",this.render)},onRender:function(){this.itemTime.show(new r({time:this.model.get("modified_at")}))},onClick:function(){n.trigger("notifications:click",this.model)}}),f=t.ItemView.extend({template:'<div style="padding:10px">No notifications...</div>',tagName:"li",className:"empty-list"}),l=t.CollectionView.extend({childView:a,emptyView:f,tagName:"ul",initialize:function(e){this.collection=e.notifications}}),c=t.LayoutView.extend({template:s,defaults:{boxHeight:"300px"},initialize:function(e){this.notifications=e.notifications,this.listenTo(this.notifications,"notification:end",_.bind(this.onEnd,this))},ui:{loader:".notif-loader",wrap:".notif-dropdown-wrap"},regions:{content:".notif-dropdown-list"},onScroll:function(e,t){t==="bottom"&&this.notifications.loadNext()},onEnd:function(){this.ui.loader.addClass("hidden")},onRender:function(){this.ui.wrap.slimScroll({height:this.defaults.boxHeight,distance:"2px"}),this.ui.wrap.slimScroll().bind("slimscroll",_.bind(this.onScroll,this)),this.content.show(new l({notifications:this.notifications.get("list")}))},onBeforeDestroy:function(){this.ui.wrap.off("scroll")}});return c}),define("notifications/NotiCollection",["reqres","backbone","underscore"],function(e,t,n,r){var i=t.Model.extend({setToRead:function(){if(!this.hasRead()){this.set({has_read:1}),this.trigger("notification:read");var t={url:e.request("api").notification+"/"+this.id+"/read",method:"PUT"};this.ajax({},t)}},hasRead:function(){return this.get("has_read")==1},initialize:function(e){this.updateTime()},getType:function(){var e=this.get("action_type");if(n.indexOf(["post_edit","post_status_inactive","post_status_active","post_comment"],e)!==-1)return"post";if(n.indexOf(["contact_seller"],e)!==-1)return"chat";if(n.indexOf(["post_delete"],e)!==-1)return"none";if(n.indexOf(["system_notification"],e)!==-1)return"system_notification"},updateTime:function(){this.set({time:new Date(this.get("modified_at"))})}}),s=t.Collection.extend({model:i,comparator:function(e){return-e.get("time")}}),o=t.Model.extend({defaults:function(){return{list:new s,total_unread_count:0,initialized:!1,next_page:1,page:1}},url:function(){return e.request("api").notification},reset:function(){this.get("list").reset(),this.clear().set(this.defaults()),this.stopListening()},updateTotalUnread:function(e){this.set({total_unread_count:parseInt(e)})},decrCount:function(){this.set({total_unread_count:this.attributes.total_unread_count-1})},loadNext:function(){this.get("next_page")>this.get("page")&&(this.fetch({url:this.url()+"?page="+this.get("next_page")}),this.attributes.page=this.attributes.next_page)},parse:function(e,n){this.get("initialized")||this.get("list").on("notification:read",this.decrCount,this),this.set({initialized:!0});var r=t.Model.prototype.parse(e,n);r.next_page=parseInt(r.next_page),!isNaN(r.next_page)&&this.get("page")<r.next_page?this.set({next_page:r.next_page}):this.trigger("notification:end"),this.get("list").add(r.result,{merge:!0}),this.updateTotalUnread(r.unread_count)}});return o}),define("notifications/NotificationController",["marionette","vent","reqres","backbone.poller","notifications/dropdown/NotiDropdownView","notifications/NotiCollection","tour/BasicTour"],function(e,t,n,r,i,s,o){var u={delay:5e3,delayed:!1,continueOnError:!0,backoff:!1},a=e.Controller.extend({initialize:function(){this.notifications=new s,this.notiPoller=r.get(this.notifications,u)},updateNotification:function(){n.request("isLoggedIn")?this.notiPoller.start():(this.notiPoller.stop(),this.notifications.reset())}}),f=new a,l=["showMessagesPage","checkInboxPresent"];f.listenTo(t,"app:start:auth:done",function(e){f.updateNotification(),f.listenTo(n.request("session"),"change:logged_in",function(e){f.updateNotification()})});var c=e.LayoutView.extend({template:"<div><h3>Hi there, {{user_name}}!</h3>                      <p>Thank you so much for joining DoubleDibz! We really want to create the best possible experience for buying and selling among UCLA students through this site and we hope you will enjoy using it. Go ahead and check out the listings page to browse for what you want or start selling your items now! Still confused of what todo? Don't worry! Click the button below and we will show you a short tutorial of our site.</p>                     <p>If you have any more questions or suggestions, don't hesitate to let us know by emailing support@doubledibz.com or click on the 'Feedback' button at the bottom.</p>                     <p>Have fun!</p>                     <a class='btn btn-md btn-primary tutorial-link'>Start tutorial</a>                </div>",events:{"click .tutorial-link":"onTutorialClick"},serializeData:function(){return{user_name:n.request("currentUser").get("user_name")}},onTutorialClick:function(){t.trigger("close:modal");var e=new o;e.start()}}),h=function(){t.trigger("open:modal",new c,{dialogClass:""})},p=function(e){e.get("object_id")===0&&h()};return f.listenTo(t,"notifications:click",function(e){e.setToRead();var n=e.getType();n==="post"?t.trigger("navigate:posts:item",e.get("object_id")):n==="chat"?t.trigger("navigate:messages:post","selling",e.get("object_id")):n==="system_notification"&&p(e)}),f.listenTo(f.notifications,"change:total_unread_count",function(){t.trigger("notifications:updateCount",f.notifications.get("total_unread_count"))}),n.setHandler("notifications:dropdown",function(){return(new i({notifications:f.notifications})).render()}),f}),define("general/FlashController",["jquery","underscore","backbone","marionette","app","vent","reqres","general/FlashMessageView"],function(e,t,n,r,i,s,o,u){var a=r.Controller.extend({initialize:function(){this.flashTimer=null,this.timerTime=4e3,this.defaultMsg={success:"Good job!",error:"Can't connect to the server. Please try again."}},createFlashAlert:function(n){if(!t.isObject(n))throw"Alert has to be an object";if(n.type!="success"&&n.type!="error"&&n.type!="info")throw"Alert type has to be 'success', 'error or info'";t.isUndefined(n.msg)&&(n.msg="");if(!t.isObject(n.msg)&&!t.isString(n.msg))throw"Alert message has to be an object or a string";var r={};r.type=n.type,r.msg=n.msg;if(t.isString(n.msg))try{r.msg=e.parseJSON(n.msg)}catch(i){r.msg=n.msg||this.defaultMsg[n.type]}if(t.isObject(r.msg))if(r.type==="success")r.msg=!t.isEmpty(r.msg)&&r.msg.message||this.defaultMsg.success;else if(r.type==="error")if(r.msg.errors.type==="Form validation error"){var s=r.msg.errors.type;t.isObject(r.msg.errors.message)?t.each(r.msg.errors.message,function(e,t){s+="<br><b>"+t+"</b> : "+e.join(" , ")}):s+="<br>"+r.msg.errors.message,r.msg=s}else r.msg=!t.isEmpty(r.msg)&&r.msg.errors.message||this.defaultMsg.error;return r},showFlashAlert:function(e,n){n=n||{},e.type==="error"&&t.isUndefined(n.timer)&&(n.timer=!1),n=t.extend({},{timer:!0,type:"normal"},n),i.alertRegion.show(new u(e,n)),n.timer&&this.startTimer()},startTimer:function(){this.flashTimer&&clearTimeout(this.flashTimer);var e=this;this.flashTimer=setTimeout(function(){e.closeFlashAlert()},this.timerTime)},closeFlashAlert:function(e){if(!i.alertRegion.currentView)return;this.flashTimer&&clearTimeout(this.flashTimer),e?i.alertRegion.empty():this.fadeHide()},fadeHide:function(){i.alertRegion.currentView.$el.animate({height:0,opacity:0},300,function(){i.alertRegion.empty()})}}),f=new a;return f.listenTo(s,"all",function(e){e.indexOf("navigate:")>-1&&this.closeFlashAlert(!0)}),f.listenTo(s,"_flash:alert",function(t,n){var r=this.createFlashAlert(t);this.showFlashAlert(r,n),e(document).scrollTop(0)}),f.listenTo(s,"flash:close",function(){this.closeFlashAlert()}),f.listenTo(s,"flash:alert:on",function(e,t,n){var r=this.createFlashAlert(t);e.html((new u(r,n)).render().el)}),f.listenTo(s,"flash:always-alert",function(t,n){e("#app-content").addClass("on-always-alert"),n=n||{},n.type="always",s.trigger("flash:alert:on",e("#always-alert-region"),t,n)}),f.listenTo(s,"flash:always-alert:close",function(){e("#app-content").removeClass("on-always-alert"),e("#always-alert-region").empty()}),f}),define("route",["marionette","header/HeaderController","auth/AuthController","account/AccountController","general/GeneralController","posts/PostController","buy_requests/BuyRequestController","search/SearchController","messages/MessageController","notifications/NotificationController","general/FlashController"],function(e,t,n,r,i,s,o,u,a,f,l){var c={SearchController:e.AppRouter.extend({appRoutes:{":circle":"showSearchPageFromUrl","daily-listing(/)":"showDailyListingPage","fb/daily-listing(/)":"showDailyListingPage"},controller:u}),AuthRouter:e.AppRouter.extend({appRoutes:{"login(/)":"showLoginPage","signup(/)":"showSignupPage","session/verify(/)":"showVerifyPage","forgot_password(/)":"showForgotPasswordPage"},controller:n}),AccountRouter:e.AppRouter.extend({appRoutes:{"my/settings(/)":"showSettingsPage","help(/)":"showHelpPage","my/bookmarks(/)":"showMyBookmarksPage","my/posts(/)":"showMyPostsPage"},controller:r}),HeaderRouter:e.AppRouter.extend({AppRoutes:{},controller:t}),MessageRouter:e.AppRouter.extend({appRoutes:{"messages(/)":"showInbox","messages/:post_id(/)":"showMessagesPostFromURL","fb/messages/:post_id(/)":"showMessagesPostFromURL"},controller:a}),NotificationRouter:e.AppRouter.extend({appRoutes:{},controller:f}),GeneralRouter:e.AppRouter.extend({appRoutes:{"(/)":"showHomePage","about/legal/terms(/)":"showTermPage","about/us(/)":"showAboutPage"},controller:i}),PostRouter:e.AppRouter.extend({appRoutes:{"posts/create(/)":"showCreatePostPage","posts/:id/chats(/)":"showPostChatsPage","posts/:id/edit(/)":"showEditPostPage","posts/:id(/)":"showItemPostPage","fb/posts/:id(/)":"showItemPostPage","u/:user_name(/)":"showUserPostPage"},controller:s}),BuyRequestRouter:e.AppRouter.extend({appRoutes:{"buy_requests/create(/)":"showCreateBuyRequestPage","buy_requests/:id/edit(/)":"showEditBuyRequestPage"},controller:o})};return c}),define("posts/CategoryModel",["underscore","reqres"],function(e,t){var n=Backbone.Model.extend({initialize:function(){},toString:function(){return this.get("name")},toJSON:function(){var t=this.attributes.name.replace(/_/g," ").replace("and","&");return e.extend({},this.attributes,{showName:t})}}),r=Backbone.Collection.extend({model:n,url:function(){return t.request("api").categories},comparator:function(e){return e.get("name")},parse:function(t,n){var r=this;e.each(t.data,function(e){r.add({name:e.toUpperCase()})})},toOptions:function(){var t=e.map(this.models,function(e){return{val:e.get("name"),label:e.get("name")}});return t},getCategory:function(t){t=e.map(t,function(e){return e.name});var n=e.find(this.toJSON(),function(n){return e.contains(t,n.name)});return n.name}});return r}),define("general/centralRequest",["underscore","reqres","posts/CategoryModel","facebook"],function(e,t,n,r){var i="DoubleDibz";t.setHandler("page:name",function(){return{login:"Login to "+i,signup:"Signup for "+i,verify:"Verify Emails",forgotPass:"Forgot Password",resetPass:"Reset Password",account:"Account Settings",profile:"Profile Settings",email:"Email Settings",help:"Account Help",circle:"Group Settings",joinCircle:"Join Group",terms:i+" Terms of Service",about:"About "+i,create:"Create a new post",myposts:t.request("currentUser").get("user_name")+" on "+i,viewItem:function(e){return i+" post"},editItem:function(e){return i+" post"+" - edit"},search:function(e){return"search"},home:"Home"}});var s=null;t.setHandler("categories",function(){return s||(typeof CATEGORIES!="undefined"?s=new n(CATEGORIES):(s=new n,s.fetch({reset:!0,async:!1}))),s});var o="/api";t.setHandler("apiRoot",function(){return o});var o="/api";t.setHandler("api",function(){return{emails:o+"/account/emails",delete_email:"/delete",update_email:"/set_primary",resend_verify:"/verify",auth:o+"/auth",verify_email:o+"/auth/verify",fb_link:o+"/account/fb_link",forgot_password:o+"/auth/forgot_password",reset_password:o+"/account/reset_password",password:o+"/account/password",account_picture:o+"/account/picture",settings:o+"/account/settings",verify_auth:o+"/account/verify_auth",ucla_verified:o+"/account/ucla_verified",bugposts:o+"/bugposts",categories:o+"/categories",chat:o+"/chat",images:o+"/images",posts:o+"/posts",search:o+"/search",user:o+"/users",circles:o+"/circles",buy_requests:o+"/buy_requests",notification:o+"/notifications",bookmarks:o+"/bookmarks"}});var u="687429857979311";t.setHandler("fb_appID",function(){return u});var a=!1;t.setHandler("FB",function(){return r=require("facebook"),a||(r.init({appId:u,status:!0,cookie:!0,oauth:!0,xfbml:!1,version:"v2.0"}),a=!0),r});var f=null;t.setHandler("domain",function(){return f||$.ajax({url:o+"/auth/domain",async:!1}).done(function(e){f="http://"+e.data}),f}),t.setHandler("KEYS",function(){return{ENTER:13}}),t.setHandler("CONSTANTS",function(){return{RESET_PASSWORD:1}})}),define("main",["settings","auth/SessionModel"],function(){require(["jquery","app","vent","reqres","route","general/centralRequest"],function(e,t,n,r,i){t.addInitializer(function(){is_canvas||n.trigger("showFooter"),n.trigger("auth:checkAuth",function(){n.trigger("app:start:auth:done")})}),n.on("app:start:auth:done",function(e){t.Router={},_.each(i,function(e,n){t.Router[n]=new e}),Backbone.history&&(Backbone.history.start({pushState:!0})||n.trigger("navigate:404Page"),console.log("Backbone history is initialized"))});var s=Backbone.History.prototype.navigate;Backbone.History.prototype.navigate=function(e,t){s.apply(this,arguments),e.charAt(0)!="/"&&(e="/"+e),window._gaq.push(["_trackPageview",e])},e("html").on("click",function(t){var r=2;if(t.which==r)return;if(t.ctrlKey||t.metaKey)return;var i=e(t.target).attr("data-navigate");i!==undefined&&n.trigger("navigate:"+i),t.target.tagName!=="INPUT"&&e(t.target).closest("a").attr("data-bypass")===undefined&&t.preventDefault()});var o=Backbone.sync;Backbone.sync=function(e,t,r){return e=="patch"&&(e="update"),e=="read"&&(r.error=_.wrap(r.error,function(e,t,r){if(t.status==404)return n.trigger("navigate:404Page");t.status!=0&&_.isFunction(e)&&e(t)})),o(e,t,r)},t.start()})});