(function(e){function n(t,n){this.itemsArray=[],this.$element=e(t),this.$element.hide(),this.isSelect=t.tagName==="SELECT",this.multiple=this.isSelect&&t.hasAttribute("multiple"),this.objectItems=n&&n.itemValue,this.placeholderText=t.hasAttribute("placeholder")?this.$element.attr("placeholder"):"",this.inputSize=Math.max(1,this.placeholderText.length),this.$container=e('<div class="bootstrap-tagsinput"></div>'),this.$input=e('<input type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container),this.$element.after(this.$container);var r=(this.inputSize<3?3:this.inputSize)+"em";this.$input.get(0).style.cssText="width: "+r+" !important;",this.build(n)}function r(e,t){if(typeof e[t]!="function"){var n=e[t];e[t]=function(e){return e[n]}}}function i(e,t){if(typeof e[t]!="function"){var n=e[t];e[t]=function(){return n}}}function o(e){return e?s.text(e).html():""}function u(e){var t=0;if(document.selection){e.focus();var n=document.selection.createRange();n.moveStart("character",-e.value.length),t=n.text.length}else if(e.selectionStart||e.selectionStart=="0")t=e.selectionStart;return t}function a(t,n){var r=!1;return e.each(n,function(e,n){if(typeof n=="number"&&t.which===n)return r=!0,!1;if(t.which===n.which){var i=!n.hasOwnProperty("altKey")||t.altKey===n.altKey,s=!n.hasOwnProperty("shiftKey")||t.shiftKey===n.shiftKey,o=!n.hasOwnProperty("ctrlKey")||t.ctrlKey===n.ctrlKey;if(i&&s&&o)return r=!0,!1}}),r}var t={tagClass:function(e){return"label label-info"},itemValue:function(e){return e?e.toString():e},itemText:function(e){return this.itemValue(e)},freeInput:!0,addOnBlur:!0,maxTags:undefined,maxChars:undefined,confirmKeys:[13,44],onTagExists:function(e,t){t.hide().fadeIn()},trimValue:!1,allowDuplicates:!1};n.prototype={constructor:n,add:function(t,n){var r=this;if(r.options.maxTags&&r.itemsArray.length>=r.options.maxTags)return;if(t!==!1&&!t)return;typeof t=="string"&&r.options.trimValue&&(t=e.trim(t));if(typeof t=="object"&&!r.objectItems)throw"Can't add objects when itemValue option is not set";if(t.toString().match(/^\s*$/))return;r.isSelect&&!r.multiple&&r.itemsArray.length>0&&r.remove(r.itemsArray[0]);if(typeof t=="string"&&this.$element[0].tagName==="INPUT"){var i=t.split(",");if(i.length>1){for(var s=0;s<i.length;s++)this.add(i[s],!0);n||r.pushVal();return}}var u=r.options.itemValue(t),a=r.options.itemText(t),f=r.options.tagClass(t),l=e.grep(r.itemsArray,function(e){return r.options.itemValue(e)===u})[0];if(l&&!r.options.allowDuplicates){if(r.options.onTagExists){var c=e(".tag",r.$container).filter(function(){return e(this).data("item")===l});r.options.onTagExists(t,c)}return}if(r.items().toString().length+t.length+1>r.options.maxInputLength)return;var h=e.Event("beforeItemAdd",{item:t,cancel:!1});r.$element.trigger(h);if(h.cancel)return;r.itemsArray.push(t);var p=e('<span class="tag '+o(f)+'">'+o(a)+'<span data-role="remove"></span></span>');p.data("item",t),r.findInputWrapper().before(p),p.after(" ");if(r.isSelect&&!e('option[value="'+encodeURIComponent(u)+'"]',r.$element)[0]){var d=e("<option selected>"+o(a)+"</option>");d.data("item",t),d.attr("value",u),r.$element.append(d)}n||r.pushVal(),(r.options.maxTags===r.itemsArray.length||r.items().toString().length===r.options.maxInputLength)&&r.$container.addClass("bootstrap-tagsinput-max"),r.$element.trigger(e.Event("itemAdded",{item:t}))},remove:function(t,n){var r=this;r.objectItems&&(typeof t=="object"?t=e.grep(r.itemsArray,function(e){return r.options.itemValue(e)==r.options.itemValue(t)}):t=e.grep(r.itemsArray,function(e){return r.options.itemValue(e)==t}),t=t[t.length-1]);if(t){var i=e.Event("beforeItemRemove",{item:t,cancel:!1});r.$element.trigger(i);if(i.cancel)return;e(".tag",r.$container).filter(function(){return e(this).data("item")===t}).remove(),e("option",r.$element).filter(function(){return e(this).data("item")===t}).remove(),e.inArray(t,r.itemsArray)!==-1&&r.itemsArray.splice(e.inArray(t,r.itemsArray),1)}n||r.pushVal(),r.options.maxTags>r.itemsArray.length&&r.$container.removeClass("bootstrap-tagsinput-max"),r.$element.trigger(e.Event("itemRemoved",{item:t}))},removeAll:function(){var t=this;e(".tag",t.$container).remove(),e("option",t.$element).remove();while(t.itemsArray.length>0)t.itemsArray.pop();t.pushVal()},refresh:function(){var t=this;e(".tag",t.$container).each(function(){var n=e(this),r=n.data("item"),i=t.options.itemValue(r),s=t.options.itemText(r),u=t.options.tagClass(r);n.attr("class",null),n.addClass("tag "+o(u)),n.contents().filter(function(){return this.nodeType==3})[0].nodeValue=o(s);if(t.isSelect){var a=e("option",t.$element).filter(function(){return e(this).data("item")===r});a.attr("value",i)}})},items:function(){return this.itemsArray},pushVal:function(){var t=this,n=e.map(t.items(),function(e){return t.options.itemValue(e).toString()});t.$element.val(n,!0).trigger("change")},build:function(n){var s=this;s.options=e.extend({},t,n),s.objectItems&&(s.options.freeInput=!1),r(s.options,"itemValue"),r(s.options,"itemText"),i(s.options,"tagClass");if(s.options.typeahead){var o=s.options.typeahead||{};i(o,"source"),s.$input.typeahead(e.extend({},o,{source:function(t,n){function r(e){var t=[];for(var r=0;r<e.length;r++){var o=s.options.itemText(e[r]);i[o]=e[r],t.push(o)}n(t)}this.map={};var i=this.map,u=o.source(t);e.isFunction(u.success)?u.success(r):e.isFunction(u.then)?u.then(r):e.when(u).then(r)},updater:function(e){s.add(this.map[e])},matcher:function(e){return e.toLowerCase().indexOf(this.query.trim().toLowerCase())!==-1},sorter:function(e){return e.sort()},highlighter:function(e){var t=new RegExp("("+this.query+")","gi");return e.replace(t,"<strong>$1</strong>")}}))}if(s.options.typeaheadjs){var f=s.options.typeaheadjs||{};s.$input.typeahead(null,f).on("typeahead:selected",e.proxy(function(e,t){f.valueKey?s.add(t[f.valueKey]):s.add(t),s.$input.typeahead("val","")},s))}s.$container.on("click",e.proxy(function(e){s.$element.attr("disabled")||s.$input.removeAttr("disabled"),s.$input.focus()},s)),s.options.addOnBlur&&s.options.freeInput&&s.$input.on("focusout",e.proxy(function(t){e(".typeahead, .twitter-typeahead",s.$container).length===0&&(s.add(s.$input.val()),s.$input.val(""))},s)),s.$container.on("keydown","input",e.proxy(function(t){var n=e(t.target),r=s.findInputWrapper();if(s.$element.attr("disabled")){s.$input.attr("disabled","disabled");return}switch(t.which){case 8:if(u(n[0])===0){var i=r.prev();i&&s.remove(i.data("item"))}break;case 46:if(u(n[0])===0){var o=r.next();o&&s.remove(o.data("item"))}break;case 37:var a=r.prev();n.val().length===0&&a[0]&&(a.before(r),n.focus());break;case 39:var f=r.next();n.val().length===0&&f[0]&&(f.after(r),n.focus());break;default:}var l=n.val().length,c=Math.ceil(l/5),h=l+c+1;n.attr("size",Math.max(this.inputSize,n.val().length))},s)),s.$container.on("keypress","input",e.proxy(function(t){var n=e(t.target);if(s.$element.attr("disabled")){s.$input.attr("disabled","disabled");return}var r=n.val(),i=s.options.maxChars&&r.length>=s.options.maxChars;s.options.freeInput&&(a(t,s.options.confirmKeys)||i)&&(s.add(i?r.substr(0,s.options.maxChars):r),n.val(""),t.preventDefault());var o=n.val().length,u=Math.ceil(o/5),f=o+u+1;n.attr("size",Math.max(this.inputSize,n.val().length))},s)),s.$container.on("click","[data-role=remove]",e.proxy(function(t){if(s.$element.attr("disabled"))return;s.remove(e(t.target).closest(".tag").data("item"))},s)),s.options.itemValue===t.itemValue&&(s.$element[0].tagName==="INPUT"?s.add(s.$element.val()):e("option",s.$element).each(function(){s.add(e(this).attr("value"),!0)}))},destroy:function(){var e=this;e.$container.off("keypress","input"),e.$container.off("click","[role=remove]"),e.$container.remove(),e.$element.removeData("tagsinput"),e.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){var t=this.$input[0],n=this.$container[0];while(t&&t.parentNode!==n)t=t.parentNode;return e(t)}},e.fn.tagsinput=function(t,r){var i=[];return this.each(function(){var s=e(this).data("tagsinput");if(!s)s=new n(this,t),e(this).data("tagsinput",s),i.push(s),this.tagName==="SELECT"&&e("option",e(this)).attr("selected","selected"),e(this).val(e(this).val());else if(!t&&!r)i.push(s);else if(s[t]!==undefined){var o=s[t](r);o!==undefined&&i.push(o)}}),typeof t=="string"?i.length>1?i:i[0]:i},e.fn.tagsinput.Constructor=n;var s=e("<div />");e(function(){e("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})})(window.jQuery);